{"version":3,"sources":["../../../../../../apps/frontend/src/contexts/AuthContext.tsx","../../../../../../apps/frontend/src/app/%28auth%29/layout.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useEffect, useState, useCallback } from 'react'\n\ninterface AuthContextType {\n  user: User | null\n  token: string | null\n  refreshToken: string | null\n  isAuthenticated: boolean\n  isLoading: boolean\n  error: string | null\n}\n\ninterface User {\n  id: string\n  username: string\n  email: string\n  first_name?: string\n  last_name?: string\n  full_name: string\n  is_active: boolean\n  is_staff: boolean\n  date_joined: string\n  roles: string[]\n}\n\ninterface AuthContextValue extends AuthContextType {\n  login: (username: string, password: string) => Promise<void>\n  register: (data: any) => Promise<void>\n  logout: () => Promise<void>\n  refreshTokens: () => Promise<void>\n  getMe: () => Promise<void | null | undefined>\n  clearError: () => void\n  setError: (error: string | null) => void\n  checkAuthStatus: () => boolean\n  updateUser: (data: any) => Promise<void>\n}\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined)\n\nconst TOKEN_KEY = 'access_token'\nconst REFRESH_TOKEN_KEY = 'refresh_token'\nconst USER_KEY = 'user_data'\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [state, setState] = useState<AuthContextType>({\n    user: null,\n    token: null,\n    refreshToken: null,\n    isAuthenticated: false,\n    isLoading: false,\n    error: null\n  })\n\n  const login = useCallback(async (username: string, password: string) => {\n    setState(prev => ({ ...prev, isLoading: true, error: null }))\n\n    try {\n      const response = await fetch('/api/v1/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ username, password })\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.message || 'Login failed')\n      }\n\n      const data = await response.json()\n\n      if (data.access && data.refresh) {\n        localStorage.setItem(TOKEN_KEY, data.access)\n        localStorage.setItem(REFRESH_TOKEN_KEY, data.refresh)\n        localStorage.setItem(USER_KEY, JSON.stringify(data.user))\n      }\n\n      setState(prev => ({\n        ...prev,\n        user: data.user,\n        token: data.access,\n        refreshToken: data.refresh,\n        isAuthenticated: true,\n        isLoading: false,\n        error: null\n      }))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Login failed'\n      }))\n    }\n  }, [])\n\n  const register = useCallback(async (data: any) => {\n    setState(prev => ({ ...prev, isLoading: true, error: null }))\n\n    try {\n      const response = await fetch('/api/v1/users/register/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(data)\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.message || 'Registration failed')\n      }\n\n      const responseData = await response.json()\n\n      if (responseData.access && responseData.refresh && responseData.user) {\n        localStorage.setItem(TOKEN_KEY, responseData.access)\n        localStorage.setItem(REFRESH_TOKEN_KEY, responseData.refresh)\n        localStorage.setItem(USER_KEY, JSON.stringify(responseData.user))\n      }\n\n      setState(prev => ({\n        ...prev,\n        user: responseData.user,\n        token: responseData.access,\n        refreshToken: responseData.refresh,\n        isAuthenticated: true,\n        isLoading: false,\n        error: null\n      }))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Registration failed'\n      }))\n    }\n  }, [])\n\n  const logout = useCallback(async () => {\n    try {\n      const refreshToken = localStorage.getItem(REFRESH_TOKEN_KEY)\n\n      if (refreshToken) {\n        await fetch('/api/v1/auth/logout', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${refreshToken}`\n          },\n          body: JSON.stringify({ refreshToken })\n        })\n      }\n\n      localStorage.removeItem(TOKEN_KEY)\n      localStorage.removeItem(REFRESH_TOKEN_KEY)\n      localStorage.removeItem(USER_KEY)\n\n      setState(prev => ({\n        ...prev,\n        user: null,\n        token: null,\n        refreshToken: null,\n        isAuthenticated: false,\n        isLoading: false,\n        error: null\n      }))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        error: error instanceof Error ? error.message : 'Logout failed'\n      }))\n      return\n    }\n  }, [])\n\n  const refreshTokens = useCallback(async () => {\n    const refreshToken = localStorage.getItem(REFRESH_TOKEN_KEY)\n\n    if (!refreshToken) {\n      return\n    }\n\n    try {\n      const response = await fetch('/api/v1/auth/refresh', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${refreshToken}`\n        },\n        body: JSON.stringify({ refreshToken })\n      })\n\n      if (!response.ok) {\n        localStorage.removeItem(REFRESH_TOKEN_KEY)\n        throw new Error('Token refresh failed')\n      }\n\n      const data = await response.json()\n\n      if (data.access && data.refresh) {\n        localStorage.setItem(TOKEN_KEY, data.access)\n        localStorage.setItem(REFRESH_TOKEN_KEY, data.refresh)\n      }\n\n      setState(prev => ({\n        ...prev,\n        token: data.access,\n        refreshToken: data.refresh,\n        isAuthenticated: !!data.access,\n        isLoading: false,\n        error: null\n      }))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Token refresh failed'\n      }))\n    }\n  }, [])\n\n  const getMe = useCallback(async () => {\n    const token = localStorage.getItem(TOKEN_KEY)\n\n    if (!token) {\n      return null\n    }\n\n    try {\n      const response = await fetch('/api/v1/auth/me', {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch user data')\n      }\n\n      const data = await response.json()\n\n      setState(prev => ({\n        ...prev,\n        user: data,\n        token,\n        isAuthenticated: !!data,\n        isLoading: false,\n        error: null\n      }))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Failed to fetch user data'\n      }))\n      return\n    }\n  }, [])\n\n  const clearError = useCallback(() => {\n    setState(prev => ({ ...prev, error: null }))\n  }, [])\n\n  const setError = useCallback((error: string | null) => {\n    setState(prev => ({ ...prev, error }))\n  }, [])\n\n  const updateUser = useCallback(async (data: any) => {\n    try {\n      const token = localStorage.getItem(TOKEN_KEY)\n      const response = await fetch('/api/v1/users/me/', {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(data)\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to update user')\n      }\n\n      const updatedUser = await response.json()\n      setState(prev => ({ ...prev, user: updatedUser }))\n      localStorage.setItem(USER_KEY, JSON.stringify(updatedUser))\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        error: error instanceof Error ? error.message : 'Update failed'\n      }))\n    }\n  }, [])\n\n  const checkAuthStatus = useCallback(() => {\n    const token = localStorage.getItem(TOKEN_KEY)\n    const userData = localStorage.getItem(USER_KEY)\n    return !!token && !!userData && JSON.parse(userData)\n  }, [state.token, state.user])\n\n  useEffect(() => {\n    if (state.token) {\n      const refreshTimer = setInterval(() => {\n        refreshTokens()\n      }, 14 * 60 * 1000)\n\n      return () => {\n        clearInterval(refreshTimer)\n      }\n    }\n  }, [state.token, refreshTokens])\n\n  return (\n    <AuthContext.Provider value={{\n      ...state,\n      login,\n      register,\n      logout,\n      refreshTokens,\n      getMe,\n      clearError,\n      setError,\n      checkAuthStatus,\n      updateUser\n    }}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider')\n  }\n  return context\n}\n","'use client'\n\nimport { AuthProvider } from '@/contexts/AuthContext'\n\nexport default function AuthLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <AuthProvider>\n      {children}\n    </AuthProvider>\n  )\n}"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,MAoCA,IAAM,EAAc,CAAA,EAAA,EAAA,aAAA,AAAa,OAA+B,GAE1D,EAAY,eACZ,EAAoB,gBACpB,EAAW,YAEV,SAAS,EAAa,UAAE,CAAQ,CAAiC,EACtE,GAAM,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAA0B,CAClD,KAAM,KACN,MAAO,KACP,aAAc,KACd,iBAAiB,EACjB,WAAW,EACX,MAAO,IACT,GAEM,EAAQ,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,MAAO,EAAkB,KACjD,EAAS,IAAS,CAAE,EAAH,CAAM,CAAI,CAAE,WAAW,EAAM,MAAO,KAAK,CAAC,EAE3D,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,qBAAsB,CACjD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,UAAE,WAAU,CAAS,EAC5C,GAEA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAQ,MAAM,EAAS,IAAI,EACjC,OAAM,AAAI,MAAM,EAAM,OAAO,EAAI,eACnC,CAEA,IAAM,EAAO,MAAM,EAAS,IAAI,GAE5B,EAAK,MAAM,EAAI,EAAK,OAAO,EAAE,CAC/B,aAAa,OAAO,CAAC,EAAW,EAAK,MAAM,EAC3C,aAAa,OAAO,CAAC,EAAmB,EAAK,OAAO,EACpD,aAAa,OAAO,CAAC,EAAU,KAAK,SAAS,CAAC,EAAK,IAAI,IAGzD,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,KAAM,EAAK,IAAI,CACf,MAAO,EAAK,MAAM,CAClB,aAAc,EAAK,OAAO,CAC1B,gBAAiB,GACjB,WAAW,EACX,MAAO,KACT,CAAC,CACH,CAAE,MAAO,EAAO,CACd,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,WAAW,EACX,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,eAClD,CAAC,CACH,CACF,EAAG,EAAE,EAEC,EAAW,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,MAAO,IAClC,EAAS,IAAS,CAAE,EAAH,CAAM,CAAI,CAAE,WAAW,EAAM,MAAO,KAAK,CAAC,EAE3D,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,0BAA2B,CACtD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,EACvB,GAEA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAQ,MAAM,EAAS,IAAI,EACjC,OAAU,AAAJ,MAAU,EAAM,OAAO,EAAI,sBACnC,CAEA,IAAM,EAAe,MAAM,EAAS,IAAI,GAEpC,EAAa,MAAM,EAAI,EAAa,OAAO,EAAI,EAAa,IAAI,EAAE,CACpE,aAAa,OAAO,CAAC,EAAW,EAAa,MAAM,EACnD,aAAa,OAAO,CAAC,EAAmB,EAAa,OAAO,EAC5D,aAAa,OAAO,CAAC,EAAU,KAAK,SAAS,CAAC,EAAa,IAAI,IAGjE,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,KAAM,EAAa,IAAI,CACvB,MAAO,EAAa,MAAM,CAC1B,aAAc,EAAa,OAAO,CAClC,iBAAiB,EACjB,WAAW,EACX,MAAO,KACT,CAAC,CACH,CAAE,MAAO,EAAO,CACd,EAAS,GAAS,EAChB,EADe,CACZ,CAAI,CACP,WAAW,EACX,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,sBAClD,CAAC,CACH,CACF,EAAG,EAAE,EAEC,EAAS,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UACzB,GAAI,CACF,IAAM,EAAe,aAAa,OAAO,CAAC,GAEtC,GACF,MAAM,KADU,CACJ,sBAAuB,CACjC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,CAAC,OAAO,EAAE,EAAA,CAAc,AAC3C,EACA,KAAM,KAAK,SAAS,CAAC,cAAE,CAAa,EACtC,GAGF,aAAa,UAAU,CAAC,GACxB,aAAa,UAAU,CAAC,GACxB,aAAa,UAAU,CAAC,GAExB,EAAS,GAAS,EAChB,EADe,CACZ,CAAI,CACP,KAAM,KACN,MAAO,KACP,aAAc,KACd,iBAAiB,EACjB,WAAW,EACX,MAAO,IACT,CAAC,EACH,CAAE,MAAO,EAAO,CACd,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,gBAClD,CAAC,EACD,MACF,CACF,EAAG,EAAE,EAEC,EAAgB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UAChC,IAAM,EAAe,aAAa,OAAO,CAAC,GAE1C,GAAK,CAAD,CAIJ,GAAI,CACF,IAAM,EAAW,EALA,IAKM,MAAM,uBAAwB,CACnD,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,CAAC,OAAO,EAAE,EAAA,CAAc,AAC3C,EACA,KAAM,KAAK,SAAS,CAAC,cAAE,CAAa,EACtC,GAEA,GAAI,CAAC,EAAS,EAAE,CAEd,CAFgB,KAChB,aAAa,UAAU,CAAC,GAClB,AAAI,MAAM,wBAGlB,IAAM,EAAO,MAAM,EAAS,IAAI,GAE5B,EAAK,MAAM,EAAI,EAAK,OAAO,EAAE,CAC/B,aAAa,OAAO,CAAC,EAAW,EAAK,MAAM,EAC3C,aAAa,OAAO,CAAC,EAAmB,EAAK,OAAO,GAGtD,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,MAAO,EAAK,MAAM,CAClB,aAAc,EAAK,OAAO,CAC1B,gBAAiB,CAAC,CAAC,EAAK,MAAM,CAC9B,WAAW,EACX,MAAO,KACT,CAAC,CACH,CAAE,MAAO,EAAO,CACd,EAAS,GAAS,EAChB,EADe,CACZ,CAAI,CACP,WAAW,EACX,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,uBAClD,CAAC,CACH,CACF,EAAG,EAAE,EAEC,EAAQ,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UACxB,IAAM,EAAQ,aAAa,OAAO,CAAC,GAEnC,GAAI,CAAC,EACH,KADU,EACH,KAGT,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,kBAAmB,CAC9C,QAAS,CACP,eAAgB,mBAChB,cAAiB,CAAC,OAAO,EAAE,EAAA,CAAO,AACpC,CACF,GAEA,GAAI,CAAC,EAAS,EAAE,CACd,CADgB,KACV,AAAI,MAAM,6BAGlB,IAAM,EAAO,MAAM,EAAS,IAAI,GAEhC,EAAS,GAAS,EAChB,EADe,CACZ,CAAI,CACP,KAAM,QACN,EACA,gBAAiB,CAAC,CAAC,EACnB,WAAW,EACX,MAAO,KACT,CAAC,CACH,CAAE,MAAO,EAAO,CACd,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,WAAW,EACX,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,4BAClD,CAAC,EACD,MACF,CACF,EAAG,EAAE,EAEC,EAAa,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,KAC7B,EAAS,IAAS,CAAE,EAAH,CAAM,CAAI,CAAE,MAAO,KAAK,CAAC,CAC5C,EAAG,EAAE,EAEC,EAAW,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,AAAC,IAC5B,EAAS,IAAS,CAAE,EAAH,CAAM,CAAI,OAAE,EAAM,CAAC,CACtC,EAAG,EAAE,EAEC,EAAa,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,MAAO,IACpC,GAAI,CACF,IAAM,EAAQ,aAAa,OAAO,CAAC,GAC7B,EAAW,MAAM,MAAM,oBAAqB,CAChD,OAAQ,QACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,CAAC,OAAO,EAAE,EAAA,CAAO,AACpC,EACA,KAAM,KAAK,SAAS,CAAC,EACvB,GAEA,GAAI,CAAC,EAAS,EAAE,CACd,CADgB,KACV,AAAI,MAAM,yBAGlB,IAAM,EAAc,MAAM,EAAS,IAAI,GACvC,EAAS,IAAS,CAAE,EAAH,CAAM,CAAI,CAAE,KAAM,EAAY,CAAC,EAChD,aAAa,OAAO,CAAC,EAAU,KAAK,SAAS,CAAC,GAChD,CAAE,MAAO,EAAO,CACd,EAAS,IAAS,CAChB,EADe,CACZ,CAAI,CACP,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,gBAClD,CAAC,CACH,CACF,EAAG,EAAE,EAEC,EAAkB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,KAClC,IAAM,EAAQ,aAAa,OAAO,CAAC,GAC7B,EAAW,aAAa,OAAO,CAAC,GACtC,MAAO,CAAC,CAAC,GAAS,CAAC,CAAC,GAAY,KAAK,KAAK,CAAC,EAC7C,EAAG,CAAC,EAAM,KAAK,CAAE,EAAM,IAAI,CAAC,EAc5B,MAZA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GAAI,EAAM,KAAK,CAAE,CACf,IAAM,EAAe,YAAY,KAC/B,GACF,EAAG,KAAK,CAER,IAFa,EAEN,KACL,cAAc,EAChB,CACF,CACF,EAAG,CAAC,EAAM,KAAK,CAAE,EAAc,EAG7B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAY,QAAQ,CAAA,CAAC,MAAO,CAC3B,GAAG,CAAK,OACR,WACA,SACA,gBACA,EACA,QACA,sBACA,kBACA,aACA,CACF,WACG,GAGP,CAEO,SAAS,IACd,IAAM,EAAU,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,GAC3B,QAAgB,IAAZ,EACF,KADyB,CACnB,AAAI,MAAM,+CAElB,OAAO,CACT,sFCjVA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,EAAW,UACjC,CAAQ,CAGT,EACC,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,UACV,GAGP"}