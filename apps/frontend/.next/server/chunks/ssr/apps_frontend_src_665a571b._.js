module.exports=[80466,a=>{"use strict";var b=a.i(86531),c=a.i(9644);let d=(0,c.createContext)(void 0),e="access_token",f="refresh_token",g="user_data";function h({children:a}){let[h,i]=(0,c.useState)({user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}),j=(0,c.useCallback)(async(a,b)=>{i(a=>({...a,isLoading:!0,error:null}));try{let c=await fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:b})});if(!c.ok){let a=await c.json();throw Error(a.message||"Login failed")}let d=await c.json();d.access&&d.refresh&&(localStorage.setItem(e,d.access),localStorage.setItem(f,d.refresh),localStorage.setItem(g,JSON.stringify(d.user))),i(a=>({...a,user:d.user,token:d.access,refreshToken:d.refresh,isAuthenticated:!0,isLoading:!1,error:null}))}catch(a){i(b=>({...b,isLoading:!1,error:a instanceof Error?a.message:"Login failed"}))}},[]),k=(0,c.useCallback)(async a=>{i(a=>({...a,isLoading:!0,error:null}));try{let b=await fetch("/api/v1/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.message||"Registration failed")}let c=await b.json();c.access&&c.refresh&&c.user&&(localStorage.setItem(e,c.access),localStorage.setItem(f,c.refresh),localStorage.setItem(g,JSON.stringify(c.user))),i(a=>({...a,user:c.user,token:c.access,refreshToken:c.refresh,isAuthenticated:!0,isLoading:!1,error:null}))}catch(a){i(b=>({...b,isLoading:!1,error:a instanceof Error?a.message:"Registration failed"}))}},[]),l=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem(f);a&&await fetch("/api/v1/auth/logout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({refreshToken:a})}),localStorage.removeItem(e),localStorage.removeItem(f),localStorage.removeItem(g),i(a=>({...a,user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}))}catch(a){i(b=>({...b,error:a instanceof Error?a.message:"Logout failed"}));return}},[]),m=(0,c.useCallback)(async()=>{let a=localStorage.getItem(f);if(a)try{let b=await fetch("/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({refreshToken:a})});if(!b.ok)throw localStorage.removeItem(f),Error("Token refresh failed");let c=await b.json();c.access&&c.refresh&&(localStorage.setItem(e,c.access),localStorage.setItem(f,c.refresh)),i(a=>({...a,token:c.access,refreshToken:c.refresh,isAuthenticated:!!c.access,isLoading:!1,error:null}))}catch(a){i(b=>({...b,isLoading:!1,error:a instanceof Error?a.message:"Token refresh failed"}))}},[]),n=(0,c.useCallback)(async()=>{let a=localStorage.getItem(e);if(!a)return null;try{let b=await fetch("/api/v1/auth/me",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!b.ok)throw Error("Failed to fetch user data");let c=await b.json();i(b=>({...b,user:c,token:a,isAuthenticated:!!c,isLoading:!1,error:null}))}catch(a){i(b=>({...b,isLoading:!1,error:a instanceof Error?a.message:"Failed to fetch user data"}));return}},[]),o=(0,c.useCallback)(()=>{i(a=>({...a,error:null}))},[]),p=(0,c.useCallback)(a=>{i(b=>({...b,error:a}))},[]),q=(0,c.useCallback)(async a=>{try{let b=localStorage.getItem(e),c=await fetch("/api/v1/users/me/",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(a)});if(!c.ok)throw Error("Failed to update user");let d=await c.json();i(a=>({...a,user:d})),localStorage.setItem(g,JSON.stringify(d))}catch(a){i(b=>({...b,error:a instanceof Error?a.message:"Update failed"}))}},[]),r=(0,c.useCallback)(()=>{let a=localStorage.getItem(e),b=localStorage.getItem(g);return!!a&&!!b&&JSON.parse(b)},[h.token,h.user]);return(0,c.useEffect)(()=>{if(h.token){let a=setInterval(()=>{m()},84e4);return()=>{clearInterval(a)}}},[h.token,m]),(0,b.jsx)(d.Provider,{value:{...h,login:j,register:k,logout:l,refreshTokens:m,getMe:n,clearError:o,setError:p,checkAuthStatus:r,updateUser:q},children:a})}function i(){let a=(0,c.useContext)(d);if(void 0===a)throw Error("useAuth must be used within an AuthProvider");return a}a.s(["AuthProvider",()=>h,"useAuth",()=>i])},20417,a=>{"use strict";var b=a.i(86531),c=a.i(80466);function d({children:a}){return(0,b.jsx)(c.AuthProvider,{children:a})}a.s(["default",()=>d])}];

//# sourceMappingURL=apps_frontend_src_665a571b._.js.map