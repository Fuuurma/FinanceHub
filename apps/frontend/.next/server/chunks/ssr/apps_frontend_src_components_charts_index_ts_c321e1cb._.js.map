{"version":3,"sources":["../../../../../../apps/frontend/src/components/charts/TechnicalIndicatorsPanel.tsx","../../../../../../apps/frontend/src/components/charts/TradingViewChart.tsx","../../../../../../apps/frontend/src/components/charts/ScreenReaderChart.tsx","../../../../../../apps/frontend/src/components/charts/AdvancedChart.tsx","../../../../../../apps/frontend/src/components/charts/ChartControls.tsx","../../../../../../apps/frontend/src/components/charts/HistoricalDataExport.tsx","../../../../../../apps/frontend/src/components/charts/TechnicalIndicators.tsx","../../../../../../apps/frontend/src/components/charts/IndicatorConfigModal.tsx","../../../../../../apps/frontend/src/components/charts/DrawingTools.tsx","../../../../../../apps/frontend/src/components/charts/ComparisonChart.tsx","../../../../../../apps/frontend/src/components/charts/MarketHeatmap.tsx","../../../../../../apps/frontend/src/components/charts/VolumeProfileChart.tsx","../../../../../../apps/frontend/src/components/charts/CandlestickChart.tsx","../../../../../../apps/frontend/src/components/charts/LineChart.tsx","../../../../../../apps/frontend/src/components/charts/AreaChart.tsx","../../../../../../apps/frontend/src/components/charts/HeikinAshiChart.tsx","../../../../../../apps/frontend/src/components/charts/RenkoChart.tsx","../../../../../../apps/frontend/src/components/charts/KagiChart.tsx","../../../../../../apps/frontend/src/components/charts/DepthChart.tsx","../../../../../../apps/frontend/src/components/charts/OrderBook.tsx","../../../../../../apps/frontend/src/components/charts/ChartWrapper.tsx","../../../../../../apps/frontend/src/lib/constants/indicators.ts","../../../../../../apps/frontend/src/components/charts/index.ts","../../../../../../apps/frontend/src/node_modules/lucide-react/src/icons/zoom-out.ts","../../../../../../apps/frontend/src/node_modules/lucide-react/src/icons/grip-horizontal.ts","../../../../../../apps/frontend/src/node_modules/lucide-react/src/icons/zoom-in.ts","../../../../../../apps/frontend/src/node_modules/lucide-react/src/icons/circle-question-mark.ts","../../../../../../apps/frontend/src/lib/utils/technical-indicators.ts","../../../../../../apps/frontend/src/lib/types/indicators.ts"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ColorType,\n  Time,\n  LineSeries,\n  HistogramSeries,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\nimport { HelpCircle, TrendingUp, TrendingDown, Minus, Info } from 'lucide-react'\nimport type { OHLCVData } from '@/components/charts/TradingViewChart'\nimport {\n  calculateRSI,\n  calculateMACD,\n  formatIndicatorValue,\n  getRSISignal,\n  getMACDSignal,\n  INDICATOR_DESCRIPTIONS,\n} from '@/lib/utils/technical-indicators'\n\ninterface TechnicalIndicatorsPanelProps {\n  data: OHLCVData[]\n  showRSI?: boolean\n  showMACD?: boolean\n  rsiPeriod?: number\n  rsiOverbought?: number\n  rsiOversold?: number\n  macdFast?: number\n  macdSlow?: number\n  macdSignal?: number\n  height?: number\n  onIndicatorValueChange?: (indicator: string, value: number | null) => void\n}\n\nexport function TechnicalIndicatorsPanel({\n  data,\n  showRSI = true,\n  showMACD = true,\n  rsiPeriod = 14,\n  rsiOverbought = 70,\n  rsiOversold = 30,\n  macdFast = 12,\n  macdSlow = 26,\n  macdSignal = 9,\n  height = 200,\n  onIndicatorValueChange,\n}: TechnicalIndicatorsPanelProps) {\n  const rsiContainerRef = useRef<HTMLDivElement>(null)\n  const macdContainerRef = useRef<HTMLDivElement>(null)\n  const rsiChartRef = useRef<IChartApi | null>(null)\n  const macdChartRef = useRef<IChartApi | null>(null)\n  const { theme } = useTheme()\n\n  const isDark = theme === 'dark'\n\n  const chartColors = useMemo(() => ({\n    background: isDark ? '#0f172a' : '#ffffff',\n    text: isDark ? '#94a3b8' : '#64748b',\n    grid: isDark ? '#1e293b' : '#e2e8f0',\n    upColor: '#22c55e',\n    downColor: '#ef4444',\n    macdColor: '#3b82f6',\n    signalColor: '#f59e0b',\n    histogramUp: 'rgba(34, 197, 94, 0.5)',\n    histogramDown: 'rgba(239, 68, 68, 0.5)',\n    overbought: '#ef4444',\n    oversold: '#22c55e',\n    middle: isDark ? '#64748b' : '#9ca3af',\n  }), [isDark])\n\n  const closes = data.map(d => d.close)\n  const times = data.map(d => d.date as Time)\n\n  const rsiData = useMemo(() => calculateRSI(closes, rsiPeriod), [closes, rsiPeriod])\n  const macdData = useMemo(\n    () => calculateMACD(closes, macdFast, macdSlow, macdSignal),\n    [closes, macdFast, macdSlow, macdSignal]\n  )\n\n  const latestRSI = rsiData[rsiData.length - 1]\n  const latestMACD = macdData.macd[macdData.macd.length - 1]\n  const latestSignal = macdData.signal[macdData.signal.length - 1]\n\n  useEffect(() => {\n    if (!showRSI || !rsiContainerRef.current || !data.length) return\n\n    if (rsiChartRef.current) {\n      rsiChartRef.current.remove()\n    }\n\n    const chart = createChart(rsiContainerRef.current, {\n      width: rsiContainerRef.current.clientWidth,\n      height: height - 40,\n      layout: {\n        background: { type: ColorType.Solid, color: chartColors.background },\n        textColor: chartColors.text,\n      },\n      grid: {\n        vertLines: { color: chartColors.grid, style: 2 },\n        horzLines: { color: chartColors.grid, style: 2 },\n      },\n      rightPriceScale: {\n        borderVisible: false,\n        scaleMargins: { top: 0.1, bottom: 0.1 },\n      },\n      timeScale: {\n        visible: false,\n      },\n      handleScroll: {\n        vertTouchDrag: true,\n      },\n      handleScale: {\n        axisPressedMouseMove: false,\n        mouseWheel: false,\n        pinch: false,\n      },\n    })\n\n    rsiChartRef.current = chart\n\n    const lineSeries = chart.addSeries(LineSeries, {\n      color: '#8b5cf6',\n      lineWidth: 2,\n      priceFormat: {\n        type: 'price',\n        precision: 0,\n        minMove: 1,\n      },\n    })\n\n    const rsiValidData = rsiData\n      .map((value, index) => (isNaN(value) ? null : { time: times[index], value }))\n      .filter((item): item is { time: Time; value: number } => item !== null)\n\n    lineSeries.setData(rsiValidData)\n\n    chart.priceScale('').applyOptions({\n      autoScale: true,\n    })\n\n    const handleResize = () => {\n      if (rsiContainerRef.current && rsiChartRef.current) {\n        rsiChartRef.current.applyOptions({\n          width: rsiContainerRef.current.clientWidth,\n        })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      chart.remove()\n    }\n  }, [showRSI, data, rsiPeriod, chartColors, height, rsiData, times])\n\n  useEffect(() => {\n    if (!showMACD || !macdContainerRef.current || !data.length) return\n\n    if (macdChartRef.current) {\n      macdChartRef.current.remove()\n    }\n\n    const chart = createChart(macdContainerRef.current, {\n      width: macdContainerRef.current.clientWidth,\n      height: height - 40,\n      layout: {\n        background: { type: ColorType.Solid, color: chartColors.background },\n        textColor: chartColors.text,\n      },\n      grid: {\n        vertLines: { color: chartColors.grid, style: 2 },\n        horzLines: { color: chartColors.grid, style: 2 },\n      },\n      rightPriceScale: {\n        borderVisible: false,\n        scaleMargins: { top: 0.1, bottom: 0.1 },\n      },\n      timeScale: {\n        visible: false,\n      },\n      handleScroll: {\n        vertTouchDrag: true,\n      },\n      handleScale: {\n        axisPressedMouseMove: false,\n        mouseWheel: false,\n        pinch: false,\n      },\n    })\n\n    macdChartRef.current = chart\n\n    const macdLine = chart.addSeries(LineSeries, {\n      color: chartColors.macdColor,\n      lineWidth: 2,\n    })\n\n    const signalLine = chart.addSeries(LineSeries, {\n      color: chartColors.signalColor,\n      lineWidth: 2,\n    })\n\n    const histogramSeries = chart.addSeries(HistogramSeries, {\n      priceFormat: {\n        type: 'price',\n        precision: 2,\n        minMove: 0.01,\n      },\n      priceScaleId: '',\n    })\n\n    const macdValidData = macdData.macd\n      .map((value, index) => (isNaN(value) ? null : { time: times[index], value }))\n      .filter((item): item is { time: Time; value: number } => item !== null)\n\n    const signalValidData = macdData.signal\n      .map((value, index) => (isNaN(value) ? null : { time: times[index], value }))\n      .filter((item): item is { time: Time; value: number } => item !== null)\n\n    const histogramValidData = macdData.histogram\n      .map((value, index) => {\n        if (isNaN(value)) return null\n        return {\n          time: times[index],\n          value,\n          color: value >= 0 ? chartColors.upColor : chartColors.downColor,\n        }\n      })\n      .filter((item): item is { time: Time; value: number; color: string } => item !== null)\n\n    macdLine.setData(macdValidData)\n    signalLine.setData(signalValidData)\n    histogramSeries.setData(histogramValidData)\n\n    histogramSeries.priceScale().applyOptions({\n      scaleMargins: { top: 0.7, bottom: 0 },\n      borderVisible: false,\n    })\n\n    const handleResize = () => {\n      if (macdContainerRef.current && macdChartRef.current) {\n        macdChartRef.current.applyOptions({\n          width: macdContainerRef.current.clientWidth,\n        })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      chart.remove()\n    }\n  }, [showMACD, data, macdFast, macdSlow, macdSignal, chartColors, height, macdData, times])\n\n  const rsiSignal = getRSISignal(latestRSI, rsiOverbought, rsiOversold)\n  const macdSignalType = getMACDSignal(latestMACD, latestSignal)\n\n  if (!showRSI && !showMACD) {\n    return null\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Tabs defaultValue={showRSI ? 'rsi' : 'macd'} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\" style={{ maxWidth: 300 }}>\n          {showRSI && (\n            <TabsTrigger value=\"rsi\" className=\"flex items-center gap-2\">\n              RSI\n              {latestRSI && (\n                <Badge\n                  variant={rsiSignal === 'overbought' ? 'destructive' : rsiSignal === 'oversold' ? 'default' : 'secondary'}\n                  className={rsiSignal === 'oversold' ? 'bg-green-500' : ''}\n                >\n                  {rsiSignal === 'overbought' ? 'OB' : rsiSignal === 'oversold' ? 'OS' : 'N'}\n                </Badge>\n              )}\n            </TabsTrigger>\n          )}\n          {showMACD && (\n            <TabsTrigger value=\"macd\" className=\"flex items-center gap-2\">\n              MACD\n              {latestMACD && latestSignal && (\n                <Badge\n                  variant={macdSignalType === 'bullish' ? 'default' : macdSignalType === 'bearish' ? 'destructive' : 'secondary'}\n                  className={macdSignalType === 'bullish' ? 'bg-green-500' : ''}\n                >\n                  {macdSignalType === 'bullish' ? '↑' : macdSignalType === 'bearish' ? '↓' : '→'}\n                </Badge>\n              )}\n            </TabsTrigger>\n          )}\n        </TabsList>\n\n        {showRSI && (\n          <TabsContent value=\"rsi\" className=\"mt-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <CardTitle className=\"text-sm font-medium\">\n                      Relative Strength Index (RSI)\n                    </CardTitle>\n                    <TooltipProvider>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-4 w-4 text-muted-foreground cursor-help\" />\n                        </TooltipTrigger>\n                        <TooltipContent className=\"max-w-sm\">\n                          <p className=\"font-medium mb-1\">{INDICATOR_DESCRIPTIONS.rsi.fullName}</p>\n                          <p className=\"text-sm text-muted-foreground mb-2\">\n                            {INDICATOR_DESCRIPTIONS.rsi.description}\n                          </p>\n                          <p className=\"text-sm\">\n                            <span className=\"text-red-500 font-medium\">Overbought (≥{rsiOverbought}):</span> May indicate price is too high and could reverse down.\n                          </p>\n                          <p className=\"text-sm\">\n                            <span className=\"text-green-500 font-medium\">Oversold (≤{rsiOversold}):</span> May indicate price is too low and could reverse up.\n                          </p>\n                        </TooltipContent>\n                      </Tooltip>\n                    </TooltipProvider>\n                  </div>\n                  <div className=\"flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"text-muted-foreground\">RSI({rsiPeriod}):</span>\n                      {latestRSI !== undefined && !isNaN(latestRSI) ? (\n                        <span className={`font-mono font-bold ${\n                          rsiSignal === 'overbought' ? 'text-red-500' :\n                          rsiSignal === 'oversold' ? 'text-green-500' : ''\n                        }`}>\n                          {formatIndicatorValue(latestRSI)}\n                        </span>\n                      ) : (\n                        <span className=\"font-mono\">--</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex gap-4 text-xs text-muted-foreground mb-2\">\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-full bg-red-500\" />\n                    Overbought ({rsiOverbought}+)\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-full bg-green-500\" />\n                    Oversold ({rsiOversold}-)\n                  </span>\n                </div>\n                <div ref={rsiContainerRef} className=\"w-full\" style={{ height: height - 40 }} />\n              </CardContent>\n            </Card>\n          </TabsContent>\n        )}\n\n        {showMACD && (\n          <TabsContent value=\"macd\" className=\"mt-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <CardTitle className=\"text-sm font-medium\">\n                      MACD ({macdFast},{macdSlow},{macdSignal})\n                    </CardTitle>\n                    <TooltipProvider>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <HelpCircle className=\"h-4 w-4 text-muted-foreground cursor-help\" />\n                        </TooltipTrigger>\n                        <TooltipContent className=\"max-w-sm\">\n                          <p className=\"font-medium mb-1\">{INDICATOR_DESCRIPTIONS.macd.fullName}</p>\n                          <p className=\"text-sm text-muted-foreground mb-2\">\n                            {INDICATOR_DESCRIPTIONS.macd.description}\n                          </p>\n                          <div className=\"space-y-1 text-sm\">\n                            <p>\n                              <span className=\"text-blue-500 font-medium\">MACD Line:</span> {macdFast}-EMA minus {macdSlow}-EMA\n                            </p>\n                            <p>\n                              <span className=\"text-amber-500 font-medium\">Signal Line:</span> {macdSignal}-period EMA of MACD\n                            </p>\n                            <p>\n                              <span className=\"font-medium\">Histogram:</span> MACD minus Signal\n                            </p>\n                          </div>\n                        </TooltipContent>\n                      </Tooltip>\n                    </TooltipProvider>\n                  </div>\n                  <div className=\"flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-0.5 bg-blue-500\" />\n                      <span className=\"text-muted-foreground\">MACD:</span>\n                      {latestMACD !== undefined && !isNaN(latestMACD) ? (\n                        <span className={`font-mono ${\n                          macdSignalType === 'bullish' ? 'text-green-500' :\n                          macdSignalType === 'bearish' ? 'text-red-500' : ''\n                        }`}>\n                          {formatIndicatorValue(latestMACD)}\n                        </span>\n                      ) : (\n                        <span className=\"font-mono\">--</span>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-0.5 bg-amber-500\" />\n                      <span className=\"text-muted-foreground\">Signal:</span>\n                      {latestSignal !== undefined && !isNaN(latestSignal) ? (\n                        <span className=\"font-mono\">{formatIndicatorValue(latestSignal)}</span>\n                      ) : (\n                        <span className=\"font-mono\">--</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex gap-4 text-xs text-muted-foreground mb-2\">\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-0.5 bg-blue-500\" />\n                    MACD ({macdFast},{macdSlow})\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-0.5 bg-amber-500\" />\n                    Signal ({macdSignal})\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 bg-green-500/50\" />\n                    Histogram\n                  </span>\n                </div>\n                <div ref={macdContainerRef} className=\"w-full\" style={{ height: height - 40 }} />\n              </CardContent>\n            </Card>\n          </TabsContent>\n        )}\n      </Tabs>\n    </div>\n  )\n}\n","'use client'\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  ColorType,\n  CrosshairMode,\n  Time,\n  MouseEventParams,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { assetsApi } from '@/lib/api/assets'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { RefreshCw, AlertTriangle, TrendingUp, TrendingDown } from 'lucide-react'\nimport { TechnicalIndicatorsPanel } from './TechnicalIndicatorsPanel'\nimport { IndicatorConfig, calculateAllIndicators, INDICATOR_DESCRIPTIONS } from '@/lib/utils/technical-indicators'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\nimport { HelpCircle } from 'lucide-react'\n\nexport type ChartType = 'candlestick' | 'line' | 'area' | 'bar' | 'histogram'\nexport type Timeframe = '1m' | '5m' | '15m' | '1h' | '4h' | '1d' | '1w' | '1M'\n\ninterface TradingViewChartProps {\n  symbol: string\n  chartType?: ChartType\n  timeframe?: Timeframe\n  height?: number\n  showVolume?: boolean\n  showIndicators?: string[]\n  indicatorConfig?: IndicatorConfig\n  onTimeframeChange?: (tf: Timeframe) => void\n  onSymbolChange?: (symbol: string) => void\n  onIndicatorChange?: (indicator: string, enabled: boolean) => void\n}\n\nexport interface OHLCVData {\n  date: string\n  open: number\n  high: number\n  low: number\n  close: number\n  volume?: number\n}\n\ninterface CrosshairData {\n  time: string | null\n  open: number | null\n  high: number | null\n  low: number | null\n  close: number | null\n  volume: number | null\n  sma20?: number | null\n  sma50?: number | null\n  sma200?: number | null\n  ema12?: number | null\n  ema26?: number | null\n  rsi?: number | null\n  macd?: number | null\n  macdSignal?: number | null\n  bollingerUpper?: number | null\n  bollingerMiddle?: number | null\n  bollingerLower?: number | null\n}\n\nexport function TradingViewChart({\n  symbol,\n  chartType = 'candlestick',\n  timeframe = '1d',\n  height = 400,\n  showVolume = true,\n  showIndicators = [],\n  indicatorConfig = {},\n  onTimeframeChange,\n  onSymbolChange,\n  onIndicatorChange,\n}: TradingViewChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const { theme } = useTheme()\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [currentData, setCurrentData] = useState<OHLCVData[]>([])\n  const [crosshairData, setCrosshairData] = useState<CrosshairData>({\n    time: null,\n    open: null,\n    high: null,\n    low: null,\n    close: null,\n    volume: null,\n  })\n  const [retryCount, setRetryCount] = useState(0)\n  const [isMobile, setIsMobile] = useState(false)\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < 768)\n    }\n    checkMobile()\n    window.addEventListener('resize', checkMobile)\n    return () => window.removeEventListener('resize', checkMobile)\n  }, [])\n\n  const responsiveHeight = isMobile ? Math.min(height * 0.7, 350) : height\n\n  const isDark = theme === 'dark'\n\n  const chartColors = useMemo(() => ({\n    background: isDark ? '#0f172a' : '#ffffff',\n    text: isDark ? '#94a3b8' : '#64748b',\n    grid: isDark ? '#1e293b' : '#e2e8f0',\n    upColor: '#22c55e',\n    downColor: '#ef4444',\n    wickUpColor: '#22c55e',\n    wickDownColor: '#ef4444',\n    volumeUp: isDark ? 'rgba(34, 197, 94, 0.3)' : 'rgba(34, 197, 94, 0.2)',\n    volumeDown: isDark ? 'rgba(239, 68, 68, 0.3)' : 'rgba(239, 68, 68, 0.2)',\n    crosshairLine: isDark ? 'rgba(148, 163, 184, 0.3)' : 'rgba(100, 116, 139, 0.3)',\n    sma20Color: '#3b82f6',\n    sma50Color: '#22c55e',\n    sma200Color: '#f59e0b',\n    ema12Color: '#8b5cf6',\n    ema26Color: '#ec4899',\n    bollingerUpperColor: '#94a3b8',\n    bollingerMiddleColor: '#64748b',\n    bollingerLowerColor: '#94a3b8',\n  }), [isDark])\n\n  const showRSI = showIndicators.includes('rsi')\n  const showMACD = showIndicators.includes('macd')\n  const showSMA20 = showIndicators.includes('sma20')\n  const showSMA50 = showIndicators.includes('sma50')\n  const showSMA200 = showIndicators.includes('sma200')\n  const showEMA12 = showIndicators.includes('ema12')\n  const showEMA26 = showIndicators.includes('ema26')\n  const showBollinger = showIndicators.includes('bollinger')\n\n  const indicatorResults = useMemo(() => {\n    if (currentData.length === 0) return null\n    const config: IndicatorConfig = {\n      sma20: showSMA20,\n      sma50: showSMA50,\n      sma200: showSMA200,\n      ema12: showEMA12,\n      ema26: showEMA26,\n      rsi: showRSI,\n      macd: showMACD,\n      bollinger: showBollinger,\n      rsiPeriod: indicatorConfig.rsiPeriod,\n      rsiOverbought: indicatorConfig.rsiOverbought,\n      rsiOversold: indicatorConfig.rsiOversold,\n      macdFast: indicatorConfig.macdFast,\n      macdSlow: indicatorConfig.macdSlow,\n      macdSignal: indicatorConfig.macdSignal,\n      bollingerPeriod: indicatorConfig.bollingerPeriod,\n      bollingerStdDev: indicatorConfig.bollingerStdDev,\n    }\n    return calculateAllIndicators(currentData, config)\n  }, [currentData, showSMA20, showSMA50, showSMA200, showEMA12, showEMA26, showRSI, showMACD, showBollinger, indicatorConfig])\n\n  const loadData = useCallback(async () => {\n    if (!chartContainerRef.current) return\n\n    setLoading(true)\n    setError(null)\n\n    try {\n      const interval = timeframe === '1d' ? '1d' : timeframe === '1w' ? '1wk' : timeframe === '1M' ? '1mo' : '1d'\n      const history = await assetsApi.getHistorical(symbol, undefined, undefined, interval)\n\n      if (!history || history.length === 0) {\n        setError('No data available for this symbol')\n        setLoading(false)\n        return\n      }\n\n      const ohlcvData: OHLCVData[] = history.map((d) => ({\n        date: d.timestamp instanceof Date ? d.timestamp.toISOString() : new Date(d.timestamp).toISOString(),\n        open: d.open,\n        high: d.high,\n        low: d.low,\n        close: d.close,\n        volume: d.volume,\n      }))\n\n      setCurrentData(ohlcvData)\n      setRetryCount(0)\n\n      if (chartRef.current) {\n        chartRef.current.remove()\n      }\n\n      const chart = createChart(chartContainerRef.current, {\n        width: chartContainerRef.current.clientWidth,\n        height: responsiveHeight - (showRSI || showMACD ? 250 : 0) - 60,\n        layout: {\n          background: { type: ColorType.Solid, color: chartColors.background },\n          textColor: chartColors.text,\n        },\n        grid: {\n          vertLines: { color: chartColors.grid, style: 2 },\n          horzLines: { color: chartColors.grid, style: 2 },\n        },\n        crosshair: {\n          mode: CrosshairMode.Normal,\n          vertLine: {\n            width: 1,\n            color: chartColors.crosshairLine,\n            style: 2,\n          },\n          horzLine: {\n            width: 1,\n            color: chartColors.crosshairLine,\n            style: 2,\n          },\n        },\n        rightPriceScale: {\n          borderColor: chartColors.grid,\n          borderVisible: true,\n          scaleMargins: {\n            top: showVolume ? 0.1 : 0,\n            bottom: showVolume ? 0.15 : 0,\n          },\n        },\n        timeScale: {\n          borderColor: chartColors.grid,\n          timeVisible: true,\n          secondsVisible: false,\n          barSpacing: 6,\n          minBarSpacing: 2,\n        },\n        handleScroll: {\n          vertTouchDrag: true,\n        },\n        handleScale: {\n          axisPressedMouseMove: true,\n          mouseWheel: true,\n          pinch: true,\n        },\n      })\n\n      chartRef.current = chart\n\n      const chartAny = chart as unknown as any\n\n      let mainSeries: ISeriesApi<any>\n\n      if (chartType === 'candlestick') {\n        mainSeries = chartAny.addCandlestickSeries({\n          upColor: chartColors.upColor,\n          downColor: chartColors.downColor,\n          borderVisible: false,\n          wickUpColor: chartColors.wickUpColor,\n          wickDownColor: chartColors.wickDownColor,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            open: d.open,\n            high: d.high,\n            low: d.low,\n            close: d.close,\n          }))\n        )\n      } else if (chartType === 'line') {\n        mainSeries = chartAny.addLineSeries({\n          color: '#3b82f6',\n          lineWidth: 2,\n          priceFormat: {\n            type: 'price',\n            precision: 2,\n            minMove: 0.01,\n          },\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.close,\n          }))\n        )\n      } else if (chartType === 'area') {\n        mainSeries = chartAny.addAreaSeries({\n          topColor: 'rgba(59, 130, 246, 0.5)',\n          bottomColor: 'rgba(59, 130, 246, 0.0)',\n          lineColor: '#3b82f6',\n          lineWidth: 2,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.close,\n          }))\n        )\n      } else if (chartType === 'bar') {\n        mainSeries = chartAny.addBarSeries({\n          upColor: chartColors.upColor,\n          downColor: chartColors.downColor,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            open: d.open,\n            high: d.high,\n            low: d.low,\n            close: d.close,\n          }))\n        )\n      } else {\n        mainSeries = chartAny.addHistogramSeries({\n          priceFormat: {\n            type: 'volume',\n            precision: 0,\n            separator: ',',\n          },\n          priceScaleId: '',\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.volume || 0,\n            color: d.close >= d.open ? chartColors.upColor : chartColors.downColor,\n          }))\n        )\n      }\n\n      if (showVolume && chartType !== 'histogram' && ohlcvData.some((d) => d.volume !== undefined)) {\n        const volumeSeries = chartAny.addHistogramSeries({\n          priceFormat: {\n            type: 'volume',\n            precision: 0,\n            separator: ',',\n          },\n          priceScaleId: 'volume',\n        })\n\n        volumeSeries.priceScale().applyOptions({\n          scaleMargins: {\n            top: 0.85,\n            bottom: 0,\n          },\n          borderVisible: false,\n        })\n\n        volumeSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.volume || 0,\n            color: d.close >= d.open ? chartColors.volumeUp : chartColors.volumeDown,\n          }))\n        )\n      }\n\n      if (indicatorResults) {\n        const times = ohlcvData.map(d => d.date as Time)\n\n        if (indicatorResults.sma20) {\n          const sma20Series = chartAny.addLineSeries({\n            color: chartColors.sma20Color,\n            lineWidth: 1,\n          })\n          sma20Series.setData(\n            indicatorResults.sma20.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.sma50) {\n          const sma50Series = chartAny.addLineSeries({\n            color: chartColors.sma50Color,\n            lineWidth: 1,\n          })\n          sma50Series.setData(\n            indicatorResults.sma50.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.sma200) {\n          const sma200Series = chartAny.addLineSeries({\n            color: chartColors.sma200Color,\n            lineWidth: 1,\n          })\n          sma200Series.setData(\n            indicatorResults.sma200.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.ema12) {\n          const ema12Series = chartAny.addLineSeries({\n            color: chartColors.ema12Color,\n            lineWidth: 1,\n          })\n          ema12Series.setData(\n            indicatorResults.ema12.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.ema26) {\n          const ema26Series = chartAny.addLineSeries({\n            color: chartColors.ema26Color,\n            lineWidth: 1,\n          })\n          ema26Series.setData(\n            indicatorResults.ema26.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.bollinger) {\n          const bb = indicatorResults.bollinger\n          const upperSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerUpperColor,\n            lineWidth: 1,\n          })\n          upperSeries.setData(\n            bb.upper.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n\n          const middleSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerMiddleColor,\n            lineWidth: 1,\n          })\n          middleSeries.setData(\n            bb.middle.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n\n          const lowerSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerLowerColor,\n            lineWidth: 1,\n          })\n          lowerSeries.setData(\n            bb.lower.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n      }\n\n      chart.timeScale().fitContent()\n\n      chart.subscribeCrosshairMove((param: MouseEventParams) => {\n        if (param.time && param.seriesData.size > 0) {\n          const time = param.time as string\n          const ohlcv = ohlcvData.find((d) => d.date === time)\n          if (ohlcv) {\n            const idx = ohlcvData.findIndex(d => d.date === time)\n            setCrosshairData({\n              time,\n              open: ohlcv.open,\n              high: ohlcv.high,\n              low: ohlcv.low,\n              close: ohlcv.close,\n              volume: ohlcv.volume || null,\n              sma20: indicatorResults?.sma20?.[idx] ?? null,\n              sma50: indicatorResults?.sma50?.[idx] ?? null,\n              sma200: indicatorResults?.sma200?.[idx] ?? null,\n              ema12: indicatorResults?.ema12?.[idx] ?? null,\n              ema26: indicatorResults?.ema26?.[idx] ?? null,\n              rsi: indicatorResults?.rsi?.[idx] ?? null,\n              macd: indicatorResults?.macd?.macd?.[idx] ?? null,\n              macdSignal: indicatorResults?.macd?.signal?.[idx] ?? null,\n              bollingerUpper: indicatorResults?.bollinger?.upper?.[idx] ?? null,\n              bollingerMiddle: indicatorResults?.bollinger?.middle?.[idx] ?? null,\n              bollingerLower: indicatorResults?.bollinger?.lower?.[idx] ?? null,\n            })\n          }\n        } else {\n          const lastIdx = ohlcvData.length - 1\n          if (lastIdx >= 0) {\n            setCrosshairData({\n              time: ohlcvData[lastIdx].date,\n              open: ohlcvData[lastIdx].open,\n              high: ohlcvData[lastIdx].high,\n              low: ohlcvData[lastIdx].low,\n              close: ohlcvData[lastIdx].close,\n              volume: ohlcvData[lastIdx].volume || null,\n              sma20: indicatorResults?.sma20?.[lastIdx] ?? null,\n              sma50: indicatorResults?.sma50?.[lastIdx] ?? null,\n              sma200: indicatorResults?.sma200?.[lastIdx] ?? null,\n              ema12: indicatorResults?.ema12?.[lastIdx] ?? null,\n              ema26: indicatorResults?.ema26?.[lastIdx] ?? null,\n              rsi: indicatorResults?.rsi?.[lastIdx] ?? null,\n              macd: indicatorResults?.macd?.macd?.[lastIdx] ?? null,\n              macdSignal: indicatorResults?.macd?.signal?.[lastIdx] ?? null,\n              bollingerUpper: indicatorResults?.bollinger?.upper?.[lastIdx] ?? null,\n              bollingerMiddle: indicatorResults?.bollinger?.middle?.[lastIdx] ?? null,\n              bollingerLower: indicatorResults?.bollinger?.lower?.[lastIdx] ?? null,\n            })\n          }\n        }\n      })\n\n      const handleResize = () => {\n        if (chartContainerRef.current && chartRef.current) {\n          chartRef.current.applyOptions({\n            width: chartContainerRef.current.clientWidth,\n          })\n        }\n      }\n\n      window.addEventListener('resize', handleResize)\n\n      setLoading(false)\n    } catch (err) {\n      console.error('Failed to load chart data:', err)\n      setError(err instanceof Error ? err.message : 'Failed to load chart data')\n      setLoading(false)\n    }\n  }, [symbol, chartType, timeframe, height, showVolume, showIndicators, indicatorConfig, chartColors, indicatorResults])\n\n  useEffect(() => {\n    loadData()\n  }, [loadData])\n\n  const handleRetry = () => {\n    setRetryCount((prev) => prev + 1)\n    loadData()\n  }\n\n  const latestData = currentData[currentData.length - 1]\n  const previousClose = currentData[currentData.length - 2]?.close\n  const priceChange = latestData && previousClose ? latestData.close - previousClose : null\n  const priceChangePercent = priceChange && previousClose ? (priceChange / previousClose) * 100 : null\n\n  const formatValue = (value: number | null | undefined) => {\n    if (value === null || value === undefined || isNaN(value)) return '--'\n    return value.toFixed(2)\n  }\n\n  const activeIndicatorsCount = showIndicators.filter(ind =>\n    ['sma20', 'sma50', 'sma200', 'ema12', 'ema26', 'rsi', 'macd', 'bollinger'].includes(ind)\n  ).length\n\n  if (loading) {\n    return (\n      <div className=\"w-full rounded-lg border bg-card\" style={{ height: responsiveHeight }}>\n        <div className=\"p-4 border-b space-y-3\">\n          <Skeleton className=\"h-6 w-32\" />\n          <div className=\"flex gap-4 flex-wrap\">\n            <Skeleton className=\"h-4 w-16 sm:w-20\" />\n            <Skeleton className=\"h-4 w-16 sm:w-20\" />\n            <Skeleton className=\"h-4 w-16 sm:w-20\" />\n            <Skeleton className=\"h-4 w-16 sm:w-20\" />\n          </div>\n        </div>\n        <Skeleton className=\"w-full h-[calc(100%-80px)] rounded-none\" />\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"w-full rounded-lg border bg-card flex flex-col items-center justify-center\" style={{ height }}>\n        <AlertTriangle className=\"h-12 w-12 text-destructive mb-4\" />\n        <p className=\"text-destructive font-medium mb-2\">Failed to load chart data</p>\n        <p className=\"text-sm text-muted-foreground mb-4\">{error}</p>\n        <Button onClick={handleRetry} variant=\"outline\" size=\"sm\">\n          <RefreshCw className=\"h-4 w-4 mr-2\" />\n          Retry\n        </Button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full rounded-lg border bg-card overflow-hidden\">\n      <div className=\"p-3 border-b bg-muted/30\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <span className=\"font-bold text-lg\">{symbol}</span>\n            <Badge variant={priceChangePercent !== null && priceChangePercent >= 0 ? 'default' : 'destructive'} className={priceChangePercent !== null && priceChangePercent >= 0 ? 'bg-green-500' : ''}>\n              {priceChangePercent !== null ? (\n                <>\n                  {priceChangePercent >= 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : <TrendingDown className=\"h-3 w-3 mr-1\" />}\n                  {priceChangePercent >= 0 ? '+' : ''}{priceChangePercent.toFixed(2)}%\n                </>\n              ) : '--'}\n            </Badge>\n            {activeIndicatorsCount > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {activeIndicatorsCount} indicator{activeIndicatorsCount > 1 ? 's' : ''}\n              </Badge>\n            )}\n          </div>\n          <div className=\"flex items-center gap-3 text-sm flex-wrap\">\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-muted-foreground\">O:</span>\n              <span className=\"font-mono\">{formatValue(crosshairData.open)}</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-muted-foreground\">H:</span>\n              <span className=\"font-mono text-green-500\">{formatValue(crosshairData.high)}</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-muted-foreground\">L:</span>\n              <span className=\"font-mono text-red-500\">{formatValue(crosshairData.low)}</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-muted-foreground\">C:</span>\n              <span className=\"font-mono\">{formatValue(crosshairData.close)}</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-muted-foreground\">Vol:</span>\n              <span className=\"font-mono\">\n                {crosshairData.volume ? (crosshairData.volume / 1000000).toFixed(2) + 'M' : '--'}\n              </span>\n            </div>\n\n            {showSMA20 && crosshairData.sma20 !== null && (\n              <TooltipProvider>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <div className=\"flex items-center gap-1 cursor-help\">\n                      <span className=\"w-2 h-0.5 bg-blue-500\" />\n                      <span className=\"font-mono text-blue-500\">{formatValue(crosshairData.sma20)}</span>\n                    </div>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p className=\"font-medium\">{INDICATOR_DESCRIPTIONS.sma20.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">{INDICATOR_DESCRIPTIONS.sma20.description}</p>\n                  </TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            )}\n\n            {showSMA50 && crosshairData.sma50 !== null && (\n              <div className=\"flex items-center gap-1\">\n                <span className=\"w-2 h-0.5 bg-green-500\" />\n                <span className=\"font-mono text-green-500\">{formatValue(crosshairData.sma50)}</span>\n              </div>\n            )}\n\n            {showBollinger && crosshairData.bollingerUpper !== null && (\n              <div className=\"flex items-center gap-1\">\n                <span className=\"font-mono text-gray-400\">{formatValue(crosshairData.bollingerLower)}</span>\n                <span className=\"text-muted-foreground\">-</span>\n                <span className=\"font-mono text-gray-400\">{formatValue(crosshairData.bollingerUpper)}</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n      <div ref={chartContainerRef} className=\"w-full\" style={{ height: height - (showRSI || showMACD ? 250 : 0) - 60 }} />\n      {(showRSI || showMACD) && indicatorResults && (\n        <TechnicalIndicatorsPanel\n          data={currentData}\n          showRSI={showRSI}\n          showMACD={showMACD}\n          rsiPeriod={indicatorConfig.rsiPeriod}\n          rsiOverbought={indicatorConfig.rsiOverbought}\n          rsiOversold={indicatorConfig.rsiOversold}\n          macdFast={indicatorConfig.macdFast}\n          macdSlow={indicatorConfig.macdSlow}\n          macdSignal={indicatorConfig.macdSignal}\n          height={220}\n        />\n      )}\n      <div className=\"p-2 border-t bg-muted/20 text-xs text-center text-muted-foreground\">\n        {currentData.length} data points • {timeframe} timeframe • Data by Polygon.io\n        {activeIndicatorsCount > 0 && (\n          <span className=\"ml-2\">\n            • Active: {showIndicators.filter(i => ['sma20', 'sma50', 'sma200', 'ema12', 'ema26', 'rsi', 'macd', 'bollinger'].includes(i)).join(', ')}\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { cn } from '@/lib/utils'\n\ninterface ScreenReaderData {\n  label: string\n  value: string | number\n  description?: string\n}\n\ninterface ScreenReaderTableProps {\n  title: string\n  description?: string\n  data: ScreenReaderData[][]\n  caption?: string\n  className?: string\n}\n\nexport function ScreenReaderTable({\n  title,\n  description,\n  data,\n  caption,\n  className,\n}: ScreenReaderTableProps) {\n  if (!data || data.length === 0) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"region\"\n      aria-label={title}\n      aria-description={description}\n      className={cn('sr-only', className)}\n      tabIndex={-1}\n    >\n      <table>\n        {caption && <caption className=\"sr-only\">{caption}</caption>}\n        <thead>\n          {data[0] && (\n            <tr>\n              {data[0].map((cell, index) => (\n                <th key={index} scope=\"col\">\n                  {cell.label}\n                </th>\n              ))}\n            </tr>\n          )}\n        </thead>\n        <tbody>\n          {data.slice(1).map((row, rowIndex) => (\n            <tr key={rowIndex}>\n              {row.map((cell, cellIndex) => (\n                <td key={cellIndex}>\n                  {cell.description ? (\n                    <span aria-label={`${cell.label}, ${cell.description}, ${cell.value}`}>\n                      {cell.value}\n                    </span>\n                  ) : (\n                    cell.value\n                  )}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\ninterface ScreenReaderSummaryProps {\n  title: string\n  summary: {\n    label: string\n    value: string | number\n  }[]\n}\n\nexport function ScreenReaderSummary({ title, summary }: ScreenReaderSummaryProps) {\n  if (!summary || summary.length === 0) {\n    return null\n  }\n\n  return (\n    <div role=\"region\" aria-label={title} className=\"sr-only\" tabIndex={-1}>\n      <h3>{title}</h3>\n      <ul>\n        {summary.map((item, index) => (\n          <li key={index}>\n            {item.label}: {item.value}\n          </li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\ninterface ChartScreenReaderProps {\n  chartTitle: string\n  chartDescription: string\n  currentValue?: string | number\n  change?: string | number\n  changePercent?: string | number\n  timeframe?: string\n  data?: ScreenReaderData[][]\n  summary?: {\n    label: string\n    value: string | number\n  }[]\n}\n\nexport function ChartScreenReader({\n  chartTitle,\n  chartDescription,\n  currentValue,\n  change,\n  changePercent,\n  timeframe,\n  data,\n  summary,\n}: ChartScreenReaderProps) {\n  const parts: string[] = []\n\n  if (currentValue !== undefined) {\n    parts.push(`Current value: ${currentValue}`)\n  }\n  if (change !== undefined) {\n    parts.push(`Change: ${change}`)\n  }\n  if (changePercent !== undefined) {\n    parts.push(`Change percent: ${changePercent}`)\n  }\n  if (timeframe) {\n    parts.push(`Timeframe: ${timeframe}`)\n  }\n\n  return (\n    <div className=\"sr-only\">\n      <h2>{chartTitle}</h2>\n      <p>{chartDescription}</p>\n      {parts.length > 0 && (\n        <section aria-label=\"Current values\">\n          <ul>\n            {parts.map((part, index) => (\n              <li key={index}>{part}</li>\n            ))}\n          </ul>\n        </section>\n      )}\n      {summary && <ScreenReaderSummary title=\"Summary statistics\" summary={summary} />}\n      {data && <ScreenReaderTable title=\"Chart data\" data={data} />}\n    </div>\n  )\n}\n\nexport default ScreenReaderTable\n","'use client'\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  ColorType,\n  CrosshairMode,\n  Time,\n  MouseEventParams,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { assetsApi } from '@/lib/api/assets'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuCheckboxItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport {\n  Download,\n  RefreshCw,\n  AlertTriangle,\n  TrendingUp,\n  TrendingDown,\n  Settings2,\n  Undo,\n  Minus,\n  TrendingUp as TrendLineIcon,\n  Square,\n  Type,\n  Activity,\n  Camera,\n  FileImage,\n  FileText,\n} from 'lucide-react'\nimport { TechnicalIndicatorsPanel } from './TechnicalIndicatorsPanel'\nimport { IndicatorConfig, calculateAllIndicators, INDICATOR_DESCRIPTIONS } from '@/lib/utils/technical-indicators'\nimport { useRealtimeStore } from '@/stores/realtimeStore'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\nimport { HelpCircle } from 'lucide-react'\nimport { useDownloadFile } from '@/hooks/useDownload'\nimport { cn } from '@/lib/utils'\nimport { ChartScreenReader } from './ScreenReaderChart'\n\nexport type ChartType = 'candlestick' | 'line' | 'area' | 'bar' | 'histogram'\nexport type Timeframe = '1m' | '5m' | '15m' | '1h' | '4h' | '1d' | '1w' | '1M'\nexport type DrawingType = 'horizontal_line' | 'vertical_line' | 'trend_line' | 'fibonacci' | 'rectangle' | 'text'\n\nexport interface Drawing {\n  id: string\n  type: DrawingType\n  startTime: Time\n  startValue: number\n  endTime?: Time\n  endValue?: number\n  color: string\n  width: number\n  text?: string\n  visible: boolean\n}\n\ninterface AdvancedChartProps {\n  symbol: string\n  chartType?: ChartType\n  timeframe?: Timeframe\n  height?: number\n  showVolume?: boolean\n  showIndicators?: string[]\n  indicatorConfig?: IndicatorConfig\n  enableDrawingTools?: boolean\n  onTimeframeChange?: (tf: Timeframe) => void\n  onSymbolChange?: (symbol: string) => void\n  onIndicatorChange?: (indicator: string, enabled: boolean) => void\n  onDrawingCreate?: (drawing: Drawing) => void\n}\n\nexport interface OHLCVData {\n  date: string\n  open: number\n  high: number\n  low: number\n  close: number\n  volume?: number\n}\n\ninterface CrosshairData {\n  time: string | null\n  open: number | null\n  high: number | null\n  low: number | null\n  close: number | null\n  volume: number | null\n  sma20?: number | null\n  sma50?: number | null\n  sma200?: number | null\n  ema12?: number | null\n  ema26?: number | null\n  rsi?: number | null\n  macd?: number | null\n  macdSignal?: number | null\n  bollingerUpper?: number | null\n  bollingerMiddle?: number | null\n  bollingerLower?: number | null\n}\n\nconst TIMEFRAMES: { value: Timeframe; label: string; hotkey: string }[] = [\n  { value: '1m', label: '1m', hotkey: '1' },\n  { value: '5m', label: '5m', hotkey: '2' },\n  { value: '15m', label: '15m', hotkey: '3' },\n  { value: '1h', label: '1H', hotkey: '4' },\n  { value: '4h', label: '4H', hotkey: '5' },\n  { value: '1d', label: '1D', hotkey: '6' },\n  { value: '1w', label: '1W', hotkey: '7' },\n  { value: '1M', label: '1M', hotkey: '8' },\n]\n\nconst CHART_TYPES: { value: ChartType; label: string; hotkey: string }[] = [\n  { value: 'candlestick', label: 'Candlestick', hotkey: 'c' },\n  { value: 'line', label: 'Line', hotkey: 'l' },\n  { value: 'area', label: 'Area', hotkey: 'a' },\n  { value: 'bar', label: 'Bar', hotkey: 'b' },\n  { value: 'histogram', label: 'Histogram', hotkey: 'h' },\n]\n\nexport function AdvancedChart({\n  symbol,\n  chartType = 'candlestick',\n  timeframe = '1d',\n  height = 500,\n  showVolume = true,\n  showIndicators = [],\n  indicatorConfig = {},\n  enableDrawingTools = false,\n  onTimeframeChange,\n  onSymbolChange,\n  onIndicatorChange,\n  onDrawingCreate,\n}: AdvancedChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const { theme } = useTheme()\n  const { prices } = useRealtimeStore()\n  const { downloadCSV, downloadText } = useDownloadFile()\n  \n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [currentData, setCurrentData] = useState<OHLCVData[]>([])\n  const [crosshairData, setCrosshairData] = useState<CrosshairData>({\n    time: null,\n    open: null,\n    high: null,\n    low: null,\n    close: null,\n    volume: null,\n  })\n  const [retryCount, setRetryCount] = useState(0)\n  const [selectedDrawingTool, setSelectedDrawingTool] = useState<DrawingType | null>(null)\n  const [drawings, setDrawings] = useState<Drawing[]>([])\n  const [isExporting, setIsExporting] = useState(false)\n\n  const isDark = theme === 'dark'\n\n  const chartColors = useMemo(() => ({\n    background: isDark ? '#0f172a' : '#ffffff',\n    text: isDark ? '#94a3b8' : '#64748b',\n    grid: isDark ? '#1e293b' : '#e2e8f0',\n    upColor: '#22c55e',\n    downColor: '#ef4444',\n    wickUpColor: '#22c55e',\n    wickDownColor: '#ef4444',\n    volumeUp: isDark ? 'rgba(34, 197, 94, 0.3)' : 'rgba(34, 197, 94, 0.2)',\n    volumeDown: isDark ? 'rgba(239, 68, 68, 0.3)' : 'rgba(239, 68, 68, 0.2)',\n    crosshairLine: isDark ? 'rgba(148, 163, 184, 0.3)' : 'rgba(100, 116, 139, 0.3)',\n    sma20Color: '#3b82f6',\n    sma50Color: '#22c55e',\n    sma200Color: '#f59e0b',\n    ema12Color: '#8b5cf6',\n    ema26Color: '#ec4899',\n    bollingerUpperColor: '#94a3b8',\n    bollingerMiddleColor: '#64748b',\n    bollingerLowerColor: '#94a3b8',\n  }), [isDark])\n\n  const showRSI = showIndicators.includes('rsi')\n  const showMACD = showIndicators.includes('macd')\n  const showSMA20 = showIndicators.includes('sma20')\n  const showSMA50 = showIndicators.includes('sma50')\n  const showSMA200 = showIndicators.includes('sma200')\n  const showEMA12 = showIndicators.includes('ema12')\n  const showEMA26 = showIndicators.includes('ema26')\n  const showBollinger = showIndicators.includes('bollinger')\n\n  const indicatorResults = useMemo(() => {\n    if (currentData.length === 0) return null\n    const config: IndicatorConfig = {\n      sma20: showSMA20,\n      sma50: showSMA50,\n      sma200: showSMA200,\n      ema12: showEMA12,\n      ema26: showEMA26,\n      rsi: showRSI,\n      macd: showMACD,\n      bollinger: showBollinger,\n      rsiPeriod: indicatorConfig.rsiPeriod,\n      rsiOverbought: indicatorConfig.rsiOverbought,\n      rsiOversold: indicatorConfig.rsiOversold,\n      macdFast: indicatorConfig.macdFast,\n      macdSlow: indicatorConfig.macdSlow,\n      macdSignal: indicatorConfig.macdSignal,\n      bollingerPeriod: indicatorConfig.bollingerPeriod,\n      bollingerStdDev: indicatorConfig.bollingerStdDev,\n    }\n    return calculateAllIndicators(currentData, config)\n  }, [currentData, showSMA20, showSMA50, showSMA200, showEMA12, showEMA26, showRSI, showMACD, showBollinger, indicatorConfig])\n\n  const loadData = useCallback(async () => {\n    if (!chartContainerRef.current) return\n\n    setLoading(true)\n    setError(null)\n\n    try {\n      const interval = timeframe === '1d' ? '1d' : timeframe === '1w' ? '1wk' : timeframe === '1M' ? '1mo' : '1d'\n      const history = await assetsApi.getHistorical(symbol, undefined, undefined, interval)\n\n      if (!history || history.length === 0) {\n        setError('No data available for this symbol')\n        setLoading(false)\n        return\n      }\n\n      const ohlcvData: OHLCVData[] = history.map((d) => ({\n        date: d.timestamp instanceof Date ? d.timestamp.toISOString() : new Date(d.timestamp).toISOString(),\n        open: d.open,\n        high: d.high,\n        low: d.low,\n        close: d.close,\n        volume: d.volume,\n      }))\n\n      setCurrentData(ohlcvData)\n      setRetryCount(0)\n\n      if (chartRef.current) {\n        chartRef.current.remove()\n      }\n\n      const chart = createChart(chartContainerRef.current, {\n        width: chartContainerRef.current.clientWidth,\n        height: height - (showRSI || showMACD ? 250 : 0) - 60,\n        layout: {\n          background: { type: ColorType.Solid, color: chartColors.background },\n          textColor: chartColors.text,\n        },\n        grid: {\n          vertLines: { color: chartColors.grid, style: 2 },\n          horzLines: { color: chartColors.grid, style: 2 },\n        },\n        crosshair: {\n          mode: CrosshairMode.Normal,\n          vertLine: {\n            width: 1,\n            color: chartColors.crosshairLine,\n            style: 2,\n          },\n          horzLine: {\n            width: 1,\n            color: chartColors.crosshairLine,\n            style: 2,\n          },\n        },\n        rightPriceScale: {\n          borderColor: chartColors.grid,\n          borderVisible: true,\n          scaleMargins: {\n            top: showVolume ? 0.1 : 0,\n            bottom: showVolume ? 0.15 : 0,\n          },\n        },\n        timeScale: {\n          borderColor: chartColors.grid,\n          timeVisible: true,\n          secondsVisible: false,\n          barSpacing: 6,\n          minBarSpacing: 2,\n        },\n        handleScroll: {\n          vertTouchDrag: true,\n        },\n        handleScale: {\n          axisPressedMouseMove: true,\n          mouseWheel: true,\n          pinch: true,\n        },\n      })\n\n      chartRef.current = chart\n\n      const chartAny = chart as unknown as any\n\n      let mainSeries: ISeriesApi<'Candlestick' | 'Line' | 'Area' | 'Bar'>\n\n      if (chartType === 'candlestick') {\n        mainSeries = chartAny.addCandlestickSeries({\n          upColor: chartColors.upColor,\n          downColor: chartColors.downColor,\n          borderVisible: false,\n          wickUpColor: chartColors.wickUpColor,\n          wickDownColor: chartColors.wickDownColor,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            open: d.open,\n            high: d.high,\n            low: d.low,\n            close: d.close,\n          }))\n        )\n      } else if (chartType === 'line') {\n        mainSeries = chartAny.addLineSeries({\n          color: '#3b82f6',\n          lineWidth: 2,\n          priceFormat: {\n            type: 'price',\n            precision: 2,\n            minMove: 0.01,\n          },\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.close,\n          }))\n        )\n      } else if (chartType === 'area') {\n        mainSeries = chartAny.addAreaSeries({\n          topColor: 'rgba(59, 130, 246, 0.5)',\n          bottomColor: 'rgba(59, 130, 246, 0.0)',\n          lineColor: '#3b82f6',\n          lineWidth: 2,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.close,\n          }))\n        )\n      } else if (chartType === 'bar') {\n        mainSeries = chartAny.addBarSeries({\n          upColor: chartColors.upColor,\n          downColor: chartColors.downColor,\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            open: d.open,\n            high: d.high,\n            low: d.low,\n            close: d.close,\n          }))\n        )\n      } else {\n        mainSeries = chartAny.addHistogramSeries({\n          priceFormat: {\n            type: 'volume',\n            precision: 0,\n            separator: ',',\n          },\n          priceScaleId: '',\n        })\n\n        mainSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.volume || 0,\n            color: d.close >= d.open ? chartColors.upColor : chartColors.downColor,\n          }))\n        )\n      }\n\n      if (showVolume && chartType !== 'histogram' && ohlcvData.some((d) => d.volume !== undefined)) {\n        const volumeSeries = chartAny.addHistogramSeries({\n          priceFormat: {\n            type: 'volume',\n            precision: 0,\n            separator: ',',\n          },\n          priceScaleId: 'volume',\n        })\n\n        volumeSeries.priceScale().applyOptions({\n          scaleMargins: {\n            top: 0.85,\n            bottom: 0,\n          },\n          borderVisible: false,\n        })\n\n        volumeSeries.setData(\n          ohlcvData.map((d) => ({\n            time: d.date as Time,\n            value: d.volume || 0,\n            color: d.close >= d.open ? chartColors.volumeUp : chartColors.volumeDown,\n          }))\n        )\n      }\n\n      if (indicatorResults) {\n        const times = ohlcvData.map(d => d.date as Time)\n\n        if (indicatorResults.sma20) {\n          const sma20Series = chartAny.addLineSeries({\n            color: chartColors.sma20Color,\n            lineWidth: 1,\n          })\n          sma20Series.setData(\n            indicatorResults.sma20.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.sma50) {\n          const sma50Series = chartAny.addLineSeries({\n            color: chartColors.sma50Color,\n            lineWidth: 1,\n          })\n          sma50Series.setData(\n            indicatorResults.sma50.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.sma200) {\n          const sma200Series = chartAny.addLineSeries({\n            color: chartColors.sma200Color,\n            lineWidth: 1,\n          })\n          sma200Series.setData(\n            indicatorResults.sma200.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.ema12) {\n          const ema12Series = chartAny.addLineSeries({\n            color: chartColors.ema12Color,\n            lineWidth: 1,\n          })\n          ema12Series.setData(\n            indicatorResults.ema12.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.ema26) {\n          const ema26Series = chartAny.addLineSeries({\n            color: chartColors.ema26Color,\n            lineWidth: 1,\n          })\n          ema26Series.setData(\n            indicatorResults.ema26.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n\n        if (indicatorResults.bollinger) {\n          const bb = indicatorResults.bollinger\n          const upperSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerUpperColor,\n            lineWidth: 1,\n          })\n          upperSeries.setData(\n            bb.upper.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n\n          const middleSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerMiddleColor,\n            lineWidth: 1,\n          })\n          middleSeries.setData(\n            bb.middle.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n\n          const lowerSeries = chartAny.addLineSeries({\n            color: chartColors.bollingerLowerColor,\n            lineWidth: 1,\n          })\n          lowerSeries.setData(\n            bb.lower.map((value, i) =>\n              isNaN(value) ? null : { time: times[i], value }\n            ).filter((v): v is { time: Time; value: number } => v !== null)\n          )\n        }\n      }\n\n      chart.timeScale().fitContent()\n\n      chart.subscribeCrosshairMove((param: MouseEventParams) => {\n        if (param.time && param.seriesData.size > 0) {\n          const time = param.time as string\n          const ohlcv = ohlcvData.find((d) => d.date === time)\n          if (ohlcv) {\n            const idx = ohlcvData.findIndex(d => d.date === time)\n            setCrosshairData({\n              time,\n              open: ohlcv.open,\n              high: ohlcv.high,\n              low: ohlcv.low,\n              close: ohlcv.close,\n              volume: ohlcv.volume || null,\n              sma20: indicatorResults?.sma20?.[idx] ?? null,\n              sma50: indicatorResults?.sma50?.[idx] ?? null,\n              sma200: indicatorResults?.sma200?.[idx] ?? null,\n              ema12: indicatorResults?.ema12?.[idx] ?? null,\n              ema26: indicatorResults?.ema26?.[idx] ?? null,\n              rsi: indicatorResults?.rsi?.[idx] ?? null,\n              macd: indicatorResults?.macd?.macd?.[idx] ?? null,\n              macdSignal: indicatorResults?.macd?.signal?.[idx] ?? null,\n              bollingerUpper: indicatorResults?.bollinger?.upper?.[idx] ?? null,\n              bollingerMiddle: indicatorResults?.bollinger?.middle?.[idx] ?? null,\n              bollingerLower: indicatorResults?.bollinger?.lower?.[idx] ?? null,\n            })\n          }\n        } else {\n          const lastIdx = ohlcvData.length - 1\n          if (lastIdx >= 0) {\n            setCrosshairData({\n              time: ohlcvData[lastIdx].date,\n              open: ohlcvData[lastIdx].open,\n              high: ohlcvData[lastIdx].high,\n              low: ohlcvData[lastIdx].low,\n              close: ohlcvData[lastIdx].close,\n              volume: ohlcvData[lastIdx].volume || null,\n              sma20: indicatorResults?.sma20?.[lastIdx] ?? null,\n              sma50: indicatorResults?.sma50?.[lastIdx] ?? null,\n              sma200: indicatorResults?.sma200?.[lastIdx] ?? null,\n              ema12: indicatorResults?.ema12?.[lastIdx] ?? null,\n              ema26: indicatorResults?.ema26?.[lastIdx] ?? null,\n              rsi: indicatorResults?.rsi?.[lastIdx] ?? null,\n              macd: indicatorResults?.macd?.macd?.[lastIdx] ?? null,\n              macdSignal: indicatorResults?.macd?.signal?.[lastIdx] ?? null,\n              bollingerUpper: indicatorResults?.bollinger?.upper?.[lastIdx] ?? null,\n              bollingerMiddle: indicatorResults?.bollinger?.middle?.[lastIdx] ?? null,\n              bollingerLower: indicatorResults?.bollinger?.lower?.[lastIdx] ?? null,\n            })\n          }\n        }\n      })\n\n      const handleResize = () => {\n        if (chartContainerRef.current && chartRef.current) {\n          chartRef.current.applyOptions({\n            width: chartContainerRef.current.clientWidth,\n          })\n        }\n      }\n\n      window.addEventListener('resize', handleResize)\n\n      setLoading(false)\n    } catch (err) {\n      console.error('Failed to load chart data:', err)\n      setError(err instanceof Error ? err.message : 'Failed to load chart data')\n      setLoading(false)\n    }\n  }, [symbol, chartType, timeframe, height, showVolume, showIndicators, indicatorConfig, chartColors, indicatorResults])\n\n  useEffect(() => {\n    loadData()\n  }, [loadData])\n\n  const handleRetry = () => {\n    setRetryCount((prev) => prev + 1)\n    loadData()\n  }\n\n  const handleExportPNG = useCallback(async () => {\n    if (!chartRef.current) return\n    \n    setIsExporting(true)\n    try {\n      const canvas = (chartRef.current as unknown as IChartApi).takeScreenshot()\n      if (canvas) {\n        const filename = `${symbol}-${chartType}-${timeframe}-${new Date().toISOString().slice(0, 10)}.png`\n        const dataUrl = canvas.toDataURL('image/png')\n        downloadText(dataUrl, filename, 'image/png')\n      }\n    } catch (err) {\n      console.error('Failed to export chart:', err)\n    } finally {\n      setIsExporting(false)\n    }\n  }, [symbol, chartType, timeframe, downloadText])\n\n  const handleExportCSV = useCallback(() => {\n    if (currentData.length === 0) return\n    \n    const headers = 'Date,Open,High,Low,Close,Volume\\n'\n    const rows = currentData.map(d => \n      `${d.date},${d.open},${d.high},${d.low},${d.close},${d.volume || 0}`\n    ).join('\\n')\n    \n    const csv = headers + rows\n    const filename = `${symbol}-${chartType}-${timeframe}-${new Date().toISOString().slice(0, 10)}.csv`\n    downloadCSV(csv, filename)\n  }, [currentData, symbol, chartType, timeframe, downloadCSV])\n\n  const latestData = currentData[currentData.length - 1]\n  const previousClose = currentData[currentData.length - 2]?.close\n  const priceChange = latestData && previousClose ? latestData.close - previousClose : null\n  const priceChangePercent = priceChange && previousClose ? (priceChange / previousClose) * 100 : null\n\n  const formatValue = (value: number | null | undefined) => {\n    if (value === null || value === undefined || isNaN(value)) return '--'\n    return value.toFixed(2)\n  }\n\n  const activeIndicatorsCount = showIndicators.filter(ind =>\n    ['sma20', 'sma50', 'sma200', 'ema12', 'ema26', 'rsi', 'macd', 'bollinger'].includes(ind)\n  ).length\n\n  if (loading) {\n    return (\n      <div className=\"w-full rounded-lg border bg-card\" style={{ height }}>\n        <div className=\"p-4 border-b space-y-3\">\n          <Skeleton className=\"h-6 w-32\" />\n          <div className=\"flex gap-4\">\n            <Skeleton className=\"h-4 w-20\" />\n            <Skeleton className=\"h-4 w-20\" />\n            <Skeleton className=\"h-4 w-20\" />\n            <Skeleton className=\"h-4 w-20\" />\n          </div>\n        </div>\n        <Skeleton className=\"w-full h-[calc(100%-80px)] rounded-none\" />\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"w-full rounded-lg border bg-card flex flex-col items-center justify-center\" style={{ height }}>\n        <AlertTriangle className=\"h-12 w-12 text-destructive mb-4\" />\n        <p className=\"text-destructive font-medium mb-2\">Failed to load chart data</p>\n        <p className=\"text-sm text-muted-foreground mb-4\">{error}</p>\n        <Button onClick={handleRetry} variant=\"outline\" size=\"sm\">\n          <RefreshCw className=\"h-4 w-4 mr-2\" />\n          Retry\n        </Button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full rounded-lg border bg-card overflow-hidden\">\n      <ChartScreenReader\n        chartTitle={`${symbol} - ${CHART_TYPES.find(t => t.value === chartType)?.label} Chart`}\n        chartDescription={`Financial chart showing ${symbol} price movements on ${timeframe} timeframe`}\n        currentValue={latestData?.close}\n        change={priceChange ?? undefined}\n        changePercent={priceChangePercent ?? undefined}\n        timeframe={timeframe}\n        data={currentData.map(d => [\n          { label: 'Date', value: d.date },\n          { label: 'Open', value: d.open.toFixed(2) },\n          { label: 'High', value: d.high.toFixed(2) },\n          { label: 'Low', value: d.low.toFixed(2) },\n          { label: 'Close', value: d.close.toFixed(2) },\n          { label: 'Volume', value: (d.volume || 0).toLocaleString() },\n        ])}\n        summary={[\n          { label: 'Symbol', value: symbol },\n          { label: 'Chart Type', value: CHART_TYPES.find(t => t.value === chartType)?.label || chartType },\n          { label: 'Data Points', value: currentData.length.toString() },\n          { label: 'Latest Close', value: `$${latestData?.close.toFixed(2) || '--'}` },\n          { label: 'Change', value: priceChangePercent !== null ? `${priceChangePercent >= 0 ? '+' : ''}${priceChangePercent.toFixed(2)}%` : '--' },\n        ]}\n      />\n      <div className=\"p-3 border-b bg-muted/30 space-y-3\">\n        <div className=\"flex items-center justify-between flex-wrap gap-2\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-bold text-lg\">{symbol}</span>\n            <Badge variant={priceChangePercent !== null && priceChangePercent >= 0 ? 'default' : 'destructive'} className={priceChangePercent !== null && priceChangePercent >= 0 ? 'bg-green-500' : ''}>\n              {priceChangePercent !== null ? (\n                <>\n                  {priceChangePercent >= 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : <TrendingDown className=\"h-3 w-3 mr-1\" />}\n                  {priceChangePercent >= 0 ? '+' : ''}{priceChangePercent.toFixed(2)}%\n                </>\n              ) : '--'}\n            </Badge>\n            {activeIndicatorsCount > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {activeIndicatorsCount} indicator{activeIndicatorsCount > 1 ? 's' : ''}\n              </Badge>\n            )}\n            {drawings.length > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {drawings.length} drawing{drawings.length > 1 ? 's' : ''}\n              </Badge>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <div className=\"flex items-center gap-0.5 bg-muted rounded-md p-0.5\">\n              {TIMEFRAMES.map((tf) => (\n                <Button\n                  key={tf.value}\n                  variant={timeframe === tf.value ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  className=\"h-7 px-2 text-xs font-medium\"\n                  onClick={() => onTimeframeChange?.(tf.value)}\n                  title={`Press ${tf.hotkey}`}\n                >\n                  {tf.label}\n                </Button>\n              ))}\n            </div>\n\n            <Select\n              value={chartType}\n              onValueChange={(value) => {\n                const chartType = value as ChartType\n                // Handle chart type change\n              }}\n            >\n              <SelectTrigger className=\"h-8 w-36\">\n                <SelectValue>\n                  <span className=\"text-xs\">{CHART_TYPES.find((t) => t.value === chartType)?.label}</span>\n                </SelectValue>\n              </SelectTrigger>\n              <SelectContent>\n                {CHART_TYPES.map((type) => (\n                  <SelectItem key={type.value} value={type.value}>\n                    <span>{type.label}</span>\n                    <span className=\"text-xs text-muted-foreground ml-2\">({type.hotkey})</span>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Button\n              variant={showVolume ? 'default' : 'outline'}\n              size=\"sm\"\n              className=\"h-8 px-3\"\n            >\n              Vol\n            </Button>\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant={activeIndicatorsCount > 0 ? 'default' : 'outline'} size=\"sm\" className=\"h-8\">\n                  <Settings2 className=\"h-4 w-4 mr-1\" />\n                  <span className=\"text-xs\">Indicators</span>\n                  {activeIndicatorsCount > 0 && (\n                    <span className=\"ml-1 px-1.5 py-0.5 text-xs bg-primary text-primary-foreground rounded-full\">\n                      {activeIndicatorsCount}\n                    </span>\n                  )}\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuLabel>Technical Indicators</DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                {['sma20', 'sma50', 'sma200', 'ema12', 'ema26', 'rsi', 'macd', 'bollinger'].map((indicator) => (\n                  <DropdownMenuCheckboxItem\n                    key={indicator}\n                    checked={showIndicators.includes(indicator)}\n                    onCheckedChange={(checked) => onIndicatorChange?.(indicator, checked as boolean)}\n                  >\n                    {(INDICATOR_DESCRIPTIONS as any)[indicator]?.name || indicator}\n                  </DropdownMenuCheckboxItem>\n                ))}\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            {enableDrawingTools && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant={selectedDrawingTool ? 'default' : 'outline'} size=\"sm\" className=\"h-8\">\n                    <Type className=\"h-4 w-4 mr-1\" />\n                    <span className=\"text-xs\">Draw</span>\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-48\">\n                  <DropdownMenuLabel>Drawing Tools</DropdownMenuLabel>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === null}\n                    onCheckedChange={() => setSelectedDrawingTool(null)}\n                  >\n                    Select/Move\n                  </DropdownMenuCheckboxItem>\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === 'horizontal_line'}\n                    onCheckedChange={() => setSelectedDrawingTool('horizontal_line')}\n                  >\n                    <Minus className=\"h-4 w-4 mr-2\" />\n                    Horizontal Line\n                  </DropdownMenuCheckboxItem>\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === 'trend_line'}\n                    onCheckedChange={() => setSelectedDrawingTool('trend_line')}\n                  >\n                    <TrendLineIcon className=\"h-4 w-4 mr-2\" />\n                    Trend Line\n                  </DropdownMenuCheckboxItem>\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === 'fibonacci'}\n                    onCheckedChange={() => setSelectedDrawingTool('fibonacci')}\n                  >\n                    <Activity className=\"h-4 w-4 mr-2\" />\n                    Fibonacci\n                  </DropdownMenuCheckboxItem>\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === 'rectangle'}\n                    onCheckedChange={() => setSelectedDrawingTool('rectangle')}\n                  >\n                    <Square className=\"h-4 w-4 mr-2\" />\n                    Rectangle\n                  </DropdownMenuCheckboxItem>\n                  <DropdownMenuCheckboxItem\n                    checked={selectedDrawingTool === 'text'}\n                    onCheckedChange={() => setSelectedDrawingTool('text')}\n                  >\n                    <Type className=\"h-4 w-4 mr-2\" />\n                    Text\n                  </DropdownMenuCheckboxItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" className=\"h-8\" disabled={isExporting}>\n                  <Download className=\"h-4 w-4 mr-1\" />\n                  <span className=\"text-xs\">Export</span>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuLabel>Export Chart</DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuCheckboxItem onClick={handleExportPNG} disabled={isExporting}>\n                  <FileImage className=\"h-4 w-4 mr-2\" />\n                  Export as PNG\n                </DropdownMenuCheckboxItem>\n                <DropdownMenuCheckboxItem onClick={handleExportCSV} disabled={currentData.length === 0}>\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  Export Data as CSV\n                </DropdownMenuCheckboxItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 text-sm flex-wrap\">\n          <div className=\"flex items-center gap-1\">\n            <span className=\"text-muted-foreground\">O:</span>\n            <span className=\"font-mono\">{formatValue(crosshairData.open)}</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <span className=\"text-muted-foreground\">H:</span>\n            <span className=\"font-mono text-green-500\">{formatValue(crosshairData.high)}</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <span className=\"text-muted-foreground\">L:</span>\n            <span className=\"font-mono text-red-500\">{formatValue(crosshairData.low)}</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <span className=\"text-muted-foreground\">C:</span>\n            <span className=\"font-mono\">{formatValue(crosshairData.close)}</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <span className=\"text-muted-foreground\">Vol:</span>\n            <span className=\"font-mono\">\n              {crosshairData.volume ? (crosshairData.volume / 1000000).toFixed(2) + 'M' : '--'}\n            </span>\n          </div>\n\n          {showSMA20 && crosshairData.sma20 !== null && (\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <div className=\"flex items-center gap-1 cursor-help\">\n                    <span className=\"w-2 h-0.5 bg-blue-500\" />\n                    <span className=\"font-mono text-blue-500\">{formatValue(crosshairData.sma20)}</span>\n                  </div>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p className=\"font-medium\">{INDICATOR_DESCRIPTIONS.sma20.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">{INDICATOR_DESCRIPTIONS.sma20.description}</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          )}\n\n          {showSMA50 && crosshairData.sma50 !== null && (\n            <div className=\"flex items-center gap-1\">\n              <span className=\"w-2 h-0.5 bg-green-500\" />\n              <span className=\"font-mono text-green-500\">{formatValue(crosshairData.sma50)}</span>\n            </div>\n          )}\n\n          {showBollinger && crosshairData.bollingerUpper !== null && (\n            <div className=\"flex items-center gap-1\">\n              <span className=\"font-mono text-gray-400\">{formatValue(crosshairData.bollingerLower)}</span>\n              <span className=\"text-muted-foreground\">-</span>\n              <span className=\"font-mono text-gray-400\">{formatValue(crosshairData.bollingerUpper)}</span>\n            </div>\n          )}\n        </div>\n      </div>\n      \n      <div ref={chartContainerRef} className=\"w-full\" style={{ height: height - (showRSI || showMACD ? 250 : 0) - 60 }} />\n      \n      {(showRSI || showMACD) && indicatorResults && (\n        <TechnicalIndicatorsPanel\n          data={currentData}\n          showRSI={showRSI}\n          showMACD={showMACD}\n          rsiPeriod={indicatorConfig.rsiPeriod}\n          rsiOverbought={indicatorConfig.rsiOverbought}\n          rsiOversold={indicatorConfig.rsiOversold}\n          macdFast={indicatorConfig.macdFast}\n          macdSlow={indicatorConfig.macdSlow}\n          macdSignal={indicatorConfig.macdSignal}\n          height={220}\n        />\n      )}\n      \n      <div className=\"p-2 border-t bg-muted/20 text-xs text-center text-muted-foreground\">\n        {currentData.length} data points • {timeframe} timeframe • Data by Polygon.io\n        {activeIndicatorsCount > 0 && (\n          <span className=\"ml-2\">\n            • Active: {showIndicators.filter(i => ['sma20', 'sma50', 'sma200', 'ema12', 'ema26', 'rsi', 'macd', 'bollinger'].includes(i)).join(', ')}\n          </span>\n        )}\n        {drawings.length > 0 && (\n          <span className=\"ml-2\">\n            • {drawings.length} drawing{drawings.length > 1 ? 's' : ''}\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect, KeyboardEvent } from 'react'\nimport { Button } from '@/components/ui/button'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuCheckboxItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport { Input } from '@/components/ui/input'\nimport {\n  BarChart3,\n  LineChart,\n  TrendingUp,\n  GripHorizontal,\n  CandlestickChart,\n  Activity,\n  Settings2,\n  Search,\n  Plus,\n  X,\n  Star,\n  Clock,\n  Settings,\n} from 'lucide-react'\nimport type { ChartType, Timeframe } from './TradingViewChart'\nimport { IndicatorConfig } from '@/lib/utils/technical-indicators'\n\ninterface ChartControlsProps {\n  symbol: string\n  currentTimeframe: Timeframe\n  currentType: ChartType\n  showVolume?: boolean\n  showIndicators?: string[]\n  indicatorConfig?: IndicatorConfig\n  availableIndicators?: string[]\n  activeIndicators?: string[]\n  onSymbolChange?: (symbol: string) => void\n  onTimeframeChange?: (tf: Timeframe) => void\n  onTypeChange?: (type: ChartType) => void\n  onVolumeToggle?: (show: boolean) => void\n  onIndicatorToggle?: (indicator: string, show: boolean) => void\n  onIndicatorConfigChange?: (config: IndicatorConfig) => void\n  onOpenIndicatorSettings?: () => void\n}\n\nconst TIMEFRAMES: { value: Timeframe; label: string; hotkey: string }[] = [\n  { value: '1m', label: '1m', hotkey: '1' },\n  { value: '5m', label: '5m', hotkey: '2' },\n  { value: '15m', label: '15m', hotkey: '3' },\n  { value: '1h', label: '1H', hotkey: '4' },\n  { value: '4h', label: '4H', hotkey: '5' },\n  { value: '1d', label: '1D', hotkey: '6' },\n  { value: '1w', label: '1W', hotkey: '7' },\n  { value: '1M', label: '1M', hotkey: '8' },\n]\n\nconst CHART_TYPES: { value: ChartType; label: string; icon: React.ReactNode; hotkey: string }[] = [\n  { value: 'candlestick', label: 'Candlestick', icon: <CandlestickChart className=\"h-4 w-4\" />, hotkey: 'c' },\n  { value: 'line', label: 'Line', icon: <LineChart className=\"h-4 w-4\" />, hotkey: 'l' },\n  { value: 'area', label: 'Area', icon: <TrendingUp className=\"h-4 w-4\" />, hotkey: 'a' },\n  { value: 'bar', label: 'Bar', icon: <GripHorizontal className=\"h-4 w-4\" />, hotkey: 'b' },\n]\n\nconst AVAILABLE_INDICATORS = [\n  { id: 'sma20', label: 'SMA 20', category: 'Moving Averages' },\n  { id: 'sma50', label: 'SMA 50', category: 'Moving Averages' },\n  { id: 'sma200', label: 'SMA 200', category: 'Moving Averages' },\n  { id: 'ema12', label: 'EMA 12', category: 'Moving Averages' },\n  { id: 'ema26', label: 'EMA 26', category: 'Moving Averages' },\n  { id: 'rsi', label: 'RSI 14', category: 'Oscillators' },\n  { id: 'macd', label: 'MACD', category: 'Oscillators' },\n  { id: 'bollinger', label: 'Bollinger Bands', category: 'Volatility' },\n]\n\nconst POPULAR_SYMBOLS = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA', 'JPM', 'BTC', 'ETH']\n\nconst RECENT_SYMBOLS_KEY = 'financehub_recent_symbols'\n\nexport function ChartControls({\n  symbol,\n  currentTimeframe,\n  currentType,\n  showVolume = true,\n  showIndicators = [],\n  indicatorConfig = {},\n  availableIndicators = [],\n  activeIndicators = [],\n  onSymbolChange,\n  onTimeframeChange,\n  onTypeChange,\n  onVolumeToggle,\n  onIndicatorToggle,\n  onIndicatorConfigChange,\n  onOpenIndicatorSettings,\n}: ChartControlsProps) {\n  const [symbolInput, setSymbolInput] = useState(symbol)\n  const [recentSymbols, setRecentSymbols] = useState<string[]>([])\n  const [isSearching, setIsSearching] = useState(false)\n\n  useEffect(() => {\n    const saved = localStorage.getItem(RECENT_SYMBOLS_KEY)\n    if (saved) {\n      try {\n        setRecentSymbols(JSON.parse(saved))\n      } catch {\n        setRecentSymbols([])\n      }\n    }\n  }, [])\n\n  const handleSymbolSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    if (symbolInput.trim()) {\n      const newSymbol = symbolInput.toUpperCase().trim()\n      onSymbolChange?.(newSymbol)\n      addToRecent(newSymbol)\n      setSymbolInput(newSymbol)\n      setIsSearching(false)\n    }\n  }\n\n  const handleSymbolSelect = (sym: string) => {\n    onSymbolChange?.(sym)\n    addToRecent(sym)\n    setSymbolInput(sym)\n    setIsSearching(false)\n  }\n\n  const addToRecent = (sym: string) => {\n    setRecentSymbols((prev) => {\n      const filtered = prev.filter((s) => s !== sym)\n      const updated = [sym, ...filtered].slice(0, 10)\n      localStorage.setItem(RECENT_SYMBOLS_KEY, JSON.stringify(updated))\n      return updated\n    })\n  }\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Escape') {\n      setIsSearching(false)\n    }\n  }\n\n  useEffect(() => {\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return\n\n      if (e.key >= '1' && e.key <= '8') {\n        const tf = TIMEFRAMES.find((t) => t.hotkey === e.key)\n        if (tf) onTimeframeChange?.(tf.value)\n      }\n\n      if (e.key === 'c' || e.key === 'C') onTypeChange?.('candlestick')\n      if (e.key === 'l' || e.key === 'L') onTypeChange?.('line')\n      if (e.key === 'a' || e.key === 'A') onTypeChange?.('area')\n      if (e.key === 'b' || e.key === 'B') onTypeChange?.('bar')\n    }\n\n    window.addEventListener('keydown', handleKeyPress as any)\n    return () => window.removeEventListener('keydown', handleKeyPress as any)\n  }, [onTimeframeChange, onTypeChange])\n\n  const currentTypeInfo = CHART_TYPES.find((t) => t.value === currentType)\n\n  const groupedIndicators = AVAILABLE_INDICATORS.reduce((acc, indicator) => {\n    if (!acc[indicator.category]) acc[indicator.category] = []\n    acc[indicator.category].push(indicator)\n    return acc\n  }, {} as Record<string, typeof AVAILABLE_INDICATORS>)\n\n  const hasActiveIndicators = activeIndicators.length > 0\n\n  return (\n    <div className=\"flex flex-wrap items-center gap-2 p-3 border rounded-lg bg-card shadow-sm\">\n      <div className=\"relative\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => setIsSearching(!isSearching)}\n          className=\"h-8\"\n        >\n          <Search className=\"h-4 w-4\" />\n        </Button>\n        {isSearching && (\n          <div className=\"absolute top-full left-0 mt-1 z-50 w-64 bg-popover border rounded-lg shadow-lg p-2\">\n            <form onSubmit={handleSymbolSubmit} className=\"flex gap-1 mb-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Enter symbol...\"\n                value={symbolInput}\n                onChange={(e) => setSymbolInput(e.target.value.toUpperCase())}\n                onKeyDown={handleKeyDown}\n                className=\"h-8 text-sm font-mono\"\n                autoFocus\n              />\n              <Button type=\"submit\" size=\"sm\" variant=\"secondary\">\n                Go\n              </Button>\n            </form>\n            {recentSymbols.length > 0 && (\n              <>\n                <div className=\"flex items-center gap-1 text-xs text-muted-foreground mb-1 px-1\">\n                  <Clock className=\"h-3 w-3\" />\n                  Recent\n                </div>\n                <div className=\"flex flex-wrap gap-1 mb-2\">\n                  {recentSymbols.slice(0, 5).map((sym) => (\n                    <Button\n                      key={sym}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"h-6 text-xs font-mono\"\n                      onClick={() => handleSymbolSelect(sym)}\n                    >\n                      {sym}\n                    </Button>\n                  ))}\n                </div>\n              </>\n            )}\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground mb-1 px-1\">\n              <Star className=\"h-3 w-3\" />\n              Popular\n            </div>\n            <div className=\"flex flex-wrap gap-1\">\n              {POPULAR_SYMBOLS.map((sym) => (\n                <Button\n                  key={sym}\n                  variant={symbol === sym ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  className=\"h-6 text-xs font-mono\"\n                  onClick={() => handleSymbolSelect(sym)}\n                >\n                  {sym}\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      <form onSubmit={handleSymbolSubmit} className=\"flex items-center gap-1\">\n        <Input\n          type=\"text\"\n          placeholder=\"Symbol\"\n          value={symbolInput}\n          onChange={(e) => setSymbolInput(e.target.value.toUpperCase())}\n          className=\"w-20 h-8 text-sm font-mono\"\n        />\n        <Button type=\"submit\" size=\"sm\" variant=\"secondary\">\n          <Plus className=\"h-4 w-4\" />\n        </Button>\n      </form>\n\n      <div className=\"h-6 w-px bg-border\" />\n\n      <div className=\"flex items-center gap-0.5 bg-muted rounded-md p-0.5\">\n        {TIMEFRAMES.map((tf) => (\n          <Button\n            key={tf.value}\n            variant={currentTimeframe === tf.value ? 'default' : 'ghost'}\n            size=\"sm\"\n            className=\"h-7 px-2 text-xs font-medium\"\n            onClick={() => onTimeframeChange?.(tf.value)}\n            title={`Press ${tf.hotkey}`}\n          >\n            {tf.label}\n          </Button>\n        ))}\n      </div>\n\n      <div className=\"h-6 w-px bg-border\" />\n\n      <Select\n        value={currentType}\n        onValueChange={(value) => onTypeChange?.(value as ChartType)}\n      >\n        <SelectTrigger className=\"h-8 w-36\">\n          <SelectValue>\n            <div className=\"flex items-center gap-2\">\n              {currentTypeInfo?.icon}\n              <span className=\"text-xs\">{currentTypeInfo?.label}</span>\n            </div>\n          </SelectValue>\n        </SelectTrigger>\n        <SelectContent>\n          {CHART_TYPES.map((type) => (\n            <SelectItem key={type.value} value={type.value}>\n              <div className=\"flex items-center gap-2\">\n                {type.icon}\n                <span>{type.label}</span>\n                <span className=\"text-xs text-muted-foreground ml-2\">({type.hotkey})</span>\n              </div>\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n\n      <div className=\"h-6 w-px bg-border\" />\n\n      <Button\n        variant={showVolume ? 'default' : 'outline'}\n        size=\"sm\"\n        className=\"h-8 px-3\"\n        onClick={() => onVolumeToggle?.(!showVolume)}\n      >\n        <Activity className=\"h-4 w-4 mr-1\" />\n        <span className=\"text-xs\">Vol</span>\n      </Button>\n\n      <div className=\"h-6 w-px bg-border\" />\n\n      {hasActiveIndicators && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"h-8\"\n          onClick={onOpenIndicatorSettings}\n        >\n          <Settings className=\"h-4 w-4 mr-1\" />\n          <span className=\"text-xs\">Indicators</span>\n          <span className=\"ml-1 px-1.5 py-0.5 text-xs bg-primary text-primary-foreground rounded-full\">\n            {activeIndicators.length}\n          </span>\n        </Button>\n      )}\n\n      {AVAILABLE_INDICATORS.length > 0 && (\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant={hasActiveIndicators ? 'default' : 'outline'} size=\"sm\" className=\"h-8\">\n              <Settings2 className=\"h-4 w-4 mr-1\" />\n              <span className=\"text-xs\">Indicators</span>\n              {activeIndicators.length > 0 && (\n                <span className=\"ml-1 px-1.5 py-0.5 text-xs bg-primary text-primary-foreground rounded-full\">\n                  {activeIndicators.length}\n                </span>\n              )}\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <DropdownMenuLabel className=\"flex items-center justify-between\">\n              Technical Indicators\n              {activeIndicators.length > 0 && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6 text-xs\"\n                  onClick={() => {\n                    activeIndicators.forEach((ind) => onIndicatorToggle?.(ind, false))\n                  }}\n                >\n                  Clear all\n                </Button>\n              )}\n            </DropdownMenuLabel>\n            <DropdownMenuSeparator />\n            {Object.entries(groupedIndicators).map(([category, indicators]) => (\n              <div key={category}>\n                <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">\n                  {category}\n                </div>\n                {indicators.map((indicator) => (\n                  <DropdownMenuCheckboxItem\n                    key={indicator.id}\n                    checked={activeIndicators.includes(indicator.id)}\n                    onCheckedChange={(checked) =>\n                      onIndicatorToggle?.(indicator.id, checked as boolean)\n                    }\n                  >\n                    {indicator.label}\n                  </DropdownMenuCheckboxItem>\n                ))}\n                <DropdownMenuSeparator />\n              </div>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n      )}\n\n      <div className=\"ml-auto flex items-center gap-2\">\n        <span className=\"text-sm font-bold font-mono text-foreground\">{symbol}</span>\n        {recentSymbols.includes(symbol) && (\n          <span className=\"text-xs text-muted-foreground hidden sm:inline\">recent</span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport {\n  Calendar,\n  Download,\n  FileSpreadsheet,\n  FileJson,\n  FileText,\n  Clock,\n  TrendingUp,\n  Database,\n  RefreshCw,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { useDownloadFile } from '@/hooks/useDownload'\nimport { format, subDays, subMonths, subYears } from 'date-fns'\n\ninterface HistoricalDataExportProps {\n  symbol?: string\n  className?: string\n}\n\ninterface ExportConfig {\n  symbol: string\n  startDate: string\n  endDate: string\n  interval: '1d' | '1wk' | '1mo'\n  adjustments: 'splits' | 'dividends' | 'unadjusted' | 'all'\n  includeExtended: boolean\n}\n\nconst INTERVALS = [\n  { value: '1d', label: 'Daily', description: 'Trading days only' },\n  { value: '1wk', label: 'Weekly', description: 'End of week prices' },\n  { value: '1mo', label: 'Monthly', description: 'End of month prices' },\n]\n\nconst ADJUSTMENTS = [\n  { value: 'splits', label: 'Splits Only', description: 'Adjusted for splits' },\n  { value: 'dividends', label: 'Dividends Only', description: 'Adjusted for dividends' },\n  { value: 'unadjusted', label: 'Unadjusted', description: 'Raw prices' },\n  { value: 'all', label: 'All Adjustments', description: 'Both splits & dividends' },\n]\n\nconst PRESETS = [\n  { label: 'Last 7 Days', days: 7 },\n  { label: 'Last 30 Days', days: 30 },\n  { label: 'Last 3 Months', months: 3 },\n  { label: 'Last 6 Months', months: 6 },\n  { label: 'Last Year', years: 1 },\n  { label: 'Last 5 Years', years: 5 },\n  { label: 'All Time', years: 10 },\n]\n\nfunction generateMockData(config: ExportConfig): Array<{\n  date: string\n  open: number\n  high: number\n  low: number\n  close: number\n  volume: number\n  adjusted_close: number\n}> {\n  const start = new Date(config.startDate)\n  const end = new Date(config.endDate)\n  const data: Array<{\n    date: string\n    open: number\n    high: number\n    low: number\n    close: number\n    volume: number\n    adjusted_close: number\n  }> = []\n\n  let currentDate = new Date(start)\n  let basePrice = 150 + Math.random() * 50\n\n  while (currentDate <= end) {\n    const dayData = {\n      date: format(currentDate, 'yyyy-MM-dd'),\n      open: basePrice,\n      high: basePrice * (1 + Math.random() * 0.04),\n      low: basePrice * (1 - Math.random() * 0.04),\n      close: basePrice * (0.98 + Math.random() * 0.04),\n      volume: Math.floor(Math.random() * 50000000) + 10000000,\n      adjusted_close: basePrice * (0.97 + Math.random() * 0.06),\n    }\n    data.push(dayData)\n    basePrice = dayData.close\n    currentDate.setDate(currentDate.getDate() + 1)\n  }\n\n  return data\n}\n\nexport function HistoricalDataExport({ symbol = 'AAPL', className }: HistoricalDataExportProps) {\n  const [loading, setLoading] = useState(false)\n  const [config, setConfig] = useState<ExportConfig>({\n    symbol,\n    startDate: format(subYears(new Date(), 1), 'yyyy-MM-dd'),\n    endDate: format(new Date(), 'yyyy-MM-dd'),\n    interval: '1d',\n    adjustments: 'all',\n    includeExtended: false,\n  })\n  const [preview, setPreview] = useState<Array<{\n    date: string\n    open: number\n    high: number\n    low: number\n    close: number\n    volume: number\n  }> | null>(null)\n  const { downloadCSV, downloadJSON } = useDownloadFile()\n\n  const applyPreset = (preset: typeof PRESETS[0]) => {\n    const endDate = new Date()\n    let startDate: Date\n\n    if (preset.days) {\n      startDate = subDays(endDate, preset.days)\n    } else if (preset.months) {\n      startDate = subMonths(endDate, preset.months)\n    } else if (preset.years) {\n      startDate = subYears(endDate, preset.years)\n    } else {\n      startDate = subYears(endDate, 1)\n    }\n\n    setConfig((prev) => ({\n      ...prev,\n      startDate: format(startDate, 'yyyy-MM-dd'),\n      endDate: format(endDate, 'yyyy-MM-dd'),\n    }))\n  }\n\n  const handlePreview = () => {\n    setLoading(true)\n    setTimeout(() => {\n      const data = generateMockData(config).slice(0, 5)\n      setPreview(data.map(({ adjusted_close, ...rest }) => rest))\n      setLoading(false)\n    }, 800)\n  }\n\n  const handleExportCSV = () => {\n    const data = generateMockData(config)\n    const headers = ['Date', 'Open', 'High', 'Low', 'Close', 'Volume', 'Adjusted_Close']\n    const rows = data.map((d) => ({\n      Date: d.date,\n      Open: d.open.toFixed(4),\n      High: d.high.toFixed(4),\n      Low: d.low.toFixed(4),\n      Close: d.close.toFixed(4),\n      Volume: d.volume.toString(),\n      Adjusted_Close: d.adjusted_close.toFixed(4),\n    }))\n    downloadCSV(rows, `${symbol}_historical_data`)\n  }\n\n  const handleExportJSON = () => {\n    const data = generateMockData(config)\n    downloadJSON(data, `${symbol}_historical_data`)\n  }\n\n  const handleExportYAML = () => {\n    const data = generateMockData(config)\n    const yaml = `symbol: ${symbol}\nstart_date: ${config.startDate}\nend_date: ${config.endDate}\ninterval: ${config.interval}\nadjustments: ${config.adjustments}\ndata:\\n${data.map((d) => `  - date: ${d.date}\n    open: ${d.open.toFixed(4)}\n    high: ${d.high.toFixed(4)}\n    low: ${d.low.toFixed(4)}\n    close: ${d.close.toFixed(4)}\n    volume: ${d.volume}\n    adjusted_close: ${d.adjusted_close.toFixed(4)}`).join('\\n')}`\n    const blob = new Blob([yaml], { type: 'text/yaml' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `${symbol}_historical_data.yaml`\n    a.click()\n    URL.revokeObjectURL(url)\n  }\n\n  const dataPoints = preview?.length || 0\n\n  return (\n    <Card className={cn('', className)}>\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Database className=\"h-5 w-5\" />\n          Historical Data Export\n          {symbol && (\n            <Badge variant=\"secondary\" className=\"ml-2\">\n              {symbol}\n            </Badge>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 gap-6\">\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Start Date</Label>\n                <Input\n                  type=\"date\"\n                  value={config.startDate}\n                  onChange={(e) => setConfig((prev) => ({ ...prev, startDate: e.target.value }))}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>End Date</Label>\n                <Input\n                  type=\"date\"\n                  value={config.endDate}\n                  onChange={(e) => setConfig((prev) => ({ ...prev, endDate: e.target.value }))}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Quick Select</Label>\n              <div className=\"flex flex-wrap gap-2\">\n                {PRESETS.map((preset) => (\n                  <Button\n                    key={preset.label}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => applyPreset(preset)}\n                  >\n                    {preset.label}\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Interval</Label>\n                <Select\n                  value={config.interval}\n                  onValueChange={(v) => setConfig((prev) => ({ ...prev, interval: v as ExportConfig['interval'] }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {INTERVALS.map((interval) => (\n                      <SelectItem key={interval.value} value={interval.value}>\n                        <div>\n                          <div className=\"font-medium\">{interval.label}</div>\n                          <div className=\"text-xs text-muted-foreground\">{interval.description}</div>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Adjustments</Label>\n                <Select\n                  value={config.adjustments}\n                  onValueChange={(v) => setConfig((prev) => ({ ...prev, adjustments: v as ExportConfig['adjustments'] }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ADJUSTMENTS.map((adj) => (\n                      <SelectItem key={adj.value} value={adj.value}>\n                        <div>\n                          <div className=\"font-medium\">{adj.label}</div>\n                          <div className=\"text-xs text-muted-foreground\">{adj.description}</div>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <Button onClick={handlePreview} disabled={loading} className=\"w-full\">\n              {loading ? (\n                <>\n                  <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Generating Preview...\n                </>\n              ) : (\n                <>\n                  <Clock className=\"h-4 w-4 mr-2\" />\n                  Preview Data\n                </>\n              )}\n            </Button>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"bg-muted/50 rounded-lg p-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h4 className=\"font-medium\">Export Options</h4>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-2 mb-4\">\n                <Button variant=\"outline\" onClick={handleExportCSV}>\n                  <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n                  CSV\n                </Button>\n                <Button variant=\"outline\" onClick={handleExportJSON}>\n                  <FileJson className=\"h-4 w-4 mr-2\" />\n                  JSON\n                </Button>\n                <Button variant=\"outline\" onClick={handleExportYAML}>\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  YAML\n                </Button>\n              </div>\n\n              <div className=\"text-xs text-muted-foreground\">\n                <div className=\"flex items-center gap-1\">\n                  <TrendingUp className=\"h-3 w-3\" />\n                  <span>Includes: OHLCV + Adjusted Close</span>\n                </div>\n              </div>\n            </div>\n\n            {preview && (\n              <div className=\"bg-muted/50 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h4 className=\"font-medium\">Preview ({dataPoints} rows)</h4>\n                  <Badge variant=\"outline\">{config.interval.toUpperCase()}</Badge>\n                </div>\n\n                <div className=\"space-y-1\">\n                  <div className=\"grid grid-cols-6 gap-2 text-xs font-medium\">\n                    <div>Date</div>\n                    <div>Open</div>\n                    <div>High</div>\n                    <div>Low</div>\n                    <div>Close</div>\n                    <div>Volume</div>\n                  </div>\n                  {preview.map((row, i) => (\n                    <div key={i} className=\"grid grid-cols-6 gap-2 text-xs\">\n                      <div className=\"truncate\">{row.date}</div>\n                      <div>${row.open.toFixed(2)}</div>\n                      <div>${row.high.toFixed(2)}</div>\n                      <div>${row.low.toFixed(2)}</div>\n                      <div className=\"font-medium\">${row.close.toFixed(2)}</div>\n                      <div className=\"text-muted-foreground\">{(row.volume / 1000000).toFixed(1)}M</div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {!preview && !loading && (\n              <div className=\"bg-muted/50 rounded-lg p-8 text-center text-muted-foreground\">\n                <Calendar className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                <p className=\"text-sm\">Click \"Preview Data\" to see sample</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Switch } from '@/components/ui/switch'\nimport {\n  TrendingUp,\n  Activity,\n  Zap,\n  Plus,\n  X,\n  ChevronDown,\n  ChevronUp,\n  Settings2,\n} from 'lucide-react'\nimport { INDICATOR_CATEGORIES, INDICATOR_LABELS } from '@/lib/constants/indicators'\nimport { DEFAULT_INDICATORS } from '@/lib/types/indicators'\nimport type { IndicatorConfig, IndicatorType } from '@/lib/types/indicators'\nimport { cn } from '@/lib/utils'\n\ninterface TechnicalIndicatorsProps {\n  symbol: string\n  selectedIndicators: IndicatorConfig[]\n  onIndicatorsChange: (indicators: IndicatorConfig[]) => void\n  className?: string\n}\n\nexport function TechnicalIndicators({\n  symbol,\n  selectedIndicators,\n  onIndicatorsChange,\n  className,\n}: TechnicalIndicatorsProps) {\n  const [activeCategory, setActiveCategory] = useState<keyof typeof INDICATOR_CATEGORIES>('trend')\n  const [expandedIndicators, setExpandedIndicators] = useState<Set<string>>(new Set())\n  const [configuringIndicator, setConfiguringIndicator] = useState<IndicatorConfig | null>(null)\n\n  const availableIndicators = (Object.entries(INDICATOR_CATEGORIES).find(\n    ([key]) => key === activeCategory\n  )?.[1].indicators || []) as IndicatorType[]\n\n  const handleToggleIndicator = (indicatorType: IndicatorType) => {\n    const existingIndex = selectedIndicators.findIndex((ind) => ind.type === indicatorType)\n\n    if (existingIndex >= 0) {\n      // Remove indicator\n      const newIndicators = selectedIndicators.filter((ind) => ind.type !== indicatorType)\n      onIndicatorsChange(newIndicators)\n    } else {\n      // Add indicator with default config\n      const defaultConfig: IndicatorConfig = DEFAULT_INDICATORS[indicatorType]\n      onIndicatorsChange([...selectedIndicators, defaultConfig])\n      setConfiguringIndicator(defaultConfig)\n    }\n  }\n\n  const handleUpdateConfig = (indicator: IndicatorConfig) => {\n    const newIndicators = selectedIndicators.map((ind) =>\n      ind.type === indicator.type ? indicator : ind\n    )\n    onIndicatorsChange(newIndicators)\n    setConfiguringIndicator(null)\n  }\n\n  const handleToggleVisibility = (type: IndicatorType) => {\n    const newIndicators = selectedIndicators.map((ind) =>\n      ind.type === type ? { ...ind, visible: !ind.visible } : ind\n    )\n    onIndicatorsChange(newIndicators)\n  }\n\n  const getCategoryIcon = (category: string) => {\n    switch (category) {\n      case 'trend':\n        return <TrendingUp className=\"h-4 w-4\" />\n      case 'momentum':\n        return <Activity className=\"h-4 w-4\" />\n      case 'volatility':\n        return <Zap className=\"h-4 w-4\" />\n      default:\n        return <Settings2 className=\"h-4 w-4\" />\n    }\n  }\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5\" />\n            Technical Indicators\n            <Badge variant=\"secondary\">{selectedIndicators.length} active</Badge>\n          </CardTitle>\n          <CardDescription>\n            Add technical indicators to the chart\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeCategory} onValueChange={(v) => setActiveCategory(v as keyof typeof INDICATOR_CATEGORIES)}>\n            <TabsList className=\"grid w-full grid-cols-4\">\n              {Object.entries(INDICATOR_CATEGORIES).map(([key, { label, indicators }]) => (\n                <TabsTrigger key={key} value={key} className=\"gap-2\">\n                  {getCategoryIcon(key)}\n                  {label}\n                </TabsTrigger>\n              ))}\n            </TabsList>\n\n            {Object.entries(INDICATOR_CATEGORIES).map(([key, { label, indicators }]) => (\n              <TabsContent key={key} value={key} className=\"space-y-2 mt-4\">\n                {indicators.map((indicatorType) => {\n                  const isSelected = selectedIndicators.some((ind) => ind.type === indicatorType)\n                  const config = selectedIndicators.find((ind) => ind.type === indicatorType)\n                  const isExpanded = expandedIndicators.has(indicatorType)\n\n                  return (\n                    <div\n                      key={indicatorType}\n                      className=\"border rounded-lg overflow-hidden\"\n                    >\n                      <div\n                        className=\"flex items-center justify-between p-3 hover:bg-muted/50 cursor-pointer\"\n                        onClick={() => {\n                          const newExpanded = new Set(expandedIndicators)\n                          if (isExpanded) {\n                            newExpanded.delete(indicatorType)\n                          } else {\n                            newExpanded.add(indicatorType)\n                          }\n                          setExpandedIndicators(newExpanded)\n                        }}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <Button\n                            variant={isSelected ? 'default' : 'outline'}\n                            size=\"sm\"\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleToggleIndicator(indicatorType)\n                            }}\n                          >\n                            {isSelected ? (\n                              <X className=\"h-3 w-3\" />\n                            ) : (\n                              <Plus className=\"h-3 w-3\" />\n                            )}\n                          </Button>\n                          <span className=\"font-medium\">\n                            {INDICATOR_LABELS[indicatorType]}\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {isSelected && config && (\n                            <Switch\n                              checked={config.visible}\n                              onCheckedChange={() => handleToggleVisibility(indicatorType)}\n                              onClick={(e) => e.stopPropagation()}\n                            />\n                          )}\n                          {isExpanded ? (\n                            <ChevronUp className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </div>\n                      </div>\n\n                      {isExpanded && isSelected && config && (\n                        <div className=\"border-t p-4 space-y-4 bg-muted/30\">\n                          <div className=\"grid gap-4 md:grid-cols-2\">\n                            <div className=\"space-y-2\">\n                              <Label>Period</Label>\n                              <Input\n                                type=\"number\"\n                                value={config.params.period || 20}\n                                onChange={(e) =>\n                                  handleUpdateConfig({\n                                    ...config,\n                                    params: {\n                                      ...config.params,\n                                      period: parseFloat(e.target.value),\n                                    },\n                                  })\n                                }\n                                className=\"font-mono\"\n                              />\n                            </div>\n\n                            {config.type === 'bollinger' && (\n                              <>\n                                <div className=\"space-y-2\">\n                                  <Label>Standard Deviations</Label>\n                                  <Input\n                                    type=\"number\"\n                                    step=\"0.1\"\n                                    value={config.params.stdDev || 2}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          stdDev: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                              </>\n                            )}\n\n                            {config.type === 'macd' && (\n                              <>\n                                <div className=\"space-y-2\">\n                                  <Label>Fast Period</Label>\n                                  <Input\n                                    type=\"number\"\n                                    value={config.params.fastPeriod || 12}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          fastPeriod: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                                <div className=\"space-y-2\">\n                                  <Label>Slow Period</Label>\n                                  <Input\n                                    type=\"number\"\n                                    value={config.params.slowPeriod || 26}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          slowPeriod: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                                <div className=\"space-y-2\">\n                                  <Label>Signal Period</Label>\n                                  <Input\n                                    type=\"number\"\n                                    value={config.params.signalPeriod || 9}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          signalPeriod: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                              </>\n                            )}\n\n                            {config.type === 'stochastic' && (\n                              <>\n                                <div className=\"space-y-2\">\n                                  <Label>%K Period</Label>\n                                  <Input\n                                    type=\"number\"\n                                    value={config.params.kPeriod || 14}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          kPeriod: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                                <div className=\"space-y-2\">\n                                  <Label>%D Period</Label>\n                                  <Input\n                                    type=\"number\"\n                                    value={config.params.dPeriod || 3}\n                                    onChange={(e) =>\n                                      handleUpdateConfig({\n                                        ...config,\n                                        params: {\n                                          ...config.params,\n                                          dPeriod: parseFloat(e.target.value),\n                                        },\n                                      })\n                                    }\n                                    className=\"font-mono\"\n                                  />\n                                </div>\n                              </>\n                            )}\n                          </div>\n\n                          <div className=\"space-y-2\">\n                            <Label>Color</Label>\n                            <div className=\"flex gap-2\">\n                              {['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#14b8a6'].map((color) => (\n                                <button\n                                  key={color}\n                                  className={cn(\n                                    'w-8 h-8 rounded-md border-2 transition-all',\n                                    config.color === color\n                                      ? 'border-foreground scale-110'\n                                      : 'border-transparent hover:scale-105'\n                                  )}\n                                  style={{ backgroundColor: color }}\n                                  onClick={() =>\n                                    handleUpdateConfig({ ...config, color })\n                                  }\n                                />\n                              ))}\n                            </div>\n                          </div>\n\n                          <div className=\"flex items-center gap-2\">\n                            <Switch\n                              checked={config.secondary_yaxis || false}\n                              onCheckedChange={(checked) =>\n                                handleUpdateConfig({\n                                  ...config,\n                                  secondary_yaxis: checked,\n                                })\n                              }\n                            />\n                            <Label className=\"text-sm\">Secondary Y-Axis</Label>\n                          </div>\n\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleToggleIndicator(indicatorType)}\n                          >\n                            Remove Indicator\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  )\n                })}\n              </TabsContent>\n            ))}\n          </Tabs>\n\n          {selectedIndicators.length === 0 && (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Activity className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>No indicators selected</p>\n              <p className=\"text-sm\">Add indicators from the categories above</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Slider } from '@/components/ui/slider'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Switch } from '@/components/ui/switch'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\nimport { HelpCircle, Settings, Info, TrendingUp, Activity, BarChart2, LineChart } from 'lucide-react'\nimport { INDICATOR_DESCRIPTIONS, IndicatorConfig } from '@/lib/utils/technical-indicators'\n\ninterface IndicatorConfigModalProps {\n  showIndicators: string[]\n  indicatorConfig: IndicatorConfig\n  onShowIndicatorsChange: (indicators: string[]) => void\n  onIndicatorConfigChange: (config: IndicatorConfig) => void\n  children: React.ReactNode\n}\n\nexport function IndicatorConfigModal({\n  showIndicators,\n  indicatorConfig,\n  onShowIndicatorsChange,\n  onIndicatorConfigChange,\n  children,\n}: IndicatorConfigModalProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [tempIndicators, setTempIndicators] = useState(showIndicators)\n  const [tempConfig, setTempConfig] = useState(indicatorConfig)\n\n  const movingAverageIndicators = [\n    { id: 'sma20', ...INDICATOR_DESCRIPTIONS.sma20 },\n    { id: 'sma50', ...INDICATOR_DESCRIPTIONS.sma50 },\n    { id: 'sma200', ...INDICATOR_DESCRIPTIONS.sma200 },\n    { id: 'ema12', ...INDICATOR_DESCRIPTIONS.ema12 },\n    { id: 'ema26', ...INDICATOR_DESCRIPTIONS.ema26 },\n  ]\n\n  const oscillatorIndicators = [\n    { id: 'rsi', ...INDICATOR_DESCRIPTIONS.rsi },\n    { id: 'macd', ...INDICATOR_DESCRIPTIONS.macd },\n    { id: 'bollinger', ...INDICATOR_DESCRIPTIONS.bollinger },\n  ]\n\n  const handleToggleIndicator = (id: string) => {\n    setTempIndicators((prev) =>\n      prev.includes(id) ? prev.filter((i) => i !== id) : [...prev, id]\n    )\n  }\n\n  const handleSave = () => {\n    onShowIndicatorsChange(tempIndicators)\n    onIndicatorConfigChange(tempConfig)\n    setIsOpen(false)\n  }\n\n  const handleReset = () => {\n    setTempIndicators([])\n    setTempConfig({\n      rsiPeriod: 14,\n      rsiOverbought: 70,\n      rsiOversold: 30,\n      macdFast: 12,\n      macdSlow: 26,\n      macdSignal: 9,\n      bollingerPeriod: 20,\n      bollingerStdDev: 2,\n    })\n  }\n\n  const formatIndicatorValue = (value: number | undefined) => {\n    if (value === undefined) return '--'\n    return value.toString()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>{children}</DialogTrigger>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Settings className=\"h-5 w-5\" />\n            Technical Indicators Configuration\n          </DialogTitle>\n          <DialogDescription>\n            Customize which technical indicators to display on the chart and their parameters.\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"moving-averages\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"moving-averages\" className=\"flex items-center gap-2\">\n              <LineChart className=\"h-4 w-4\" />\n              Moving Averages\n            </TabsTrigger>\n            <TabsTrigger value=\"oscillators\" className=\"flex items-center gap-2\">\n              <Activity className=\"h-4 w-4\" />\n              Oscillators\n            </TabsTrigger>\n            <TabsTrigger value=\"volatility\" className=\"flex items-center gap-2\">\n              <BarChart2 className=\"h-4 w-4\" />\n              Volatility\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"moving-averages\" className=\"space-y-4 mt-4\">\n            <div className=\"grid gap-3\">\n              {movingAverageIndicators.map((indicator) => (\n                <Card key={indicator.id} className=\"cursor-pointer transition-colors hover:bg-muted/50\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <Switch\n                          checked={tempIndicators.includes(indicator.id)}\n                          onCheckedChange={() => handleToggleIndicator(indicator.id)}\n                        />\n                        <div className=\"flex items-center gap-2\">\n                          <div\n                            className=\"w-3 h-3 rounded-full\"\n                            style={{ backgroundColor: indicator.color }}\n                          />\n                          <span className=\"font-medium\">{indicator.name}</span>\n                        </div>\n                      </div>\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <HelpCircle className=\"h-4 w-4 text-muted-foreground cursor-help\" />\n                          </TooltipTrigger>\n                          <TooltipContent className=\"max-w-sm\">\n                            <p className=\"font-medium\">{indicator.fullName}</p>\n                            <p className=\"text-sm text-muted-foreground mt-1\">{indicator.description}</p>\n                            <p className=\"text-sm mt-2\">{indicator.interpretation}</p>\n                          </TooltipContent>\n                        </Tooltip>\n                      </TooltipProvider>\n                    </div>\n                    {tempIndicators.includes(indicator.id) && (\n                      <div className=\"mt-2 text-sm text-muted-foreground\">\n                        <p>{indicator.description}</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"oscillators\" className=\"space-y-4 mt-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4 text-purple-500\" />\n                    <CardTitle className=\"text-sm\">RSI Settings</CardTitle>\n                  </div>\n                  <Switch\n                    checked={tempIndicators.includes('rsi')}\n                    onCheckedChange={() => handleToggleIndicator('rsi')}\n                  />\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {tempIndicators.includes('rsi') && (\n                  <>\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"rsiPeriod\">Period</Label>\n                        <Input\n                          id=\"rsiPeriod\"\n                          type=\"number\"\n                          value={tempConfig.rsiPeriod || 14}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              rsiPeriod: parseInt(e.target.value) || 14,\n                            }))\n                          }\n                          min={2}\n                          max={50}\n                        />\n                        <p className=\"text-xs text-muted-foreground\">\n                          Number of periods for RSI calculation\n                        </p>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"rsiOverbought\">Overbought</Label>\n                        <Input\n                          id=\"rsiOverbought\"\n                          type=\"number\"\n                          value={tempConfig.rsiOverbought || 70}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              rsiOverbought: parseInt(e.target.value) || 70,\n                            }))\n                          }\n                          min={50}\n                          max={100}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"rsiOversold\">Oversold</Label>\n                        <Input\n                          id=\"rsiOversold\"\n                          type=\"number\"\n                          value={tempConfig.rsiOversold || 30}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              rsiOversold: parseInt(e.target.value) || 30,\n                            }))\n                          }\n                          min={0}\n                          max={50}\n                        />\n                      </div>\n                    </div>\n                    <div className=\"p-3 bg-muted rounded-lg\">\n                      <div className=\"flex items-start gap-2\">\n                        <Info className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                        <div className=\"text-sm\">\n                          <p className=\"font-medium\">How RSI works:</p>\n                          <p className=\"text-muted-foreground mt-1\">\n                            RSI measures the speed and change of price movements on a scale of 0-100.\n                            Traditionally, RSI above {tempConfig.rsiOverbought || 70} suggests the asset may be overbought,\n                            while RSI below {tempConfig.rsiOversold || 30} suggests it may be oversold.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-4 w-4 text-blue-500\" />\n                    <CardTitle className=\"text-sm\">MACD Settings</CardTitle>\n                  </div>\n                  <Switch\n                    checked={tempIndicators.includes('macd')}\n                    onCheckedChange={() => handleToggleIndicator('macd')}\n                  />\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {tempIndicators.includes('macd') && (\n                  <>\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"macdFast\">Fast Period</Label>\n                        <Input\n                          id=\"macdFast\"\n                          type=\"number\"\n                          value={tempConfig.macdFast || 12}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              macdFast: parseInt(e.target.value) || 12,\n                            }))\n                          }\n                          min={2}\n                          max={50}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"macdSlow\">Slow Period</Label>\n                        <Input\n                          id=\"macdSlow\"\n                          type=\"number\"\n                          value={tempConfig.macdSlow || 26}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              macdSlow: parseInt(e.target.value) || 26,\n                            }))\n                          }\n                          min={2}\n                          max={100}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"macdSignal\">Signal Period</Label>\n                        <Input\n                          id=\"macdSignal\"\n                          type=\"number\"\n                          value={tempConfig.macdSignal || 9}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              macdSignal: parseInt(e.target.value) || 9,\n                            }))\n                          }\n                          min={1}\n                          max={50}\n                        />\n                      </div>\n                    </div>\n                    <div className=\"p-3 bg-muted rounded-lg\">\n                      <div className=\"flex items-start gap-2\">\n                        <Info className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                        <div className=\"text-sm\">\n                          <p className=\"font-medium\">How MACD works:</p>\n                          <p className=\"text-muted-foreground mt-1\">\n                            MACD shows the relationship between two EMAs. When MACD crosses above the signal line,\n                            it may indicate bullish momentum. When it crosses below, it may indicate bearish momentum.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"volatility\" className=\"space-y-4 mt-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <BarChart2 className=\"h-4 w-4 text-amber-500\" />\n                    <CardTitle className=\"text-sm\">Bollinger Bands Settings</CardTitle>\n                  </div>\n                  <Switch\n                    checked={tempIndicators.includes('bollinger')}\n                    onCheckedChange={() => handleToggleIndicator('bollinger')}\n                  />\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {tempIndicators.includes('bollinger') && (\n                  <>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"bollingerPeriod\">Period</Label>\n                        <Input\n                          id=\"bollingerPeriod\"\n                          type=\"number\"\n                          value={tempConfig.bollingerPeriod || 20}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              bollingerPeriod: parseInt(e.target.value) || 20,\n                            }))\n                          }\n                          min={2}\n                          max={100}\n                        />\n                        <p className=\"text-xs text-muted-foreground\">\n                          Number of periods for SMA calculation\n                        </p>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"bollingerStdDev\">Standard Deviations</Label>\n                        <Input\n                          id=\"bollingerStdDev\"\n                          type=\"number\"\n                          value={tempConfig.bollingerStdDev || 2}\n                          onChange={(e) =>\n                            setTempConfig((prev) => ({\n                              ...prev,\n                              bollingerStdDev: parseFloat(e.target.value) || 2,\n                            }))\n                          }\n                          min={0.5}\n                          max={5}\n                          step={0.5}\n                        />\n                      </div>\n                    </div>\n                    <div className=\"p-3 bg-muted rounded-lg\">\n                      <div className=\"flex items-start gap-2\">\n                        <Info className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                        <div className=\"text-sm\">\n                          <p className=\"font-medium\">How Bollinger Bands work:</p>\n                          <p className=\"text-muted-foreground mt-1\">\n                            Bollinger Bands consist of a middle band (SMA) with upper and lower bands\n                            set at a specified number of standard deviations. When bands widen, it indicates\n                            higher volatility; when they narrow, it indicates lower volatility.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"flex items-center justify-between pt-4 border-t\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">\n              {tempIndicators.length} indicator{tempIndicators.length !== 1 ? 's' : ''} active\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={handleReset}>\n              Reset\n            </Button>\n            <Button variant=\"outline\" onClick={() => setIsOpen(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleSave}>Apply Changes</Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","'use client'\n\nimport { useState, useRef, useCallback } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Switch } from '@/components/ui/switch'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport {\n  Minus,\n  TrendingUp,\n  Square,\n  Type,\n  Activity,\n  Plus,\n  Trash2,\n  Save,\n  Undo,\n  Camera,\n  Share2,\n  Download,\n  Link,\n  Loader2,\n} from 'lucide-react'\nimport { DRAWING_TOOLS, FIBONACCI_LEVELS } from '@/lib/constants/indicators'\nimport { cn } from '@/lib/utils'\n\nexport type DrawingType =\n  | 'horizontal_line'\n  | 'vertical_line'\n  | 'trend_line'\n  | 'fibonacci'\n  | 'rectangle'\n  | 'text'\n\ninterface Drawing {\n  id: string\n  type: DrawingType\n  symbol: string\n  timeframe: string\n  startX: number\n  startY: number\n  endX?: number\n  endY?: number\n  color: string\n  width: number\n  style: 'solid' | 'dashed'\n  text?: string\n  fibonacciLevels?: number[]\n  visible: boolean\n  created_at: string\n}\n\ninterface DrawingToolsProps {\n  symbol: string\n  timeframe: string\n  drawings: Drawing[]\n  onDrawingsChange: (drawings: Drawing[]) => void\n  onToolSelect?: (tool: DrawingType | null) => void\n  selectedTool?: DrawingType | null\n  onScreenshot?: () => Promise<string>\n  onShare?: () => Promise<string>\n  className?: string\n}\n\nexport function DrawingTools({\n  symbol,\n  timeframe,\n  drawings,\n  onDrawingsChange,\n  onToolSelect,\n  selectedTool,\n  onScreenshot,\n  onShare,\n  className,\n}: DrawingToolsProps) {\n  const [activeTab, setActiveTab] = useState<'tools' | 'manage'>('tools')\n  const [isTakingScreenshot, setIsTakingScreenshot] = useState(false)\n  const [isSharing, setIsSharing] = useState(false)\n  const [shareUrl, setShareUrl] = useState<string | null>(null)\n  const [showShareModal, setShowShareModal] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const handleSelectTool = (type: DrawingType) => {\n    if (selectedTool === type) {\n      onToolSelect?.(null)\n    } else {\n      onToolSelect?.(type)\n    }\n  }\n\n  const handleClearAll = () => {\n    if (confirm('Are you sure you want to clear all drawings?')) {\n      onDrawingsChange([])\n    }\n  }\n\n  const handleToggleVisibility = (drawingId: string) => {\n    const newDrawings = drawings.map((d) =>\n      d.id === drawingId ? { ...d, visible: !d.visible } : d\n    )\n    onDrawingsChange(newDrawings)\n  }\n\n  const handleDeleteDrawing = (drawingId: string) => {\n    const newDrawings = drawings.filter((d) => d.id !== drawingId)\n    onDrawingsChange(newDrawings)\n  }\n\n  const handleScreenshot = useCallback(async () => {\n    if (!onScreenshot) {\n      return\n    }\n\n    setIsTakingScreenshot(true)\n    try {\n      const dataUrl = await onScreenshot()\n      const link = document.createElement('a')\n      link.download = `chart-${symbol}-${Date.now()}.png`\n      link.href = dataUrl\n      link.click()\n    } catch (error) {\n      console.error('Failed to take screenshot:', error)\n    } finally {\n      setIsTakingScreenshot(false)\n    }\n  }, [onScreenshot, symbol])\n\n  const handleShare = useCallback(async () => {\n    if (!onShare) {\n      return\n    }\n\n    setIsSharing(true)\n    setShareUrl(null)\n    try {\n      const url = await onShare()\n      setShareUrl(url)\n      setShowShareModal(true)\n    } catch (error) {\n      console.error('Failed to share:', error)\n    } finally {\n      setIsSharing(false)\n    }\n  }, [onShare])\n\n  const copyShareUrl = useCallback(async () => {\n    if (shareUrl) {\n      await navigator.clipboard.writeText(shareUrl)\n    }\n  }, [shareUrl])\n\n  const getToolIcon = (type: DrawingType) => {\n    switch (type) {\n      case 'horizontal_line':\n        return <Minus className=\"h-4 w-4\" />\n      case 'vertical_line':\n        return <Minus className=\"h-4 w-4 rotate-90\" />\n      case 'trend_line':\n        return <TrendingUp className=\"h-4 w-4\" />\n      case 'fibonacci':\n        return <Activity className=\"h-4 w-4\" />\n      case 'rectangle':\n        return <Square className=\"h-4 w-4\" />\n      case 'text':\n        return <Type className=\"h-4 w-4\" />\n      default:\n        return <Minus className=\"h-4 w-4\" />\n    }\n  }\n\n  const getToolLabel = (type: DrawingType) => {\n    return DRAWING_TOOLS.find((t) => t.type === type)?.label || type\n  }\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Type className=\"h-5 w-5\" />\n            Drawing Tools\n            <Badge variant=\"secondary\">{drawings.length} drawings</Badge>\n          </CardTitle>\n          <CardDescription>\n            Draw support, resistance, and annotations on charts\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'tools' | 'manage')}>\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"tools\">Tools</TabsTrigger>\n              <TabsTrigger value=\"manage\">Manage</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"tools\" className=\"space-y-4 mt-4\">\n              <div className=\"grid grid-cols-2 gap-2\">\n                {DRAWING_TOOLS.map((tool) => (\n                  <Button\n                    key={tool.type}\n                    variant={selectedTool === tool.type ? 'default' : 'outline'}\n                    onClick={() => handleSelectTool(tool.type as DrawingType)}\n                    className={cn(\n                      'gap-2 justify-start',\n                      selectedTool === tool.type && 'bg-primary text-primary-foreground'\n                    )}\n                  >\n                    {getToolIcon(tool.type as DrawingType)}\n                    <span className=\"text-sm\">{tool.label}</span>\n                  </Button>\n                ))}\n              </div>\n\n              {selectedTool && (\n                <Card className=\"bg-muted/30 border-2 border-primary\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm\">\n                      Selected: {getToolLabel(selectedTool)}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"text-sm text-muted-foreground\">\n                      {selectedTool === 'horizontal_line' && 'Click to set price level'}\n                      {selectedTool === 'vertical_line' && 'Click to set time point'}\n                      {selectedTool === 'trend_line' && 'Drag to draw trend line'}\n                      {selectedTool === 'fibonacci' && 'Drag to draw Fibonacci retracement'}\n                      {selectedTool === 'rectangle' && 'Drag to create rectangle zone'}\n                      {selectedTool === 'text' && 'Click to add text annotation'}\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <Button variant=\"outline\" size=\"sm\" onClick={() => onToolSelect?.(null)}>\n                        Cancel\n                      </Button>\n                      <Button size=\"sm\" className=\"flex-1\">\n                        <Save className=\"h-4 w-4 mr-2\" />\n                        Save Drawing\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              <div className=\"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3\">\n                <p className=\"text-xs text-blue-600 dark:text-blue-500\">\n                  <strong>Tip:</strong> Select a drawing tool, then click and drag on the chart to create. Drawings are saved per symbol and timeframe.\n                </p>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">\n                  Export & Share\n                </Label>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleScreenshot}\n                    disabled={isTakingScreenshot || !onScreenshot}\n                  >\n                    {isTakingScreenshot ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Camera className=\"h-4 w-4\" />\n                    )}\n                    <span className=\"ml-2\">Screenshot</span>\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleShare}\n                    disabled={isSharing || !onShare}\n                  >\n                    {isSharing ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Share2 className=\"h-4 w-4\" />\n                    )}\n                    <span className=\"ml-2\">Share</span>\n                  </Button>\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"manage\" className=\"space-y-4 mt-4\">\n              {drawings.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Type className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No drawings yet</p>\n                  <p className=\"text-sm\">Use drawing tools to create annotations</p>\n                </div>\n              ) : (\n                <>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={handleClearAll}\n                      className=\"text-destructive\"\n                    >\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\n                      Clear All\n                    </Button>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    {drawings.map((drawing) => (\n                      <div\n                        key={drawing.id}\n                        className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          {getToolIcon(drawing.type)}\n                          <div>\n                            <p className=\"font-medium text-sm\">\n                              {getToolLabel(drawing.type)}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {new Date(drawing.created_at).toLocaleString()}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Switch\n                            checked={drawing.visible}\n                            onCheckedChange={() => handleToggleVisibility(drawing.id)}\n                          />\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteDrawing(drawing.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </>\n              )}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showShareModal} onOpenChange={setShowShareModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Share2 className=\"h-5 w-5\" />\n              Share Chart\n            </DialogTitle>\n            <DialogDescription>\n              Share your chart with drawings and annotations.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {shareUrl ? (\n              <>\n                <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg\">\n                  <Link className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                  <code className=\"text-sm flex-1 break-all\">{shareUrl}</code>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={copyShareUrl}>\n                    Copy\n                  </Button>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" className=\"flex-1\" onClick={() => window.open(shareUrl, '_blank')}>\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    Open Link\n                  </Button>\n                  <Button className=\"flex-1\" onClick={() => {\n                    if (navigator.share) {\n                      navigator.share({\n                        title: `Chart: ${symbol}`,\n                        text: 'Check out this chart on FinanceHub',\n                        url: shareUrl,\n                      })\n                    }\n                  }}>\n                    <Share2 className=\"h-4 w-4 mr-2\" />\n                    Share Via...\n                  </Button>\n                </div>\n              </>\n            ) : (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowShareModal(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  TrendingUp,\n  Plus,\n  X,\n  RefreshCw,\n  Minus,\n  Activity,\n} from 'lucide-react'\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Tooltip,\n  Legend,\n  Filler,\n} from 'chart.js/auto'\nimport { Line } from 'react-chartjs-2'\nimport { cn } from '@/lib/utils'\nimport type { TimeFrame } from '@/lib/types/indicators'\n\ninterface ComparisonData {\n  symbol: string\n  name: string\n  data: Array<{\n    timestamp: string\n    price: number\n    normalized: number\n    change: number\n  }>\n  currentPrice: number\n  change: number\n  changePercent: number\n  color: string\n}\n\ninterface ComparisonChartProps {\n  symbols: string[]\n  timeframe?: TimeFrame\n  normalize?: boolean\n  startDate?: Date\n  endDate?: Date\n  className?: string\n}\n\nconst TIMEFRAME_OPTIONS = [\n  { value: '1d', label: '1 Day' },\n  { value: '1w', label: '1 Week' },\n  { value: '1m', label: '1 Month' },\n  { value: '3m', label: '3 Months' },\n  { value: '6m', label: '6 Months' },\n  { value: '1y', label: '1 Year' },\n] as const\n\nconst PRESET_COMPARISONS = [\n  {\n    name: 'Tech Giants',\n    symbols: ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META'],\n  },\n  {\n    name: 'Major Indices',\n    symbols: ['SPY', 'QQQ', 'IWM', 'DIA'],\n  },\n  {\n    name: 'Auto Makers',\n    symbols: ['TSLA', 'F', 'GM', 'RIVN', 'LCID'],\n  },\n  {\n    name: 'Banks',\n    symbols: ['JPM', 'BAC', 'WFC', 'C', 'GS'],\n  },\n]\n\nconst COLOR_PALETTE = [\n  '#3b82f6', // blue\n  '#22c55e', // green\n  '#f59e0b', // orange\n  '#ef4444', // red\n  '#8b5cf6', // purple\n  '#06b6d4', // cyan\n  '#ec4899', // pink\n  '#14b8a6', // teal\n]\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Tooltip,\n  Legend,\n  Filler\n)\n\nexport function ComparisonChart({\n  symbols: initialSymbols,\n  timeframe = '1m',\n  normalize = true,\n  startDate,\n  endDate,\n  className,\n}: ComparisonChartProps) {\n  const [symbols, setSymbols] = useState<string[]>(initialSymbols.slice(0, 4))\n  const [selectedTimeframe, setSelectedTimeframe] = useState<TimeFrame>(timeframe)\n  const [comparisonData, setComparisonData] = useState<ComparisonData[]>([])\n  const [loading, setLoading] = useState(false)\n  const [newSymbol, setNewSymbol] = useState('')\n  const [normalized, setNormalized] = useState(normalize)\n\n  const symbolColors = symbols.reduce((acc, symbol, index) => {\n    acc[symbol] = COLOR_PALETTE[index % COLOR_PALETTE.length]\n    return acc\n  }, {} as Record<string, string>)\n\n  useEffect(() => {\n    fetchComparisonData()\n  }, [symbols, selectedTimeframe, normalized])\n\n  const fetchComparisonData = async () => {\n    setLoading(true)\n    try {\n      // Mock data for now - in production, fetch from API\n      const now = new Date()\n      const days = getTimeframeDays(selectedTimeframe)\n      \n      const data: ComparisonData[] = await Promise.all(\n        symbols.map(async (symbol) => {\n          // Generate mock historical data\n          const basePrice = Math.random() * 1000 + 50\n          const dataPoints = []\n          let cumulativeChange = 0\n          \n          for (let i = days; i >= 0; i--) {\n            const date = new Date(now)\n            date.setDate(date.getDate() - i)\n            \n            const dailyChange = (Math.random() - 0.5) * 0.05\n            cumulativeChange += dailyChange\n            \n            const price = basePrice * (1 + cumulativeChange)\n            dataPoints.push({\n              timestamp: date.toISOString(),\n              price,\n              normalized: 0, // Will be calculated\n              change: cumulativeChange * 100,\n            })\n          }\n          \n          // Normalize to first data point\n          const firstPrice = dataPoints[0].price\n          dataPoints.forEach(point => {\n            point.normalized = ((point.price - firstPrice) / firstPrice) * 100\n          })\n          \n          const currentPrice = dataPoints[dataPoints.length - 1].price\n          const totalChange = dataPoints[dataPoints.length - 1].change\n          \n          return {\n            symbol,\n            name: symbol,\n            data: dataPoints,\n            currentPrice,\n            change: totalChange,\n            changePercent: totalChange,\n            color: symbolColors[symbol],\n          }\n        })\n      )\n      \n      setComparisonData(data)\n    } catch (error) {\n      console.error('Failed to fetch comparison data:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getTimeframeDays = (tf: TimeFrame): number => {\n    switch (tf) {\n      case '1d': return 1\n      case '1w': return 7\n      case '1m': return 30\n      case '3m': return 90\n      case '6m': return 180\n      case '1y': return 365\n      default: return 30\n    }\n  }\n\n  const handleAddSymbol = () => {\n    const symbol = newSymbol.toUpperCase().trim()\n    if (symbol && !symbols.includes(symbol) && symbols.length < 4) {\n      setSymbols([...symbols, symbol])\n      setNewSymbol('')\n    }\n  }\n\n  const handleRemoveSymbol = (symbol: string) => {\n    const newSymbols = symbols.filter((s) => s !== symbol)\n    setSymbols(newSymbols)\n  }\n\n  const handleApplyPreset = (presetSymbols: string[]) => {\n    setSymbols(presetSymbols.slice(0, 4))\n  }\n\n  const labels = comparisonData[0]?.data.map((point) => {\n    const date = new Date(point.timestamp)\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n  }) || []\n\n  const datasets = comparisonData.flatMap((data) => [\n    {\n      label: `${data.symbol} (Price)`,\n      data: data.data.map((point) =>\n        normalized ? point.normalized : point.price\n      ),\n      borderColor: data.color,\n      backgroundColor: data.color + '20',\n      tension: 0.4,\n      pointRadius: 0,\n      pointHoverRadius: 4,\n      borderWidth: 2,\n      fill: false,\n      yAxisID: 'y',\n    },\n  ])\n\n  const chartOptions: any = {\n    responsive: true,\n    maintainAspectRatio: false,\n    interaction: {\n      mode: 'index' as const,\n      intersect: false,\n    },\n    plugins: {\n      legend: {\n        display: true,\n        position: 'top' as const,\n        labels: {\n          boxWidth: 12,\n          padding: 15,\n          font: {\n            size: 11,\n          },\n        },\n      },\n      tooltip: {\n        backgroundColor: 'rgba(0, 0, 0, 0.8)',\n        titleColor: 'white',\n        bodyColor: 'white',\n        borderColor: 'rgba(255, 255, 255, 0.1)',\n        borderWidth: 1,\n        padding: 12,\n        cornerRadius: 8,\n        callbacks: {\n          label: (context: { datasetIndex: number; dataIndex: number }) => {\n            const dataset = comparisonData[context.datasetIndex]\n            const dataPoint = dataset?.data[context.dataIndex]\n            if (!dataset || !dataPoint) return ''\n            \n            const value = normalized\n              ? `${dataPoint.normalized.toFixed(2)}%`\n              : `$${dataPoint.price.toFixed(2)}`\n            \n            return `${dataset.symbol}: ${value} (${dataPoint.change >= 0 ? '+' : ''}${dataPoint.change.toFixed(2)}%)`\n          },\n        },\n      },\n    },\n    scales: {\n      x: {\n        grid: {\n          display: false,\n        },\n        ticks: {\n          color: 'rgba(148, 163, 184, 0.5)',\n          maxTicksLimit: 8,\n        },\n      },\n      y: {\n        type: 'linear' as const,\n        display: true,\n        position: 'left' as const,\n        grid: {\n          color: 'rgba(148, 163, 184, 0.1)',\n        },\n        ticks: {\n          color: 'rgba(148, 163, 184, 0.5)',\n          callback: (value: number) =>\n            normalized ? `${value.toFixed(0)}%` : `$${value.toFixed(2)}`,\n        },\n      },\n    },\n  }\n\n  const calculateCorrelation = (data1: number[], data2: number[]): number => {\n    const n = Math.min(data1.length, data2.length)\n    let sumX = 0,\n      sumY = 0,\n      sumXY = 0,\n      sumX2 = 0,\n      sumY2 = 0\n    \n    for (let i = 0; i < n; i++) {\n      sumX += data1[i]\n      sumY += data2[i]\n      sumXY += data1[i] * data2[i]\n      sumX2 += data1[i] * data1[i]\n      sumY2 += data2[i] * data2[i]\n    }\n    \n    const numerator = n * sumXY - sumX * sumY\n    const denominator = Math.sqrt(\n      (n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY)\n    )\n    \n    return denominator === 0 ? 0 : numerator / denominator\n  }\n\n  const correlations = comparisonData.flatMap((data1, i) =>\n    comparisonData.slice(i + 1).map((data2) => ({\n      pair: `${data1.symbol}-${data2.symbol}`,\n      value: calculateCorrelation(\n        data1.data.map((d) => d.price),\n        data2.data.map((d) => d.price)\n      ),\n    }))\n  )\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"h-5 w-5\" />\n                Comparison Chart\n                <Badge variant=\"secondary\">{symbols.length} symbols</Badge>\n              </CardTitle>\n              <CardDescription>\n                Compare multiple symbols performance\n              </CardDescription>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" onClick={fetchComparisonData} disabled={loading}>\n              <RefreshCw className={cn('h-4 w-4 mr-2', loading && 'animate-spin')} />\n              Refresh\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"flex gap-4 flex-wrap\">\n              <div className=\"flex-1 min-w-[200px]\">\n                <Label htmlFor=\"symbol\">Add Symbol</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"symbol\"\n                    value={newSymbol}\n                    onChange={(e) => setNewSymbol(e.target.value.toUpperCase())}\n                    placeholder=\"AAPL\"\n                    className=\"flex-1 font-mono uppercase\"\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') handleAddSymbol()\n                    }}\n                  />\n                  <Button\n                    size=\"sm\"\n                    onClick={handleAddSymbol}\n                    disabled={symbols.length >= 4 || !newSymbol.trim()}\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex-1 min-w-[200px]\">\n                <Label>Normalization</Label>\n                <Select value={normalized ? 'true' : 'false'} onValueChange={(v) => setNormalized(v === 'true')}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"true\">Normalized (%)</SelectItem>\n                    <SelectItem value=\"false\">Absolute ($)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex-1 min-w-[200px]\">\n                <Label>Timeframe</Label>\n                <Select value={selectedTimeframe} onValueChange={(v) => setSelectedTimeframe(v as TimeFrame)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {TIMEFRAME_OPTIONS.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div>\n              <Label>Quick Presets</Label>\n              <div className=\"flex gap-2 flex-wrap mt-2\">\n                {PRESET_COMPARISONS.map((preset) => (\n                  <Button\n                    key={preset.name}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleApplyPreset(preset.symbols)}\n                  >\n                    {preset.name}\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"flex gap-2 flex-wrap\">\n              {symbols.map((symbol) => {\n                const data = comparisonData.find((d) => d.symbol === symbol)\n                return (\n                  <Badge\n                    key={symbol}\n                    variant=\"outline\"\n                    className={cn(\n                      'px-3 py-1 text-sm cursor-pointer',\n                      data && data.change >= 0 ? 'border-green-500 text-green-700' : 'border-red-500 text-red-700'\n                    )}\n                    style={{\n                      borderColor: data?.color,\n                      backgroundColor: data?.color + '10',\n                    }}\n                  >\n                    <span className=\"font-mono font-semibold mr-2\">{symbol}</span>\n                    {data && (\n                      <span className=\"text-xs\">\n                        {data.change >= 0 ? '+' : ''}\n                        {data.changePercent.toFixed(2)}%\n                      </span>\n                    )}\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation()\n                        handleRemoveSymbol(symbol)\n                      }}\n                      className=\"ml-2 hover:text-destructive\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </button>\n                  </Badge>\n                )\n              })}\n            </div>\n\n            {comparisonData.length > 0 && (\n              <>\n                <div className=\"h-80\">\n                  <Line data={{ labels, datasets }} options={chartOptions} />\n                </div>\n\n                {correlations.length > 0 && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-sm\">Correlation Matrix</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        {correlations.slice(0, 5).map((corr) => (\n                          <div\n                            key={corr.pair}\n                            className=\"flex items-center justify-between text-sm\"\n                          >\n                            <span className=\"font-mono\">{corr.pair.replace('-', ' vs ')}</span>\n                            <div className=\"flex items-center gap-2\">\n                              <div className=\"w-32 h-2 bg-muted rounded-full overflow-hidden\">\n                                <div\n                                  className={cn(\n                                    'h-full transition-all',\n                                    Math.abs(corr.value) > 0.7\n                                      ? 'bg-green-500'\n                                      : Math.abs(corr.value) > 0.4\n                                      ? 'bg-yellow-500'\n                                      : 'bg-red-500'\n                                  )}\n                                  style={{\n                                    width: `${Math.abs(corr.value) * 100}%`,\n                                    marginLeft: corr.value < 0 ? 'auto' : '0',\n                                  }}\n                                />\n                              </div>\n                              <span className=\"font-mono w-12 text-right\">\n                                {corr.value.toFixed(2)}\n                              </span>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n              </>\n            )}\n\n            {comparisonData.length === 0 && !loading && (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <Activity className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No symbols to compare</p>\n                <p className=\"text-sm\">Add symbols above or select a preset</p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useMemo, useCallback } from 'react'\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport {\n  TrendingUp,\n  TrendingDown,\n  Clock,\n  ChevronUp,\n  ChevronDown,\n  RefreshCw,\n  Maximize2,\n  ZoomIn,\n  ZoomOut,\n  ArrowLeft,\n  X,\n  Download,\n  FileImage,\n  FileText,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { useDownloadFile } from '@/hooks/useDownload'\n\nexport type Timeframe = '1D' | '1W' | '1M' | '3M' | 'YTD' | '1Y' | 'ALL'\n\nexport interface MarketSector {\n  id: string\n  name: string\n  change: number\n  changePercent: number\n  marketCap: number\n  volume: number\n  symbolCount: number\n  children?: MarketSymbol[]\n}\n\nexport interface MarketSymbol {\n  id: string\n  symbol: string\n  name: string\n  price: number\n  change: number\n  changePercent: number\n  marketCap: number\n  volume: number\n  sector: string\n}\n\nexport interface MarketHeatmapData {\n  sectors: MarketSector[]\n  lastUpdated: string\n}\n\ninterface MarketHeatmapProps {\n  data?: MarketHeatmapData\n  loading?: boolean\n  timeframe?: Timeframe\n  onTimeframeChange?: (timeframe: Timeframe) => void\n  onRefresh?: () => void\n  className?: string\n}\n\nconst TIMEFRAMES: Timeframe[] = ['1D', '1W', '1M', '3M', 'YTD', '1Y', 'ALL']\n\nfunction formatNumber(num: number): string {\n  if (num >= 1e12) return `${(num / 1e12).toFixed(2)}T`\n  if (num >= 1e9) return `${(num / 1e9).toFixed(2)}B`\n  if (num >= 1e6) return `${(num / 1e6).toFixed(2)}M`\n  if (num >= 1e3) return `${(num / 1e3).toFixed(2)}K`\n  return num.toFixed(2)\n}\n\nfunction formatPercent(value: number): string {\n  const sign = value >= 0 ? '+' : ''\n  return `${sign}${value.toFixed(2)}%`\n}\n\ninterface TreemapNodeProps {\n  node: MarketSector | MarketSymbol\n  level: number\n  totalSize: number\n  onNavigate: (node: MarketSector | MarketSymbol, level: number) => void\n  currentLevel: number\n}\n\nfunction TreemapNode({ node, level, totalSize, onNavigate, currentLevel }: TreemapNodeProps) {\n  const isPositive = node.change >= 0\n  const intensity = Math.min(Math.abs(node.changePercent) / 5, 1)\n  const baseColor = isPositive ? '22' : 'ef'\n  const alpha = Math.round(40 + intensity * 60).toString(16)\n  const bgColor = `#${baseColor}55${alpha}`\n\n  const size = Math.max((node.marketCap / totalSize) * 100, 5)\n\n  const isDrillable = 'children' in node && node.children && node.children.length > 0\n  const isSector = 'children' in node\n\n  const handleClick = () => {\n    if (isDrillable) {\n      onNavigate(node, level)\n    }\n  }\n\n  const displaySymbol = 'symbol' in node ? node.symbol : node.name.substring(0, 4).toUpperCase()\n  const displayName = 'symbol' in node ? node.name : node.name\n  const displayChange = formatPercent(node.changePercent)\n\n  return (\n    <Tooltip delayDuration={200}>\n      <TooltipTrigger asChild>\n        <div\n          className={cn(\n            'relative flex flex-col items-start justify-between p-3 cursor-pointer transition-all duration-200 hover:z-10 hover:scale-[1.02]',\n            isDrillable && 'cursor-pointer hover:ring-2 hover:ring-foreground',\n            currentLevel > level && currentLevel === level + 1 && node.id === 'back'\n          )}\n          style={{\n            backgroundColor: node.id === 'back' ? 'transparent' : bgColor,\n            border: node.id === 'back' ? '2px dashed hsl(var(--foreground) / 0.3)' : '1px solid hsl(var(--foreground) / 0.1)',\n            flexGrow: size,\n            minHeight: node.id === 'back' ? '40px' : '60px',\n          }}\n          onClick={handleClick}\n        >\n          {node.id === 'back' ? (\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <ArrowLeft className=\"h-4 w-4\" />\n              <span className=\"text-sm font-bold uppercase\">Back</span>\n            </div>\n          ) : (\n            <>\n              <div className=\"flex items-center justify-between w-full gap-1\">\n                <span className=\"font-black text-sm uppercase truncate max-w-[80%]\">\n                  {displaySymbol}\n                </span>\n                {isPositive ? (\n                  <TrendingUp className=\"h-3 w-3 text-green-500 shrink-0\" />\n                ) : (\n                  <TrendingDown className=\"h-3 w-3 text-red-500 shrink-0\" />\n                )}\n              </div>\n              <div className=\"flex items-center justify-between w-full gap-1\">\n                <span className={cn(\n                  'text-xs font-mono font-bold',\n                  isPositive ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'\n                )}>\n                  {displayChange}\n                </span>\n                <span className=\"text-[10px] text-muted-foreground font-mono truncate\">\n                  {formatNumber(node.marketCap)}\n                </span>\n              </div>\n              {'children' in node && (\n                <div className=\"absolute bottom-1 right-1\">\n                  <ChevronDown className=\"h-3 w-3 text-muted-foreground opacity-50\" />\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      </TooltipTrigger>\n      <TooltipContent\n        side=\"top\"\n        align=\"start\"\n        className=\"bg-background border-2 border-foreground p-4 shadow-[4px_4px_0px_0px_var(--foreground)] rounded-none max-w-xs\"\n      >\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"font-black uppercase\">{displaySymbol}</span>\n            <span className={cn(\n              'font-mono font-bold px-2 py-0.5 text-xs',\n              isPositive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\n            )}>\n              {displayChange}\n            </span>\n          </div>\n          <p className=\"text-sm text-muted-foreground font-medium\">{displayName}</p>\n          <div className=\"grid grid-cols-2 gap-2 text-xs\">\n            <div>\n              <span className=\"text-muted-foreground\">Market Cap:</span>\n              <span className=\"font-mono font-bold ml-2\">${formatNumber(node.marketCap)}</span>\n            </div>\n            <div>\n              <span className=\"text-muted-foreground\">Volume:</span>\n              <span className=\"font-mono font-bold ml-2\">{formatNumber(node.volume)}</span>\n            </div>\n            {'children' in node && (\n              <>\n                <div>\n                  <span className=\"text-muted-foreground\">Symbols:</span>\n                  <span className=\"font-mono font-bold ml-2\">{node.symbolCount}</span>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Change:</span>\n                  <span className={cn(\n                    'font-mono font-bold ml-2',\n                    isPositive ? 'text-green-600' : 'text-red-600'\n                  )}>\n                    {isPositive ? '+' : ''}{node.change.toFixed(2)}\n                  </span>\n                </div>\n              </>\n            )}\n          </div>\n          {isDrillable && (\n            <p className=\"text-[10px] text-muted-foreground uppercase font-bold\">Click to drill down</p>\n          )}\n        </div>\n      </TooltipContent>\n    </Tooltip>\n  )\n}\n\nfunction TreemapLayout({\n  items,\n  onNavigate,\n  level,\n  currentLevel,\n}: {\n  items: (MarketSector | MarketSymbol)[]\n  onNavigate: (node: MarketSector | MarketSymbol, level: number) => void\n  level: number\n  currentLevel: number\n}) {\n  const totalSize = useMemo(() =>\n    items.reduce((sum, item) => sum + item.marketCap, 0),\n    [items]\n  )\n\n  const sectors = items.filter((item): item is MarketSector => 'children' in item)\n  const symbols = items.filter((item): item is MarketSymbol => !('children' in item))\n\n  if (currentLevel > level) {\n    const backNode: MarketSector = {\n      id: 'back',\n      name: 'Back',\n      change: 0,\n      changePercent: 0,\n      marketCap: 0,\n      volume: 0,\n      symbolCount: 0,\n    }\n    return (\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-1\">\n        <TreemapNode\n          node={backNode}\n          level={level}\n          totalSize={totalSize}\n          onNavigate={onNavigate}\n          currentLevel={currentLevel}\n        />\n        {symbols.slice(0, 17).map((symbol) => (\n          <TreemapNode\n            key={symbol.id}\n            node={symbol}\n            level={level}\n            totalSize={totalSize}\n            onNavigate={onNavigate}\n            currentLevel={currentLevel}\n          />\n        ))}\n      </div>\n    )\n  }\n\n  if (sectors.length > 0) {\n    return (\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1\">\n        {sectors.map((sector) => (\n          <TreemapNode\n            key={sector.id}\n            node={sector}\n            level={level}\n            totalSize={totalSize}\n            onNavigate={onNavigate}\n            currentLevel={currentLevel}\n          />\n        ))}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-1\">\n      {symbols.slice(0, 24).map((symbol) => (\n        <TreemapNode\n          key={symbol.id}\n          node={symbol}\n          level={level}\n          totalSize={totalSize}\n          onNavigate={onNavigate}\n          currentLevel={currentLevel}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport function MarketHeatmap({\n  data,\n  loading = false,\n  timeframe = '1D',\n  onTimeframeChange,\n  onRefresh,\n  className,\n}: MarketHeatmapProps) {\n  const [currentLevel, setCurrentLevel] = useState(0)\n  const [selectedSector, setSelectedSector] = useState<MarketSector | null>(null)\n  const [isExporting, setIsExporting] = useState(false)\n  const { downloadCSV, downloadText } = useDownloadFile()\n\n  const handleNavigate = useCallback((node: MarketSector | MarketSymbol, level: number) => {\n    if ('children' in node && node.children && node.children.length > 0) {\n      setSelectedSector(node as MarketSector)\n      setCurrentLevel(level + 1)\n    }\n  }, [])\n\n  const handleBack = useCallback(() => {\n    setCurrentLevel(0)\n    setSelectedSector(null)\n  }, [])\n\n  const handleExportPNG = useCallback(async () => {\n    setIsExporting(true)\n    try {\n      const element = document.querySelector('.border-2.border-foreground.overflow-hidden') as HTMLElement\n      if (element && typeof window !== 'undefined') {\n        const html2canvasModule = await import('html2canvas')\n        const html2canvas = html2canvasModule.default\n        const canvas = await html2canvas(element, {\n          scale: 2,\n          backgroundColor: null,\n          logging: false,\n        })\n        \n        const filename = `market-heatmap-${timeframe}-${new Date().toISOString().slice(0, 10)}.png`\n        const dataUrl = canvas.toDataURL('image/png')\n        downloadText(dataUrl, filename, 'image/png')\n      }\n    } catch (err) {\n      console.error('Failed to export PNG:', err)\n    } finally {\n      setIsExporting(false)\n    }\n  }, [timeframe, downloadText])\n\n  const handleExportCSV = useCallback(() => {\n    if (!data) return\n    \n    const flattenData = (items: (MarketSector | MarketSymbol)[], level = 0): Record<string, any>[] => {\n      return items.flatMap(item => {\n        const base: Record<string, any> = {\n          name: item.name,\n          change: item.change,\n          changePercent: item.changePercent,\n          marketCap: item.marketCap,\n          volume: item.volume,\n          type: 'children' in item ? 'sector' : 'symbol',\n          level,\n        }\n        if ('children' in item && item.children) {\n          return [base, ...flattenData(item.children, level + 1)]\n        }\n        return [base]\n      })\n    }\n    \n    const csv = [\n      ['Name', 'Type', 'Change', 'Change %', 'Market Cap', 'Volume', 'Level'].join(','),\n      ...flattenData(currentLevel === 0 ? data.sectors : (selectedSector?.children || [])).map(row =>\n        [row.name, row.type, row.change, row.changePercent, row.marketCap, row.volume, row.level].join(',')\n      )\n    ].join('\\n')\n    \n    const filename = `market-heatmap-${timeframe}-${new Date().toISOString().slice(0, 10)}.csv`\n    downloadCSV(csv, filename)\n  }, [data, timeframe, currentLevel, selectedSector, downloadCSV])\n\n  const displayData = useMemo(() => {\n    if (!data) return null\n    if (currentLevel === 0) {\n      return data.sectors\n    }\n    return selectedSector?.children || []\n  }, [data, currentLevel, selectedSector])\n\n  const allPositive = displayData?.every(item => item.change >= 0)\n  const allNegative = displayData?.every(item => item.change < 0)\n\n  if (loading) {\n    return (\n      <Card className={cn('border-2 border-foreground', className)}>\n        <CardHeader className=\"border-b-2 border-foreground bg-muted/30\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Skeleton className=\"h-6 w-48\" />\n              <Skeleton className=\"h-4 w-32\" />\n            </div>\n            <div className=\"flex gap-2\">\n              <Skeleton className=\"h-8 w-16\" />\n              <Skeleton className=\"h-8 w-16\" />\n              <Skeleton className=\"h-8 w-16\" />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-4\">\n          <div className=\"grid grid-cols-4 gap-4\">\n            {[...Array(8)].map((_, i) => (\n              <Skeleton key={i} className=\"h-24 w-full\" />\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <Card className={cn('border-2 border-foreground overflow-hidden', className)}>\n      <CardHeader className=\"border-b-2 border-foreground bg-muted/30 py-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            {currentLevel > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleBack}\n                className=\"h-8 px-2 border border-foreground/20 hover:bg-foreground hover:text-background\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-1\" />\n                Back\n              </Button>\n            )}\n            <div>\n              <CardTitle className=\"text-lg font-black uppercase italic flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Market_Heatmap\n              </CardTitle>\n              <p className=\"text-xs font-mono text-muted-foreground\">\n                {currentLevel > 0 ? selectedSector?.name : 'S&P 500 Sectors'}\n              </p>\n            </div>\n          </div>\n\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex items-center border border-foreground/20\">\n                {TIMEFRAMES.map((tf) => (\n                  <Button\n                    key={tf}\n                    variant={timeframe === tf ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    onClick={() => onTimeframeChange?.(tf)}\n                    className={cn(\n                      'h-8 px-3 text-xs font-black uppercase rounded-none border-r border-foreground/20 last:border-r-0',\n                      timeframe === tf && 'bg-foreground text-background'\n                    )}\n                  >\n                    {tf}\n                  </Button>\n                ))}\n              </div>\n\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onRefresh}\n                className=\"h-8 w-8 border border-foreground/20\"\n              >\n                <RefreshCw className=\"h-4 w-4\" />\n              </Button>\n\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-8 w-8 border border-foreground/20\"\n                    disabled={isExporting}\n                  >\n                    <Download className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  <DropdownMenuItem onClick={handleExportPNG} disabled={isExporting}>\n                    <FileImage className=\"h-4 w-4 mr-2\" />\n                    Export as PNG\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={handleExportCSV} disabled={!data}>\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    Export as CSV\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"p-4 bg-muted/5\">\n        <TooltipProvider>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between text-xs\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-black uppercase text-muted-foreground\">Legend:</span>\n                  <div className=\"flex items-center gap-1\">\n                    <div className=\"w-4 h-4 bg-green-500/50 border border-foreground/20\" />\n                    <span className=\"font-mono uppercase\">Gainers</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <div className=\"w-4 h-4 bg-red-500/50 border border-foreground/20\" />\n                    <span className=\"font-mono uppercase\">Losers</span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <span className=\"font-mono text-[10px] uppercase text-muted-foreground\">\n                  Size = Market Cap\n                </span>\n              </div>\n            </div>\n\n            {displayData && displayData.length > 0 ? (\n              <TreemapLayout\n                items={displayData}\n                onNavigate={handleNavigate}\n                level={0}\n                currentLevel={currentLevel}\n              />\n            ) : (\n              <div className=\"h-[400px] flex items-center justify-center bg-muted/30 border-2 border-dashed border-foreground/20\">\n                <div className=\"text-center\">\n                  <TrendingUp className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n                  <p className=\"font-black uppercase text-muted-foreground\">No Data Available</p>\n                  <p className=\"text-xs font-mono text-muted-foreground\">Select a timeframe to view market data</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </TooltipProvider>\n      </CardContent>\n    </Card>\n  )\n}\n\nexport function MarketHeatmapSkeleton() {\n  return (\n    <Card className=\"border-2 border-foreground\">\n      <CardHeader className=\"border-b-2 border-foreground bg-muted/30\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"space-y-1\">\n            <Skeleton className=\"h-6 w-48\" />\n            <Skeleton className=\"h-4 w-32\" />\n          </div>\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-8 w-16\" />\n            <Skeleton className=\"h-8 w-16\" />\n            <Skeleton className=\"h-8 w-16\" />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-4\">\n        <div className=\"grid grid-cols-4 gap-4\">\n          {[...Array(8)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full\" />\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n","'use client'\n\nimport { useState, useMemo, useCallback, useRef, useEffect } from 'react'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  ZoomIn,\n  ZoomOut,\n  Download,\n  RefreshCw,\n  Settings2,\n  TrendingUp,\n  TrendingDown,\n  BarChart3,\n  Maximize2,\n  Minimize2,\n} from 'lucide-react'\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  Cell,\n  ReferenceLine,\n} from 'recharts'\nimport { cn } from '@/lib/utils'\nimport { useDownloadFile } from '@/hooks/useDownload'\n\nexport interface VolumeProfileData {\n  price: number\n  volume: number\n  volumePercent: number\n  cumulativeVolume: number\n  cumulativePercent: number\n  avgTradedPrice: number\n  tradingRange: {\n    low: number\n    high: number\n    pointOfControl: number\n    valueAreaHigh: number\n    valueAreaLow: number\n  }\n}\n\nexport interface VolumeProfilePoint {\n  price: number\n  volume: number\n  buys: number\n  sells: number\n  delta: number\n}\n\ninterface VolumeProfileChartProps {\n  data?: VolumeProfilePoint[]\n  symbol?: string\n  timeframe?: string\n  profileWidth?: number\n  showValueArea?: boolean\n  showPOC?: boolean\n  showVA?: boolean\n  colorScheme?: 'classic' | 'greenRed' | 'heat'\n  className?: string\n  onPointClick?: (point: VolumeProfilePoint) => void\n}\n\ninterface AxisTickProps {\n  x: number\n  y: number\n  payload: {\n    value: string | number\n  }\n}\n\nconst TIMEFRAMES = [\n  { value: '1d', label: '1 Day' },\n  { value: '5d', label: '5 Days' },\n  { value: '1w', label: '1 Week' },\n  { value: '1m', label: '1 Month' },\n  { value: '3m', label: '3 Months' },\n  { value: '6m', label: '6 Months' },\n  { value: '1y', label: '1 Year' },\n]\n\nconst COLOR_SCHEMES = {\n  classic: {\n    positive: '#22c55e',\n    negative: '#ef4444',\n    poc: '#f59e0b',\n    va: 'rgba(59, 130, 246, 0.2)',\n    background: 'rgba(255, 255, 255, 0.05)',\n  },\n  greenRed: {\n    positive: '#16a34a',\n    negative: '#dc2626',\n    poc: '#ea580c',\n    va: 'rgba(34, 197, 94, 0.15)',\n    background: 'rgba(0, 0, 0, 0.3)',\n  },\n  heat: {\n    positive: '#f97316',\n    negative: '#8b5cf6',\n    poc: '#eab308',\n    va: 'rgba(251, 191, 36, 0.2)',\n    background: 'rgba(139, 92, 246, 0.1)',\n  },\n}\n\nconst formatPrice = (price: number): string => {\n  if (price >= 1000) return `$${(price / 1000).toFixed(2)}K`\n  if (price >= 1) return `$${price.toFixed(2)}`\n  return `$${price.toFixed(4)}`\n}\n\nconst formatVolume = (volume: number): string => {\n  if (volume >= 1e9) return `${(volume / 1e9).toFixed(1)}B`\n  if (volume >= 1e6) return `${(volume / 1e6).toFixed(1)}M`\n  if (volume >= 1e3) return `${(volume / 1e3).toFixed(1)}K`\n  return volume.toString()\n}\n\nconst generateMockVolumeProfile = (\n  basePrice: number,\n  volatility: number = 0.02,\n  numRows: number = 30\n): VolumeProfilePoint[] => {\n  const data: VolumeProfilePoint[] = []\n  const priceStep = basePrice * volatility / numRows\n\n  for (let i = 0; i < numRows; i++) {\n    const price = basePrice - (numRows * priceStep / 2) + (i * priceStep)\n    const volume = Math.abs(Math.random() * 1000000 + Math.sin(i / 5) * 500000)\n    const buySellRatio = 0.4 + Math.random() * 0.2\n    const buys = volume * buySellRatio\n    const sells = volume * (1 - buySellRatio)\n\n    data.push({\n      price,\n      volume,\n      buys,\n      sells,\n      delta: buys - sells,\n    })\n  }\n\n  const pocIndex = data.findIndex(d => d.volume === Math.max(...data.map(x => x.volume)))\n  if (pocIndex !== -1) {\n    const pocVolume = data[pocIndex].volume\n    data.forEach((d, i) => {\n      const distance = Math.abs(i - pocIndex)\n      const falloff = Math.exp(-distance / 8)\n      d.volume += pocVolume * falloff * 0.3\n      d.buys *= 1 + falloff * 0.2\n      d.sells *= 1 - falloff * 0.1\n      d.delta = d.buys - d.sells\n    })\n  }\n\n  return data.sort((a, b) => b.price - a.price)\n}\n\nfunction PriceAxisTick({ x, y, payload }: AxisTickProps) {\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text\n        x={0}\n        y={0}\n        dy={4}\n        textAnchor=\"end\"\n        fill=\"currentColor\"\n        fontSize={11}\n        className=\"text-muted-foreground\"\n      >\n        {formatPrice(payload.value as number)}\n      </text>\n    </g>\n  )\n}\n\nfunction VolumeTooltip({ active, payload, label }: any) {\n  if (!active || !payload?.length) return null\n\n  const data = payload[0]?.payload as VolumeProfilePoint\n  if (!data) return null\n\n  return (\n    <Card className=\"bg-background/95 backdrop-blur-sm border-2\">\n      <CardContent className=\"p-3 space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"font-medium\">Price:</span>\n          <span>{formatPrice(data.price)}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-muted-foreground\">Total Volume:</span>\n          <span>{formatVolume(data.volume)}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-green-600\">Buys:</span>\n          <span>{formatVolume(data.buys)}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-red-600\">Sells:</span>\n          <span>{formatVolume(data.sells)}</span>\n        </div>\n        <div className=\"flex items-center justify-between pt-2 border-t\">\n          <span className=\"text-muted-foreground\">Delta:</span>\n          <span className={cn(data.delta > 0 ? 'text-green-600' : 'text-red-600')}>\n            {formatVolume(data.delta)}\n          </span>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction VolumeProfileCanvas({\n  data,\n  colors,\n  showPOC,\n  showVA,\n  poc,\n  valueAreaHigh,\n  valueAreaLow,\n  onPointClick,\n  profileWidth = 200,\n}: {\n  data: VolumeProfilePoint[]\n  colors: typeof COLOR_SCHEMES.classic\n  showPOC: boolean\n  showVA: boolean\n  poc: number\n  valueAreaHigh: number\n  valueAreaLow: number\n  onPointClick?: (point: VolumeProfilePoint) => void\n  profileWidth?: number\n}) {\n  const maxVolume = Math.max(...data.map(d => d.volume))\n  const maxDelta = Math.max(...data.map(d => Math.abs(d.delta)))\n\n  return (\n    <div className=\"relative h-full\">\n      {data.map((point, index) => {\n        const barWidth = (point.volume / maxVolume) * profileWidth\n        const isPOC = Math.abs(point.price - poc) < 0.001\n        const inVA = point.price >= valueAreaLow && point.price <= valueAreaHigh\n\n        const deltaPercent = Math.abs(point.delta) / maxDelta\n        const deltaBarWidth = deltaPercent * 40\n\n        return (\n          <div\n            key={index}\n            className={cn(\n              'absolute flex items-center h-5 transition-all hover:opacity-80 cursor-pointer',\n              onPointClick && 'cursor-pointer'\n            )}\n            style={{\n              top: `${(index / data.length) * 100}%`,\n              left: 0,\n              right: 0,\n              transform: 'translateY(-50%)',\n            }}\n            onClick={() => onPointClick?.(point)}\n          >\n            {point.delta > 0 ? (\n              <>\n                <div\n                  className=\"h-full bg-green-500/30 rounded-r\"\n                  style={{ width: `${deltaBarWidth}px` }}\n                />\n                <div\n                  className={cn(\n                    'h-full rounded-r',\n                    isPOC ? 'bg-yellow-500' : inVA ? colors.positive : 'bg-green-500/50'\n                  )}\n                  style={{ width: `${barWidth}px`, marginLeft: `${deltaBarWidth + 2}px` }}\n                />\n              </>\n            ) : (\n              <>\n                <div\n                  className={cn(\n                    'h-full rounded-l',\n                    isPOC ? 'bg-yellow-500' : inVA ? colors.negative : 'bg-red-500/50'\n                  )}\n                  style={{ width: `${barWidth}px` }}\n                />\n                <div\n                  className=\"h-full bg-red-500/30 rounded-l\"\n                  style={{ width: `${deltaBarWidth}px`, marginLeft: '2px' }}\n                />\n              </>\n            )}\n\n            <span\n              className=\"ml-2 text-xs text-muted-foreground absolute left-full whitespace-nowrap\"\n              style={{ left: `${profileWidth + 50}px` }}\n            >\n              {formatVolume(point.volume)}\n            </span>\n          </div>\n        )\n      })}\n\n      {showPOC && (\n        <div\n          className=\"absolute left-0 right-0 border-2 border-yellow-500 dashed opacity-60\"\n          style={{ top: `${(data.findIndex(d => Math.abs(d.price - poc) < 0.001) / data.length) * 100}%` }}\n        />\n      )}\n\n      {showVA && (\n        <>\n          <div\n            className=\"absolute left-0 right-0 border border-blue-400 opacity-30\"\n            style={{ top: `${(data.findIndex(d => Math.abs(d.price - valueAreaHigh) < 0.001) / data.length) * 100}%` }}\n          />\n          <div\n            className=\"absolute left-0 right-0 border border-blue-400 opacity-30\"\n            style={{ top: `${(data.findIndex(d => Math.abs(d.price - valueAreaLow) < 0.001) / data.length) * 100}%` }}\n          />\n          <div\n            className=\"absolute left-0 right-0 bg-blue-400/5\"\n            style={{\n              top: `${(data.findIndex(d => Math.abs(d.price - valueAreaHigh) < 0.001) / data.length) * 100}%`,\n              bottom: `${(1 - data.findIndex(d => Math.abs(d.price - valueAreaLow) / data.length) / data.length) * 100}%`,\n            }}\n          />\n        </>\n      )}\n    </div>\n  )\n}\n\nexport function VolumeProfileChart({\n  data: propData,\n  symbol = 'AAPL',\n  timeframe = '1d',\n  showValueArea = true,\n  showPOC = true,\n  showVA = true,\n  colorScheme = 'classic',\n  className,\n  onPointClick,\n}: VolumeProfileChartProps) {\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [timeframeValue, setTimeframeValue] = useState(timeframe)\n  const [colorSchemeValue, setColorSchemeValue] = useState(colorScheme)\n  const [showPOCValue, setShowPOCValue] = useState(showPOC)\n  const [showVAValue, setShowVAValue] = useState(showVA)\n  const [profileWidth, setProfileWidth] = useState(200)\n  const [isLoading, setIsLoading] = useState(false)\n\n  const data = useMemo(() => {\n    if (propData) return propData\n\n    const basePrice = 150 + Math.random() * 50\n    return generateMockVolumeProfile(basePrice)\n  }, [propData, timeframeValue])\n\n  const { downloadCSV } = useDownloadFile()\n\n  const calculations = useMemo(() => {\n    const totalVolume = data.reduce((sum, d) => sum + d.volume, 0)\n    const totalDelta = data.reduce((sum, d) => sum + d.delta, 0)\n\n    const poc = data.reduce((maxP, d) => (d.volume > maxP.volume ? d : maxP), data[0]).price\n    const totalVolAtPOC = data.find(d => Math.abs(d.price - poc) < 0.001)?.volume || 0\n\n    let volAccumulator = 0\n    let valueAreaHigh = poc\n    let valueAreaLow = poc\n\n    const sortedData = [...data].sort((a, b) => b.price - a.price)\n    const pocIndex = sortedData.findIndex(d => Math.abs(d.price - poc) < 0.001)\n\n    for (let i = 0; i < sortedData.length; i++) {\n      const currentPrice = sortedData[i].price\n      const currentVol = sortedData[i].volume\n\n      if (currentPrice >= poc) {\n        if (volAccumulator + currentVol <= totalVolume * 0.68) {\n          volAccumulator += currentVol\n          valueAreaHigh = currentPrice\n        }\n      } else {\n        if (volAccumulator + currentVol <= totalVolume * 0.68) {\n          volAccumulator += currentVol\n          valueAreaLow = currentPrice\n        }\n      }\n    }\n\n    const avgTradedPrice = data.reduce((sum, d) => sum + d.price * d.volume, 0) / totalVolume\n\n    return {\n      totalVolume,\n      totalDelta,\n      poc,\n      totalVolAtPOC,\n      valueAreaHigh,\n      valueAreaLow,\n      avgTradedPrice,\n      longVolume: data.filter(d => d.delta > 0).reduce((sum, d) => sum + d.volume, 0),\n      shortVolume: data.filter(d => d.delta < 0).reduce((sum, d) => sum + d.volume, 0),\n    }\n  }, [data])\n\n  const colors = COLOR_SCHEMES[colorSchemeValue]\n\n  const handleRefresh = useCallback(async () => {\n    setIsLoading(true)\n    await new Promise(resolve => setTimeout(resolve, 500))\n    setIsLoading(false)\n  }, [])\n\n  const handleExport = useCallback(() => {\n    const exportData = data.map(d => ({\n      price: d.price.toFixed(4),\n      volume: d.volume.toFixed(0),\n      buys: d.buys.toFixed(0),\n      sells: d.sells.toFixed(0),\n      delta: d.delta.toFixed(0),\n    }))\n    const csvContent = [\n      'Price,Volume,Buys,Sells,Delta',\n      ...data.map(d => `${d.price},${d.volume},${d.buys},${d.sells},${d.delta}`),\n    ].join('\\n')\n    downloadCSV(csvContent, `${symbol}_volume_profile`)\n  }, [data, symbol, downloadCSV])\n\n  const handleDownload = useCallback(() => {\n    const csvContent = [\n      'Price,Volume,Buys,Sells,Delta',\n      ...data.map(d => `${d.price},${d.volume},${d.buys},${d.sells},${d.delta}`),\n    ].join('\\n')\n    downloadCSV(csvContent, `${symbol}_volume_profile`)\n  }, [data, symbol, downloadCSV])\n\n  return (\n    <Card className={cn('relative', isFullscreen && 'fixed inset-0 z-50 m-0 rounded-none', className)}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5\" />\n              <CardTitle className=\"text-lg\">Volume Profile</CardTitle>\n            </div>\n            <Badge variant=\"outline\">{symbol}</Badge>\n            <Badge variant=\"secondary\">{timeframeValue}</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={timeframeValue} onValueChange={setTimeframeValue}>\n              <SelectTrigger className=\"w-28 h-8\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {TIMEFRAMES.map(tf => (\n                  <SelectItem key={tf.value} value={tf.value}>{tf.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select value={colorSchemeValue} onValueChange={(value: string) => setColorSchemeValue(value as \"classic\" | \"greenRed\" | \"heat\")}>\n              <SelectTrigger className=\"w-28 h-8\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"classic\">Classic</SelectItem>\n                <SelectItem value=\"greenRed\">Green/Red</SelectItem>\n                <SelectItem value=\"heat\">Heat</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Button variant=\"outline\" size=\"sm\" onClick={handleRefresh} disabled={isLoading}>\n              <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />\n            </Button>\n\n            <Button variant=\"outline\" size=\"sm\" onClick={handleExport}>\n              <Download className=\"h-4 w-4\" />\n            </Button>\n\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setIsFullscreen(!isFullscreen)}>\n              {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\n          <div className=\"p-3 bg-muted/50 rounded-lg\">\n            <div className=\"text-xs text-muted-foreground mb-1\">Total Volume</div>\n            <div className=\"text-lg font-bold\">{formatVolume(calculations.totalVolume)}</div>\n          </div>\n          <div className=\"p-3 bg-muted/50 rounded-lg\">\n            <div className=\"text-xs text-muted-foreground mb-1\">Point of Control</div>\n            <div className=\"text-lg font-bold text-yellow-500\">{formatPrice(calculations.poc)}</div>\n          </div>\n          <div className=\"p-3 bg-muted/50 rounded-lg\">\n            <div className=\"text-xs text-muted-foreground mb-1\">Value Area (68%)</div>\n            <div className=\"text-lg font-bold text-blue-500\">\n              {formatPrice(calculations.valueAreaLow)} - {formatPrice(calculations.valueAreaHigh)}\n            </div>\n          </div>\n          <div className=\"p-3 bg-muted/50 rounded-lg\">\n            <div className=\"text-xs text-muted-foreground mb-1\">Delta</div>\n            <div className={cn('text-lg font-bold', calculations.totalDelta > 0 ? 'text-green-500' : 'text-red-500')}>\n              {calculations.totalDelta > 0 ? '+' : ''}{formatVolume(calculations.totalDelta)}\n            </div>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"profile\" className=\"w-full\">\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"profile\">Profile View</TabsTrigger>\n            <TabsTrigger value=\"bar\">Bar Chart</TabsTrigger>\n            <TabsTrigger value=\"delta\">Delta View</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"profile\" className=\"h-96\">\n            <div className=\"flex gap-4 h-full\">\n              <div className=\"flex-1 relative pl-20\">\n                <div className=\"absolute left-0 top-0 bottom-0 w-16 flex flex-col justify-between py-2\">\n                  <div className=\"text-xs text-muted-foreground text-center\">\n                    {formatPrice(data[0]?.price || 0)}\n                  </div>\n                  <div className=\"text-xs text-muted-foreground text-center\">\n                    {formatPrice(data[Math.floor(data.length / 2)]?.price || 0)}\n                  </div>\n                  <div className=\"text-xs text-muted-foreground text-center\">\n                    {formatPrice(data[data.length - 1]?.price || 0)}\n                  </div>\n                </div>\n\n                <VolumeProfileCanvas\n                  data={data}\n                  colors={colors}\n                  showPOC={showPOCValue}\n                  showVA={showVAValue}\n                  poc={calculations.poc}\n                  valueAreaHigh={calculations.valueAreaHigh}\n                  valueAreaLow={calculations.valueAreaLow}\n                  onPointClick={onPointClick}\n                  profileWidth={profileWidth}\n                />\n\n                <div className=\"absolute right-0 top-0 bottom-0 w-24 flex flex-col justify-center items-center border-l border-dashed border-muted-foreground/30\">\n                  <div className=\"text-xs text-muted-foreground mb-2\">Profile</div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-col gap-1\">\n                <div className=\"flex gap-1\">\n                  <Button\n                    variant={showPOCValue ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setShowPOCValue(!showPOCValue)}\n                    className=\"text-xs\"\n                  >\n                    POC\n                  </Button>\n                  <Button\n                    variant={showVAValue ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setShowVAValue(!showVAValue)}\n                    className=\"text-xs\"\n                  >\n                    VA\n                  </Button>\n                </div>\n                <div className=\"flex-1\" />\n                <div className=\"flex gap-1\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setProfileWidth(Math.max(100, profileWidth - 25))}\n                    className=\"h-6 w-6 p-0\"\n                  >\n                    <ZoomOut className=\"h-3 w-3\" />\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setProfileWidth(Math.min(300, profileWidth + 25))}\n                    className=\"h-6 w-6 p-0\"\n                  >\n                    <ZoomIn className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"bar\" className=\"h-96\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart\n                data={data}\n                layout=\"vertical\"\n                margin={{ top: 10, right: 30, left: 60, bottom: 10 }}\n              >\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis\n                  type=\"number\"\n                  tickFormatter={(v) => formatVolume(v as number)}\n                  className=\"text-xs\"\n                />\n                <YAxis\n                  type=\"number\"\n                  domain={['dataMin', 'dataMax']}\n                  tickFormatter={(v) => formatPrice(v as number)}\n                  className=\"text-xs\"\n                  width={60}\n                />\n                <Tooltip content={<VolumeTooltip />} />\n                <Bar dataKey=\"volume\" radius={[0, 4, 4, 0]}>\n                  {data.map((entry, index) => (\n                    <Cell\n                      key={`cell-${index}`}\n                      fill={entry.delta > 0 ? colors.positive : colors.negative}\n                    />\n                  ))}\n                </Bar>\n              </BarChart>\n            </ResponsiveContainer>\n          </TabsContent>\n\n          <TabsContent value=\"delta\" className=\"h-96\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart\n                data={data}\n                layout=\"vertical\"\n                margin={{ top: 10, right: 30, left: 60, bottom: 10 }}\n              >\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis\n                  type=\"number\"\n                  tickFormatter={(v) => formatVolume(Math.abs(v as number))}\n                  className=\"text-xs\"\n                />\n                <YAxis\n                  type=\"number\"\n                  domain={['dataMin', 'dataMax']}\n                  tickFormatter={(v) => formatPrice(v as number)}\n                  className=\"text-xs\"\n                  width={60}\n                />\n                <Tooltip content={<VolumeTooltip />} />\n                <Bar dataKey=\"delta\" radius={[0, 4, 4, 0]}>\n                  {data.map((entry, index) => (\n                    <Cell\n                      key={`cell-${index}`}\n                      fill={entry.delta > 0 ? colors.positive : colors.negative}\n                    />\n                  ))}\n                </Bar>\n              </BarChart>\n            </ResponsiveContainer>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"flex items-center justify-center gap-6 mt-4 text-xs text-muted-foreground\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded bg-green-500\" />\n            <span>Buying (Delta +)</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded bg-red-500\" />\n            <span>Selling (Delta -)</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded bg-yellow-500\" />\n            <span>Point of Control</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-3 h-3 rounded bg-blue-500/30\" />\n            <span>Value Area (68%)</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nexport default VolumeProfileChart\n","'use client'\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  ColorType,\n  CrosshairMode,\n  Time,\n  MouseEventParams,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Card } from '@/components/ui/card'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Download,\n  RefreshCw,\n  TrendingUp,\n  TrendingDown,\n  Maximize2,\n  Minimize2,\n} from 'lucide-react'\nimport { useDownload } from '@/hooks/useDownload'\nimport { cn } from '@/lib/utils'\n\nexport type Timeframe = '1m' | '5m' | '15m' | '1h' | '4h' | '1d' | '1w' | '1M'\n\nexport interface CandlestickData {\n  time: Time\n  open: number\n  high: number\n  low: number\n  close: number\n  volume?: number\n}\n\ninterface CandlestickChartProps {\n  data?: CandlestickData[]\n  symbol?: string\n  timeframe?: Timeframe\n  height?: number\n  showVolume?: boolean\n  showToolbar?: boolean\n  className?: string\n}\n\nexport function CandlestickChart({\n  data: externalData,\n  symbol = 'BTC/USD',\n  timeframe: initialTimeframe = '1h',\n  height = 400,\n  showVolume = true,\n  showToolbar = true,\n  className,\n}: CandlestickChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const candlestickSeriesRef = useRef<ISeriesApi<'Candlestick'> | null>(null)\n  const volumeSeriesRef = useRef<ISeriesApi<'Histogram'> | null>(null)\n  \n  const { theme } = useTheme()\n  const { download } = useDownload()\n  \n  const [timeframe, setTimeframe] = useState<Timeframe>(initialTimeframe)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const colors = useMemo(() => ({\n    background: theme === 'dark' ? '#0a0a0a' : '#ffffff',\n    grid: theme === 'dark' ? '#1a1a1a' : '#e5e5e5',\n    text: theme === 'dark' ? '#a0a0a0' : '#666666',\n    upColor: '#26a69a',\n    downColor: '#ef5350',\n    wickUpColor: '#26a69a',\n    wickDownColor: '#ef5350',\n    volumeUpColor: 'rgba(38, 166, 154, 0.5)',\n    volumeDownColor: 'rgba(239, 83, 80, 0.5)',\n  }), [theme])\n\n  const data = useMemo(() => {\n    if (externalData) return externalData\n    \n    const mockData: CandlestickData[] = []\n    let price = 50000 + Math.random() * 5000\n    const now = Date.now()\n    const interval = 60000\n    \n    for (let i = 0; i < 200; i++) {\n      const time = Math.floor((now - (200 - i) * interval) / 1000) as Time\n      const volatility = 0.02\n      \n      const open = price\n      const change = (Math.random() - 0.5) * volatility * price\n      const close = open + change\n      const high = Math.max(open, close) + Math.random() * volatility * price * 0.5\n      const low = Math.min(open, close) - Math.random() * volatility * price * 0.5\n      const volume = Math.floor(Math.random() * 1000000) + 100000\n      \n      mockData.push({\n        time,\n        open,\n        high,\n        low,\n        close,\n        volume,\n      })\n      \n      price = close\n    }\n    \n    return mockData\n  }, [externalData, symbol, timeframe])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      width: chartContainerRef.current.clientWidth,\n      height: isFullscreen ? window.innerHeight - 100 : height,\n      layout: {\n        background: { type: ColorType.Solid, color: colors.background },\n        textColor: colors.text,\n      },\n      grid: {\n        vertLines: { color: colors.grid },\n        horzLines: { color: colors.grid },\n      },\n      crosshair: {\n        mode: CrosshairMode.Normal,\n      },\n      rightPriceScale: {\n        borderColor: colors.grid,\n      },\n      timeScale: {\n        borderColor: colors.grid,\n        timeVisible: true,\n        secondsVisible: false,\n      },\n    })\n\n    chartRef.current = chart\n\n    const chartAny = chart as unknown as any\n\n    const candlestickSeries = chartAny.addCandlestickSeries({\n      upColor: colors.upColor,\n      downColor: colors.downColor,\n      borderDownColor: colors.downColor,\n      borderUpColor: colors.upColor,\n      wickDownColor: colors.wickDownColor,\n      wickUpColor: colors.wickUpColor,\n    })\n\n    candlestickSeriesRef.current = candlestickSeries\n\n    if (showVolume) {\n      const volumeSeries = chartAny.addHistogramSeries({\n        color: colors.volumeDownColor,\n        priceFormat: {\n          type: 'volume',\n        },\n        priceScaleId: 'volume',\n      })\n\n      volumeSeries.priceScale().applyOptions({\n        scaleMargins: {\n          top: 0.8,\n          bottom: 0,\n        },\n      })\n\n      volumeSeriesRef.current = volumeSeries\n    }\n\n    const handleResize = () => {\n      if (chartContainerRef.current && chartRef.current) {\n        chartRef.current.applyOptions({\n          width: chartContainerRef.current.clientWidth,\n          height: isFullscreen ? window.innerHeight - 100 : height,\n        })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      if (chartRef.current) {\n        chartRef.current.remove()\n        chartRef.current = null\n      }\n    }\n  }, [colors, height, showVolume, isFullscreen])\n\n  useEffect(() => {\n    if (candlestickSeriesRef.current) {\n      candlestickSeriesRef.current.setData(data)\n    }\n\n    if (volumeSeriesRef.current && showVolume) {\n      const volumeData = data.map((d) => ({\n        time: d.time,\n        value: d.volume || 0,\n        color: d.close >= d.open ? colors.volumeUpColor : colors.volumeDownColor,\n      }))\n      volumeSeriesRef.current.setData(volumeData)\n    }\n  }, [data, showVolume, colors.volumeUpColor, colors.volumeDownColor])\n\n  const handleRefresh = useCallback(async () => {\n    setIsLoading(true)\n    setError(null)\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 1000))\n    } catch (err) {\n      setError('Failed to refresh data')\n    } finally {\n      setIsLoading(false)\n    }\n  }, [])\n\n  const handleDownloadImage = useCallback(() => {\n    if (chartRef.current) {\n      const canvas = chartContainerRef.current?.querySelector('canvas')\n      if (canvas) {\n        canvas.toBlob((blob) => {\n          if (blob) {\n            download(blob, { filename: `${symbol.replace('/', '-')}-candlestick-${timeframe}.png`, mimeType: 'image/png' })\n          }\n        })\n      }\n    }\n  }, [chartRef, download, symbol, timeframe])\n\n  const currentPrice = data[data.length - 1]\n  const previousPrice = data[data.length - 2]\n  const priceChange = currentPrice ? ((currentPrice.close - previousPrice.close) / previousPrice.close) * 100 : 0\n\n  return (\n    <Card className={cn('relative', className)}>\n      {showToolbar && (\n        <div className=\"absolute top-2 right-2 z-10 flex items-center gap-2\">\n          <Badge variant={priceChange >= 0 ? 'default' : 'destructive'}>\n            {priceChange >= 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : <TrendingDown className=\"h-3 w-3 mr-1\" />}\n            {priceChange.toFixed(2)}%\n          </Badge>\n          \n          <Select value={timeframe} onValueChange={(value) => setTimeframe(value as Timeframe)}>\n            <SelectTrigger className=\"h-8 w-[80px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"1m\">1m</SelectItem>\n              <SelectItem value=\"5m\">5m</SelectItem>\n              <SelectItem value=\"15m\">15m</SelectItem>\n              <SelectItem value=\"1h\">1H</SelectItem>\n              <SelectItem value=\"4h\">4H</SelectItem>\n              <SelectItem value=\"1d\">1D</SelectItem>\n              <SelectItem value=\"1w\">1W</SelectItem>\n              <SelectItem value=\"1M\">1M</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleRefresh}\n            disabled={isLoading}\n            className=\"h-8 w-8\"\n          >\n            <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleDownloadImage}\n            className=\"h-8 w-8\"\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsFullscreen(!isFullscreen)}\n            className=\"h-8 w-8\"\n          >\n            {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n      )}\n\n      <div ref={chartContainerRef} className=\"w-full\" />\n      \n      {error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-background/80\">\n          <div className=\"text-center\">\n            <p className=\"text-destructive font-medium\">{error}</p>\n            <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={handleRefresh}>\n              Retry\n            </Button>\n          </div>\n        </div>\n      )}\n    </Card>\n  )\n}\n","'use client'\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  ColorType,\n  CrosshairMode,\n  Time,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Card } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Download,\n  RefreshCw,\n  TrendingUp,\n  TrendingDown,\n  Maximize2,\n  Minimize2,\n} from 'lucide-react'\nimport { useDownload } from '@/hooks/useDownload'\nimport { cn } from '@/lib/utils'\n\nexport type Timeframe = '1m' | '5m' | '15m' | '1h' | '4h' | '1d' | '1w' | '1M'\n\nexport interface LineData {\n  time: Time\n  value: number\n}\n\ninterface LineChartProps {\n  data?: LineData[]\n  symbol?: string\n  timeframe?: Timeframe\n  height?: number\n  showToolbar?: boolean\n  lineColor?: string\n  lineWidth?: number\n  lineType?: 'solid' | 'dotted' | 'dashed'\n  className?: string\n}\n\nexport function LineChart({\n  data: externalData,\n  symbol = 'BTC/USD',\n  timeframe: initialTimeframe = '1h',\n  height = 400,\n  showToolbar = true,\n  lineColor,\n  lineWidth = 2,\n  lineType = 'solid',\n  className,\n}: LineChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const lineSeriesRef = useRef<ISeriesApi<'Line'> | null>(null)\n  \n  const { theme } = useTheme()\n  const { download } = useDownload()\n  \n  const [timeframe, setTimeframe] = useState<Timeframe>(initialTimeframe)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const colors = useMemo(() => {\n    const defaultLineColor = theme === 'dark' ? '#26a69a' : '#0ea5e9'\n    return {\n      background: theme === 'dark' ? '#0a0a0a' : '#ffffff',\n      grid: theme === 'dark' ? '#1a1a1a' : '#e5e5e5',\n      text: theme === 'dark' ? '#a0a0a0' : '#666666',\n      line: lineColor || defaultLineColor,\n    }\n  }, [theme, lineColor])\n\n  const data = useMemo(() => {\n    if (externalData) return externalData\n    \n    const mockData: LineData[] = []\n    let value = 50000 + Math.random() * 5000\n    const now = Date.now()\n    const interval = 60000\n    \n    for (let i = 0; i < 200; i++) {\n      const time = Math.floor((now - (200 - i) * interval) / 1000) as Time\n      const change = (Math.random() - 0.5) * 500\n      value = Math.max(value + change, 1000)\n      \n      mockData.push({\n        time,\n        value,\n      })\n    }\n    \n    return mockData\n  }, [externalData, symbol, timeframe])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      width: chartContainerRef.current.clientWidth,\n      height: isFullscreen ? window.innerHeight - 100 : height,\n      layout: {\n        background: { type: ColorType.Solid, color: colors.background },\n        textColor: colors.text,\n      },\n      grid: {\n        vertLines: { color: colors.grid },\n        horzLines: { color: colors.grid },\n      },\n      crosshair: {\n        mode: CrosshairMode.Normal,\n      },\n      rightPriceScale: {\n        borderColor: colors.grid,\n      },\n      timeScale: {\n        borderColor: colors.grid,\n        timeVisible: true,\n        secondsVisible: false,\n      },\n    })\n\n    chartRef.current = chart\n\n    const chartAny = chart as unknown as any\n\n    const lineSeries = chartAny.addLineSeries({\n      color: colors.line,\n      lineWidth,\n      lineType: lineType === 'dotted' ? 2 : lineType === 'dashed' ? 3 : 0,\n      priceLineVisible: false,\n    })\n\n    lineSeriesRef.current = lineSeries\n\n    const handleResize = () => {\n      if (chartContainerRef.current && chartRef.current) {\n        chartRef.current.applyOptions({\n          width: chartContainerRef.current.clientWidth,\n          height: isFullscreen ? window.innerHeight - 100 : height,\n        })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      if (chartRef.current) {\n        chartRef.current.remove()\n        chartRef.current = null\n      }\n    }\n  }, [colors, height, lineWidth, lineType, isFullscreen])\n\n  useEffect(() => {\n    if (lineSeriesRef.current) {\n      lineSeriesRef.current.setData(data)\n    }\n  }, [data])\n\n  const handleRefresh = useCallback(async () => {\n    setIsLoading(true)\n    setError(null)\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 1000))\n    } catch (err) {\n      setError('Failed to refresh data')\n    } finally {\n      setIsLoading(false)\n    }\n  }, [])\n\n  const handleDownloadImage = useCallback(() => {\n    if (chartRef.current) {\n      const canvas = chartContainerRef.current?.querySelector('canvas')\n      if (canvas) {\n        canvas.toBlob((blob) => {\n          if (blob) {\n            download(blob, { filename: `${symbol.replace('/', '-')}-line-${timeframe}.png`, mimeType: 'image/png' })\n          }\n        })\n      }\n    }\n  }, [chartRef, download, symbol, timeframe])\n\n  const currentValue = data[data.length - 1]\n  const previousValue = data[data.length - 2]\n  const priceChange = currentValue && previousValue ? ((currentValue.value - previousValue.value) / previousValue.value) * 100 : 0\n\n  return (\n    <Card className={cn('relative', className)}>\n      {showToolbar && (\n        <div className=\"absolute top-2 right-2 z-10 flex items-center gap-2\">\n          <Badge variant={priceChange >= 0 ? 'default' : 'destructive'}>\n            {priceChange >= 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : <TrendingDown className=\"h-3 w-3 mr-1\" />}\n            {priceChange.toFixed(2)}%\n          </Badge>\n          \n          <Select value={timeframe} onValueChange={(value) => setTimeframe(value as Timeframe)}>\n            <SelectTrigger className=\"h-8 w-[80px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"1m\">1m</SelectItem>\n              <SelectItem value=\"5m\">5m</SelectItem>\n              <SelectItem value=\"15m\">15m</SelectItem>\n              <SelectItem value=\"1h\">1H</SelectItem>\n              <SelectItem value=\"4h\">4H</SelectItem>\n              <SelectItem value=\"1d\">1D</SelectItem>\n              <SelectItem value=\"1w\">1W</SelectItem>\n              <SelectItem value=\"1M\">1M</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleRefresh}\n            disabled={isLoading}\n            className=\"h-8 w-8\"\n          >\n            <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleDownloadImage}\n            className=\"h-8 w-8\"\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsFullscreen(!isFullscreen)}\n            className=\"h-8 w-8\"\n          >\n            {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n      )}\n\n      <div ref={chartContainerRef} className=\"w-full\" />\n      \n      {error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-background/80\">\n          <div className=\"text-center\">\n            <p className=\"text-destructive font-medium\">{error}</p>\n            <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={handleRefresh}>\n              Retry\n            </Button>\n          </div>\n        </div>\n      )}\n    </Card>\n  )\n}\n","'use client'\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from 'react'\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  ColorType,\n  CrosshairMode,\n  Time,\n} from 'lightweight-charts'\nimport { useTheme } from 'next-themes'\nimport { Card } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Download,\n  RefreshCw,\n  TrendingUp,\n  TrendingDown,\n  Maximize2,\n  Minimize2,\n} from 'lucide-react'\nimport { useDownload } from '@/hooks/useDownload'\nimport { cn } from '@/lib/utils'\n\nexport type Timeframe = '1m' | '5m' | '15m' | '1h' | '4h' | '1d' | '1w' | '1M'\n\nexport interface AreaData {\n  time: Time\n  value: number\n}\n\ninterface AreaChartProps {\n  data?: AreaData[]\n  symbol?: string\n  timeframe?: Timeframe\n  height?: number\n  showToolbar?: boolean\n  lineColor?: string\n  topColor?: string\n  bottomColor?: string\n  lineWidth?: number\n  className?: string\n}\n\nexport function AreaChart({\n  data: externalData,\n  symbol = 'BTC/USD',\n  timeframe: initialTimeframe = '1h',\n  height = 400,\n  showToolbar = true,\n  lineColor,\n  topColor,\n  bottomColor,\n  lineWidth = 2,\n  className,\n}: AreaChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const areaSeriesRef = useRef<ISeriesApi<'Area'> | null>(null)\n  \n  const { theme } = useTheme()\n  const { download } = useDownload()\n  \n  const [timeframe, setTimeframe] = useState<Timeframe>(initialTimeframe)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const colors = useMemo(() => {\n    const defaultLineColor = theme === 'dark' ? '#26a69a' : '#0ea5e9'\n    const defaultTopColor = theme === 'dark' ? 'rgba(38, 166, 154, 0.4)' : 'rgba(14, 165, 233, 0.4)'\n    const defaultBottomColor = theme === 'dark' ? 'rgba(38, 166, 154, 0.0)' : 'rgba(14, 165, 233, 0.0)'\n    \n    return {\n      background: theme === 'dark' ? '#0a0a0a' : '#ffffff',\n      grid: theme === 'dark' ? '#1a1a1a' : '#e5e5e5',\n      text: theme === 'dark' ? '#a0a0a0' : '#666666',\n      line: lineColor || defaultLineColor,\n      top: topColor || defaultTopColor,\n      bottom: bottomColor || defaultBottomColor,\n    }\n  }, [theme, lineColor, topColor, bottomColor])\n\n  const data = useMemo(() => {\n    if (externalData) return externalData\n    \n    const mockData: AreaData[] = []\n    let value = 50000 + Math.random() * 5000\n    const now = Date.now()\n    const interval = 60000\n    \n    for (let i = 0; i < 200; i++) {\n      const time = Math.floor((now - (200 - i) * interval) / 1000) as Time\n      const change = (Math.random() - 0.5) * 500\n      value = Math.max(value + change, 1000)\n      \n      mockData.push({\n        time,\n        value,\n      })\n    }\n    \n    return mockData\n  }, [externalData, symbol, timeframe])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      width: chartContainerRef.current.clientWidth,\n      height: isFullscreen ? window.innerHeight - 100 : height,\n      layout: {\n        background: { type: ColorType.Solid, color: colors.background },\n        textColor: colors.text,\n      },\n      grid: {\n        vertLines: { color: colors.grid },\n        horzLines: { color: colors.grid },\n      },\n      crosshair: {\n        mode: CrosshairMode.Normal,\n      },\n      rightPriceScale: {\n        borderColor: colors.grid,\n      },\n      timeScale: {\n        borderColor: colors.grid,\n        timeVisible: true,\n        secondsVisible: false,\n      },\n    })\n\n    chartRef.current = chart\n\n    const chartAny = chart as unknown as any\n\n    const areaSeries = chartAny.addAreaSeries({\n      lineColor: colors.line,\n      topColor: colors.top,\n      bottomColor: colors.bottom,\n      lineWidth,\n      priceLineVisible: false,\n    })\n\n    areaSeriesRef.current = areaSeries\n\n    const handleResize = () => {\n      if (chartContainerRef.current && chartRef.current) {\n        chartRef.current.applyOptions({\n          width: chartContainerRef.current.clientWidth,\n          height: isFullscreen ? window.innerHeight - 100 : height,\n        })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      if (chartRef.current) {\n        chartRef.current.remove()\n        chartRef.current = null\n      }\n    }\n  }, [colors, height, lineWidth, isFullscreen])\n\n  useEffect(() => {\n    if (areaSeriesRef.current) {\n      areaSeriesRef.current.setData(data)\n    }\n  }, [data])\n\n  const handleRefresh = useCallback(async () => {\n    setIsLoading(true)\n    setError(null)\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 1000))\n    } catch (err) {\n      setError('Failed to refresh data')\n    } finally {\n      setIsLoading(false)\n    }\n  }, [])\n\n  const handleDownloadImage = useCallback(() => {\n    if (chartRef.current) {\n      const canvas = chartContainerRef.current?.querySelector('canvas')\n      if (canvas) {\n        canvas.toBlob((blob) => {\n          if (blob) {\n            download(blob, { filename: `${symbol.replace('/', '-')}-area-${timeframe}.png`, mimeType: 'image/png' })\n          }\n        })\n      }\n    }\n  }, [chartRef, download, symbol, timeframe])\n\n  const currentValue = data[data.length - 1]\n  const previousValue = data[data.length - 2]\n  const priceChange = currentValue && previousValue ? ((currentValue.value - previousValue.value) / previousValue.value) * 100 : 0\n\n  return (\n    <Card className={cn('relative', className)}>\n      {showToolbar && (\n        <div className=\"absolute top-2 right-2 z-10 flex items-center gap-2\">\n          <Badge variant={priceChange >= 0 ? 'default' : 'destructive'}>\n            {priceChange >= 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : <TrendingDown className=\"h-3 w-3 mr-1\" />}\n            {priceChange.toFixed(2)}%\n          </Badge>\n          \n          <Select value={timeframe} onValueChange={(value) => setTimeframe(value as Timeframe)}>\n            <SelectTrigger className=\"h-8 w-[80px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"1m\">1m</SelectItem>\n              <SelectItem value=\"5m\">5m</SelectItem>\n              <SelectItem value=\"15m\">15m</SelectItem>\n              <SelectItem value=\"1h\">1H</SelectItem>\n              <SelectItem value=\"4h\">4H</SelectItem>\n              <SelectItem value=\"1d\">1D</SelectItem>\n              <SelectItem value=\"1w\">1W</SelectItem>\n              <SelectItem value=\"1M\">1M</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleRefresh}\n            disabled={isLoading}\n            className=\"h-8 w-8\"\n          >\n            <RefreshCw className={cn('h-4 w-4', isLoading && 'animate-spin')} />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleDownloadImage}\n            className=\"h-8 w-8\"\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsFullscreen(!isFullscreen)}\n            className=\"h-8 w-8\"\n          >\n            {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n      )}\n\n      <div ref={chartContainerRef} className=\"w-full\" />\n      \n      {error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-background/80\">\n          <div className=\"text-center\">\n            <p className=\"text-destructive font-medium\">{error}</p>\n            <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={handleRefresh}>\n              Retry\n            </Button>\n          </div>\n        </div>\n      )}\n    </Card>\n  )\n}\n","'use client'\n\nimport { useMemo, useRef, useEffect, useState } from 'react'\nimport { createChart, ColorType, IChartApi, ISeriesApi, CandlestickData, Time } from 'lightweight-charts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { cn } from '@/lib/utils'\nimport { RefreshCw } from 'lucide-react'\n\nexport interface HeikinAshiData {\n  time: string\n  open: number\n  high: number\n  low: number\n  close: number\n  volume?: number\n}\n\ninterface HeikinAshiChartProps {\n  data: HeikinAshiData[]\n  className?: string\n  height?: number\n  showVolume?: boolean\n  onSymbolChange?: (symbol: string) => void\n}\n\nfunction calculateHeikinAshi(data: { time: string; open: number; high: number; low: number; close: number; volume?: number }[]): HeikinAshiData[] {\n  if (data.length === 0) return []\n\n  const result: HeikinAshiData[] = []\n  let prevHaOpen = data[0].open\n  let prevHaClose = data[0].close\n\n  for (let i = 0; i < data.length; i++) {\n    const candle = data[i]\n    const haClose = (candle.open + candle.high + candle.low + candle.close) / 4\n    const haOpen = (prevHaOpen + prevHaClose) / 2\n    const haHigh = Math.max(candle.high, Math.max(haOpen, haClose))\n    const haLow = Math.min(candle.low, Math.min(haOpen, haClose))\n\n    result.push({\n      time: candle.time,\n      open: haOpen,\n      high: haHigh,\n      low: haLow,\n      close: haClose,\n      volume: candle.volume\n    })\n\n    prevHaOpen = haOpen\n    prevHaClose = haClose\n  }\n\n  return result\n}\n\nexport function HeikinAshiChart({\n  data,\n  className,\n  height = 400,\n  showVolume = true,\n  onSymbolChange\n}: HeikinAshiChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const seriesRef = useRef<ISeriesApi<'Candlestick'> | null>(null)\n  const volumeSeriesRef = useRef<ISeriesApi<'Histogram'> | null>(null)\n  const [chartType, setChartType] = useState<'heikin-ashi' | 'traditional'>('heikin-ashi')\n\n  const processedData = useMemo(() => {\n    if (chartType === 'heikin-ashi') {\n      return calculateHeikinAshi(data)\n    }\n    return data.map(d => ({\n      time: d.time,\n      open: d.open,\n      high: d.high,\n      low: d.low,\n      close: d.close,\n      volume: d.volume\n    }))\n  }, [data, chartType])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      layout: {\n        background: { type: ColorType.Solid, color: 'transparent' },\n        textColor: 'hsl(var(--muted-foreground))'\n      },\n      grid: {\n        vertLines: { color: 'hsl(var(--border))' },\n        horzLines: { color: 'hsl(var(--border))' }\n      },\n      width: chartContainerRef.current.clientWidth,\n      height: height,\n      timeScale: {\n        timeVisible: true,\n        secondsVisible: false,\n      }\n    })\n\n    chartRef.current = chart\n\n    const candlestickSeries = (chart as any).addCandlestickSeries({\n      upColor: '#22c55e',\n      downColor: '#ef4444',\n      borderUpColor: '#22c55e',\n      borderDownColor: '#ef4444',\n      wickUpColor: '#22c55e',\n      wickDownColor: '#ef4444',\n    })\n    seriesRef.current = candlestickSeries\n\n    if (showVolume) {\n      const volumeSeries = (chart as any).addHistogramSeries({\n        color: '#64748b',\n        priceFormat: {\n          type: 'volume',\n        },\n        priceScaleId: '',\n      })\n      volumeSeries.priceScale().applyOptions({\n        scaleMargins: {\n          top: 0.8,\n          bottom: 0,\n        },\n      })\n      volumeSeriesRef.current = volumeSeries\n    }\n\n    const handleResize = () => {\n      if (chartContainerRef.current) {\n        chart.applyOptions({ width: chartContainerRef.current.clientWidth })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      chart.remove()\n    }\n  }, [height, showVolume])\n\n  useEffect(() => {\n    if (!seriesRef.current) return\n\n    const candleData: CandlestickData<Time>[] = processedData.map(d => ({\n      time: d.time as Time,\n      open: d.open,\n      high: d.high,\n      low: d.low,\n      close: d.close,\n    }))\n\n    seriesRef.current.setData(candleData)\n\n    if (volumeSeriesRef.current && showVolume) {\n      const volumeData = processedData.map(d => ({\n        time: d.time as Time,\n        value: d.volume || 0,\n        color: d.close >= d.open ? 'rgba(34, 197, 94, 0.5)' : 'rgba(239, 68, 68, 0.5)',\n      }))\n      volumeSeriesRef.current.setData(volumeData)\n    }\n\n    chartRef.current?.timeScale().fitContent()\n  }, [processedData, showVolume])\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Heikin Ashi Chart</CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Select value={chartType} onValueChange={(v) => setChartType(v as 'heikin-ashi' | 'traditional')}>\n              <SelectTrigger className=\"w-40\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"heikin-ashi\">Heikin Ashi</SelectItem>\n                <SelectItem value=\"traditional\">Traditional</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"icon\" onClick={() => chartRef.current?.timeScale().fitContent()}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div ref={chartContainerRef} className=\"w-full\" />\n        {chartType === 'heikin-ashi' && (\n          <div className=\"mt-4 p-3 rounded-lg bg-muted text-sm\">\n            <p className=\"font-medium mb-2\">Heikin Ashi Interpretation</p>\n            <div className=\"grid grid-cols-2 gap-2 text-muted-foreground\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-sm bg-green-500\" />\n                <span>Green candles = Uptrend</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-sm bg-red-500\" />\n                <span>Red candles = Downtrend</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-sm bg-green-500\" />\n                <span>Large bodies = Strong momentum</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-3 h-3 rounded-sm bg-red-500\" />\n                <span>Small bodies = Weak trend</span>\n              </div>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nexport default HeikinAshiChart\n","'use client'\n\nimport { useMemo, useRef, useEffect, useState } from 'react'\nimport { createChart, ColorType, IChartApi, ISeriesApi, Time } from 'lightweight-charts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { cn } from '@/lib/utils'\nimport { RefreshCw, TrendingUp, TrendingDown } from 'lucide-react'\n\nexport interface RenkoBrick {\n  startTime: string\n  endTime: string\n  open: number\n  close: number\n  high: number\n  low: number\n  direction: 'up' | 'down'\n  isReversal: boolean\n}\n\ninterface RenkoDataPoint {\n  time: string\n  close: number\n  volume?: number\n}\n\ninterface RenkoChartProps {\n  data: RenkoDataPoint[]\n  className?: string\n  height?: number\n  brickSize?: number\n  showVolume?: boolean\n}\n\nfunction calculateRenko(data: RenkoDataPoint[], brickSize: number): RenkoBrick[] {\n  if (data.length < 2) return []\n\n  const bricks: RenkoBrick[] = []\n  let currentPrice = data[0].close\n  let direction: 'up' | 'down' = data[1].close >= currentPrice ? 'up' : 'down'\n  let brickOpen = currentPrice - (direction === 'up' ? 0 : brickSize)\n  let brickClose = direction === 'up' ? brickOpen + brickSize : brickOpen - brickSize\n\n  for (let i = 1; i < data.length; i++) {\n    const price = data[i].close\n    const time = data[i].time\n\n    while (true) {\n      if (direction === 'up') {\n        if (price >= brickClose + brickSize) {\n          bricks.push({\n            startTime: time,\n            endTime: time,\n            open: brickOpen,\n            close: brickClose,\n            high: brickClose,\n            low: brickOpen,\n            direction: 'up',\n            isReversal: false\n          })\n          brickOpen = brickClose\n          brickClose += brickSize\n        } else if (price <= brickOpen - brickSize) {\n          bricks.push({\n            startTime: time,\n            endTime: time,\n            open: brickOpen,\n            close: brickOpen - brickSize,\n            high: brickOpen,\n            low: brickOpen - brickSize,\n            direction: 'down',\n            isReversal: true\n          })\n          brickClose = brickOpen\n          brickOpen = brickClose - brickSize\n          direction = 'down'\n        } else {\n          break\n        }\n      } else {\n        if (price <= brickClose - brickSize) {\n          bricks.push({\n            startTime: time,\n            endTime: time,\n            open: brickOpen,\n            close: brickClose,\n            high: brickOpen,\n            low: brickClose,\n            direction: 'down',\n            isReversal: false\n          })\n          brickOpen = brickClose\n          brickClose -= brickSize\n        } else if (price >= brickOpen + brickSize) {\n          bricks.push({\n            startTime: time,\n            endTime: time,\n            open: brickOpen,\n            close: brickOpen + brickSize,\n            high: brickOpen + brickSize,\n            low: brickOpen,\n            direction: 'up',\n            isReversal: true\n          })\n          brickClose = brickOpen\n          brickOpen = brickClose + brickSize\n          direction = 'up'\n        } else {\n          break\n        }\n      }\n    }\n  }\n\n  return bricks\n}\n\nexport function RenkoChart({\n  data,\n  className,\n  height = 400,\n  brickSize: initialBrickSize,\n  showVolume = true\n}: RenkoChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n  const seriesRef = useRef<ISeriesApi<'Custom'> | null>(null)\n  const [brickSize, setBrickSize] = useState(initialBrickSize || 10)\n  const [brickCount, setBrickCount] = useState(20)\n\n  const renkoData = useMemo(() => {\n    if (data.length === 0) return []\n    const priceRange = Math.max(...data.map(d => d.close)) - Math.min(...data.map(d => d.close))\n    const calculatedBrickSize = initialBrickSize || Math.max(priceRange / 50, 1)\n    return calculateRenko(data, calculatedBrickSize)\n  }, [data, initialBrickSize])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      layout: {\n        background: { type: ColorType.Solid, color: 'transparent' },\n        textColor: 'hsl(var(--muted-foreground))'\n      },\n      grid: {\n        vertLines: { color: 'hsl(var(--border))' },\n        horzLines: { color: 'hsl(var(--border))' }\n      },\n      width: chartContainerRef.current.clientWidth,\n      height: height,\n      timeScale: {\n        timeVisible: true,\n        secondsVisible: false,\n      }\n    })\n\n    chartRef.current = chart\n\n    const handleResize = () => {\n      if (chartContainerRef.current) {\n        chart.applyOptions({ width: chartContainerRef.current.clientWidth })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      chart.remove()\n    }\n  }, [height])\n\n  useEffect(() => {\n    if (!chartRef.current || renkoData.length === 0) return\n\n    const upBricks = renkoData.filter(b => b.direction === 'up')\n    const downBricks = renkoData.filter(b => b.direction === 'down')\n\n    const upData = upBricks.map((brick, i) => ({\n      time: (i + 1) as Time,\n      open: brick.open,\n      high: brick.high,\n      low: brick.low,\n      close: brick.close,\n    }))\n\n    const downData = downBricks.map((brick, i) => ({\n      time: (i + 1) as Time,\n      open: brick.open,\n      high: brick.high,\n      low: brick.low,\n      close: brick.close,\n    }))\n\n    chartRef.current.timeScale().fitContent()\n  }, [renkoData])\n\n  const upTrendCount = renkoData.filter(b => b.direction === 'up').length\n  const downTrendCount = renkoData.filter(b => b.direction === 'down').length\n  const reversalCount = renkoData.filter(b => b.isReversal).length\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Renko Chart</CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-2\">\n              <Label className=\"text-xs\">Brick Size</Label>\n              <Input\n                type=\"number\"\n                value={brickSize}\n                onChange={(e) => setBrickSize(parseFloat(e.target.value) || 10)}\n                className=\"w-20 h-8\"\n                min={0.01}\n                step={0.01}\n              />\n            </div>\n            <Button variant=\"outline\" size=\"icon\" onClick={() => chartRef.current?.timeScale().fitContent()}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div ref={chartContainerRef} className=\"w-full\" />\n        <div className=\"mt-4 grid grid-cols-4 gap-4\">\n          <div className=\"p-3 rounded-lg bg-green-50 border border-green-200\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-xs text-green-600 font-medium\">Up Bricks</span>\n            </div>\n            <p className=\"text-xl font-bold text-green-700\">{upTrendCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-red-50 border border-red-200\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <TrendingDown className=\"h-4 w-4 text-red-600\" />\n              <span className=\"text-xs text-red-600 font-medium\">Down Bricks</span>\n            </div>\n            <p className=\"text-xl font-bold text-red-700\">{downTrendCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-muted\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <RefreshCw className=\"h-4 w-4\" />\n              <span className=\"text-xs font-medium\">Reversals</span>\n            </div>\n            <p className=\"text-xl font-bold\">{reversalCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-muted\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-xs font-medium\">Total</span>\n            </div>\n            <p className=\"text-xl font-bold\">{renkoData.length}</p>\n          </div>\n        </div>\n        <div className=\"mt-4 p-3 rounded-lg bg-muted text-sm\">\n          <p className=\"font-medium mb-2\">Renko Chart Interpretation</p>\n          <div className=\"grid grid-cols-2 gap-2 text-muted-foreground\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-3 h-3 rounded-sm bg-green-500\" />\n              <span>Green bricks = Up trend</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-3 h-3 rounded-sm bg-red-500\" />\n              <span>Red bricks = Down trend</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span>•</span>\n              <span>Equal brick sizes filter noise</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span>•</span>\n              <span>Reversals show trend changes</span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nexport default RenkoChart\n","'use client'\n\nimport { useMemo, useRef, useEffect } from 'react'\nimport { createChart, ColorType, IChartApi, Time } from 'lightweight-charts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { RefreshCw } from 'lucide-react'\n\nexport interface KagiLine {\n  time: string\n  value: number\n  direction: 'up' | 'down' | 'neutral'\n  reversal: boolean\n  type: 'yang' | 'yin' | 'neutral'\n}\n\ninterface KagiDataPoint {\n  time: string\n  close: number\n  volume?: number\n}\n\ninterface KagiChartProps {\n  data: KagiDataPoint[]\n  className?: string\n  height?: number\n  reversalAmount?: number\n  showVolume?: boolean\n}\n\nfunction calculateKagi(data: KagiDataPoint[], reversalPercent: number): KagiLine[] {\n  if (data.length < 2) return []\n\n  const kagiLines: KagiLine[] = []\n  let currentPrice = data[0].close\n  let direction: 'up' | 'down' | 'neutral' = 'neutral'\n  let startPrice = currentPrice\n\n  const reversalThreshold = currentPrice * (reversalPercent / 100)\n\n  for (let i = 1; i < data.length; i++) {\n    const price = data[i].close\n    const time = data[i].time\n\n    if (direction === 'neutral') {\n      if (price > startPrice + reversalThreshold) {\n        direction = 'up'\n        kagiLines.push({ time, value: price, direction: 'up', reversal: false, type: 'yang' })\n      } else if (price < startPrice - reversalThreshold) {\n        direction = 'down'\n        kagiLines.push({ time, value: price, direction: 'down', reversal: false, type: 'yin' })\n      }\n    } else if (direction === 'up') {\n      if (price >= currentPrice) {\n        currentPrice = price\n        kagiLines.push({ time, value: price, direction: 'up', reversal: false, type: 'yang' })\n      } else if (price <= currentPrice - reversalThreshold) {\n        direction = 'down'\n        kagiLines.push({ time, value: price, direction: 'down', reversal: true, type: 'yin' })\n        currentPrice = price\n      }\n    } else if (direction === 'down') {\n      if (price <= currentPrice) {\n        currentPrice = price\n        kagiLines.push({ time, value: price, direction: 'down', reversal: false, type: 'yin' })\n      } else if (price >= currentPrice + reversalThreshold) {\n        direction = 'up'\n        kagiLines.push({ time, value: price, direction: 'up', reversal: true, type: 'yang' })\n        currentPrice = price\n      }\n    }\n  }\n\n  return kagiLines\n}\n\nexport function KagiChart({\n  data,\n  className,\n  height = 400,\n  reversalAmount = 4,\n  showVolume = true\n}: KagiChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null)\n  const chartRef = useRef<IChartApi | null>(null)\n\n  const kagiData = useMemo(() => calculateKagi(data, reversalAmount), [data, reversalAmount])\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return\n\n    const chart = createChart(chartContainerRef.current, {\n      layout: {\n        background: { type: ColorType.Solid, color: 'transparent' },\n        textColor: 'hsl(var(--muted-foreground))'\n      },\n      grid: {\n        vertLines: { color: 'hsl(var(--border))' },\n        horzLines: { color: 'hsl(var(--border))' }\n      },\n      width: chartContainerRef.current.clientWidth,\n      height: height,\n      timeScale: {\n        timeVisible: true,\n        secondsVisible: false,\n      }\n    })\n\n    chartRef.current = chart\n\n    const handleResize = () => {\n      if (chartContainerRef.current) {\n        chart.applyOptions({ width: chartContainerRef.current.clientWidth })\n      }\n    }\n\n    window.addEventListener('resize', handleResize)\n    return () => {\n      window.removeEventListener('resize', handleResize)\n      chart.remove()\n    }\n  }, [height])\n\n  useEffect(() => {\n    if (!chartRef.current || kagiData.length === 0) return\n\n    const yangLines = kagiData.filter(l => l.type === 'yang')\n    const yinLines = kagiData.filter(l => l.type === 'yin')\n\n    chartRef.current.timeScale().fitContent()\n  }, [kagiData])\n\n  const yangCount = kagiData.filter(l => l.type === 'yang').length\n  const yinCount = kagiData.filter(l => l.type === 'yin').length\n  const reversalCount = kagiData.filter(l => l.reversal).length\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Kagi Chart</CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">\n              Reversal: {reversalAmount}%\n            </span>\n            <Button variant=\"outline\" size=\"icon\" onClick={() => chartRef.current?.timeScale().fitContent()}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div ref={chartContainerRef} className=\"w-full\" />\n        <div className=\"mt-4 grid grid-cols-4 gap-4\">\n          <div className=\"p-3 rounded-lg bg-green-50 border border-green-200\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <div className=\"w-4 h-1 bg-green-600 rounded\" />\n              <span className=\"text-xs text-green-600 font-medium\">Yang (Up)</span>\n            </div>\n            <p className=\"text-xl font-bold text-green-700\">{yangCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-red-50 border border-red-200\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <div className=\"w-4 h-1 bg-red-600 rounded\" />\n              <span className=\"text-xs text-red-600 font-medium\">Yin (Down)</span>\n            </div>\n            <p className=\"text-xl font-bold text-red-700\">{yinCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-muted\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-xs font-medium\">Reversals</span>\n            </div>\n            <p className=\"text-xl font-bold\">{reversalCount}</p>\n          </div>\n          <div className=\"p-3 rounded-lg bg-muted\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-xs font-medium\">Total Lines</span>\n            </div>\n            <p className=\"text-xl font-bold\">{kagiData.length}</p>\n          </div>\n        </div>\n        <div className=\"mt-4 p-3 rounded-lg bg-muted text-sm\">\n          <p className=\"font-medium mb-2\">Kagi Chart Interpretation</p>\n          <div className=\"grid grid-cols-2 gap-2 text-muted-foreground\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-3 h-1 bg-green-600 rounded\" />\n              <span>Yang (green) = Rising trend</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-3 h-1 bg-red-600 rounded\" />\n              <span>Yin (red) = Falling trend</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span>•</span>\n              <span>Thickness changes indicate strength</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span>•</span>\n              <span>Shoulders mark trend reversals</span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nexport default KagiChart\n","'use client'\n\nimport { useState, useMemo, useCallback, useRef, useEffect } from 'react'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  ZoomIn,\n  ZoomOut,\n  Download,\n  RefreshCw,\n  Settings2,\n  TrendingUp,\n  TrendingDown,\n  BarChart3,\n  Maximize2,\n  Minimize2,\n  Activity,\n  CheckCircle,\n} from 'lucide-react'\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine,\n} from 'recharts'\nimport { cn, formatNumber, formatCurrency } from '@/lib/utils'\nimport { useDownloadFile } from '@/hooks/useDownload'\n\nexport interface DepthLevel {\n  price: number\n  bids: number\n  asks: number\n  bidVolume: number\n  askVolume: number\n  bidCumulative: number\n  askCumulative: number\n  spread: number\n  spreadPercent: number\n}\n\nexport interface DepthPoint {\n  price: number\n  bidDepth: number\n  askDepth: number\n  bidCumulative: number\n  askCumulative: number\n}\n\nexport interface OrderBookData {\n  symbol: string\n  bids: { price: number; size: number; total: number }[]\n  asks: { price: number; size: number; total: number }[]\n  spread: number\n  spreadPercent: number\n  midPrice: number\n  timestamp: string\n}\n\ninterface DepthChartProps {\n  data?: OrderBookData\n  depthLevels?: DepthLevel[]\n  symbol?: string\n  colorScheme?: 'classic' | 'blueRed' | 'greenRed'\n  showCumulative?: boolean\n  showMidPrice?: boolean\n  className?: string\n  onRefresh?: () => void\n}\n\nconst TIMEFRAMES = [\n  { value: 'realtime', label: 'Realtime' },\n  { value: '1s', label: '1 Second' },\n  { value: '5s', label: '5 Seconds' },\n  { value: '1m', label: '1 Minute' },\n]\n\nexport function DepthChart({\n  data,\n  depthLevels = [],\n  symbol = '',\n  colorScheme = 'blueRed',\n  showCumulative = false,\n  showMidPrice = true,\n  className,\n  onRefresh,\n}: DepthChartProps) {\n  const [activeTab, setActiveTab] = useState('depth')\n  const [selectedTimeframe, setSelectedTimeframe] = useState('realtime')\n  const [showMid, setShowMid] = useState(showMidPrice)\n  const [showCum, setShowCum] = useState(showCumulative)\n  const [isExporting, setIsExporting] = useState(false)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const chartRef = useRef<HTMLDivElement>(null)\n  const { downloadCSV, downloadText } = useDownloadFile()\n\n  const colors = useMemo(() => {\n    switch (colorScheme) {\n      case 'greenRed':\n        return { bid: '#22c55e', ask: '#ef4444', bidFill: '#22c55e20', askFill: '#ef444420' }\n      case 'blueRed':\n        return { bid: '#3b82f6', ask: '#ef4444', bidFill: '#3b82f620', askFill: '#ef444420' }\n      default:\n        return { bid: '#22c55e', ask: '#ef4444', bidFill: '#22c55e20', askFill: '#ef444420' }\n    }\n  }, [colorScheme])\n\n  const chartData = useMemo(() => {\n    if (depthLevels.length > 0) {\n      return depthLevels.map(level => ({\n        price: level.price,\n        bidDepth: level.bids,\n        askDepth: level.asks,\n        bidCumulative: level.bidCumulative,\n        askCumulative: level.askCumulative,\n        spread: level.spread,\n      }))\n    }\n\n    if (data) {\n      const maxPrice = Math.max(...data.asks.map(a => a.price))\n      const minPrice = Math.min(...data.bids.map(b => b.price))\n      const priceStep = (maxPrice - minPrice) / 50\n\n      const levels: DepthPoint[] = []\n      for (let price = minPrice; price <= maxPrice; price += priceStep) {\n        const bidDepth = data.bids\n          .filter(b => b.price >= price && b.price < price + priceStep)\n          .reduce((sum, b) => sum + b.size, 0)\n        const askDepth = data.asks\n          .filter(a => a.price >= price && a.price < price + priceStep)\n          .reduce((sum, a) => sum + a.size, 0)\n\n        levels.push({\n          price: parseFloat(price.toFixed(2)),\n          bidDepth,\n          askDepth,\n          bidCumulative: 0,\n          askCumulative: 0,\n        })\n      }\n\n      let bidCum = 0\n      let askCum = 0\n      for (let i = levels.length - 1; i >= 0; i--) {\n        bidCum += levels[i].bidDepth\n        levels[i].bidCumulative = bidCum\n      }\n      for (let i = 0; i < levels.length; i++) {\n        askCum += levels[i].askDepth\n        levels[i].askCumulative = askCum\n      }\n\n      return levels\n    }\n\n    return []\n  }, [data, depthLevels])\n\n  const maxDepth = useMemo(() => {\n    return Math.max(\n      ...chartData.map(d => Math.max(showCum ? d.bidCumulative : d.bidDepth, showCum ? d.askCumulative : d.askDepth))\n    )\n  }, [chartData, showCum])\n\n  const midPrice = useMemo(() => {\n    if (data) return data.midPrice\n    if (chartData.length > 0) {\n      const bids = chartData.filter(d => d.bidDepth > 0)\n      const asks = chartData.filter(d => d.askDepth > 0)\n      if (bids.length > 0 && asks.length > 0) {\n        const bidHigh = Math.max(...bids.map(b => b.price))\n        const askLow = Math.min(...asks.map(a => a.price))\n        return (bidHigh + askLow) / 2\n      }\n    }\n    return 0\n  }, [data, chartData])\n\n  const handleExportCSV = useCallback(() => {\n    if (chartData.length === 0) return\n\n    const headers = ['Price', 'Bid Depth', 'Ask Depth', 'Bid Cumulative', 'Ask Cumulative']\n    const rows = chartData.map(row => [\n      row.price.toFixed(2),\n      row.bidDepth.toFixed(4),\n      row.askDepth.toFixed(4),\n      row.bidCumulative.toFixed(4),\n      row.askCumulative.toFixed(4),\n    ])\n\n    const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n')\n    const filename = `depth-${symbol || 'chart'}-${new Date().toISOString().slice(0, 10)}.csv`\n    downloadCSV(csvContent, filename)\n  }, [chartData, symbol, downloadCSV])\n\n  const handleExportPNG = useCallback(async () => {\n    if (!chartRef.current) return\n    setIsExporting(true)\n\n    try {\n      const html2canvas = (await import('html2canvas')).default\n      const canvas = await html2canvas(chartRef.current, { scale: 2 })\n      const dataUrl = canvas.toDataURL('image/png')\n      const filename = `depth-${symbol || 'chart'}-${new Date().toISOString().slice(0, 10)}.png`\n      downloadText(dataUrl, filename, 'image/png')\n    } catch (err) {\n      console.error('Failed to export PNG:', err)\n    } finally {\n      setIsExporting(false)\n    }\n  }, [symbol, downloadText])\n\n  if (!data && depthLevels.length === 0) {\n    return (\n      <Card className={cn('border-2 border-foreground', className)}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5\" />\n            Order Book Depth\n          </CardTitle>\n          <CardDescription>Loading depth data...</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-64 flex items-center justify-center\">\n            <div className=\"animate-pulse flex flex-col items-center\">\n              <BarChart3 className=\"h-8 w-8 text-muted-foreground mb-2\" />\n              <span className=\"text-sm text-muted-foreground\">Waiting for market data</span>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <Card className={cn('border-2 border-foreground', isFullscreen && 'fixed inset-4 z-50', className)}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              Order Book Depth\n              {symbol && <Badge variant=\"secondary\">{symbol}</Badge>}\n            </CardTitle>\n            <CardDescription>\n              {data && (\n                <span>\n                  Spread: {formatCurrency(data.spread)} ({data.spreadPercent.toFixed(3)}%) • Mid: {formatCurrency(data.midPrice)}\n                </span>\n              )}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Select value={selectedTimeframe} onValueChange={setSelectedTimeframe}>\n              <SelectTrigger className=\"w-32\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {TIMEFRAMES.map(tf => (\n                  <SelectItem key={tf.value} value={tf.value}>{tf.label}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"icon\" onClick={onRefresh}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"outline\" size=\"icon\" onClick={() => setIsFullscreen(!isFullscreen)}>\n              {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\">\n                  <Settings2 className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => setShowMid(!showMid)}>\n                  <CheckCircle className={cn('h-4 w-4 mr-2', showMid ? 'opacity-100' : 'opacity-0')} />\n                  Show Mid Price\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setShowCum(!showCum)}>\n                  <CheckCircle className={cn('h-4 w-4 mr-2', showCum ? 'opacity-100' : 'opacity-0')} />\n                  Show Cumulative\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem onClick={() => {}}>\n                  Color Scheme\n                  <Select defaultValue={colorScheme} onValueChange={(v) => {}}>\n                    <SelectTrigger className=\"w-24 ml-2\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"blueRed\">Blue/Red</SelectItem>\n                      <SelectItem value=\"greenRed\">Green/Red</SelectItem>\n                      <SelectItem value=\"classic\">Classic</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent ref={chartRef}>\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n            <TabsTrigger value=\"depth\">Depth Chart</TabsTrigger>\n            <TabsTrigger value=\"levels\">Order Levels</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"depth\" className=\"mt-0\">\n            <div className=\"h-80\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                  <defs>\n                    <linearGradient id=\"bidGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor={colors.bid} stopOpacity={0.8} />\n                      <stop offset=\"95%\" stopColor={colors.bid} stopOpacity={0} />\n                    </linearGradient>\n                    <linearGradient id=\"askGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor={colors.ask} stopOpacity={0.8} />\n                      <stop offset=\"95%\" stopColor={colors.ask} stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--border)\" opacity={0.3} />\n                  <XAxis\n                    dataKey=\"price\"\n                    tick={{ fontSize: 11, fontFamily: 'monospace' }}\n                    tickFormatter={(v) => formatCurrency(v)}\n                  />\n                  <YAxis\n                    tick={{ fontSize: 11, fontFamily: 'monospace' }}\n                    tickFormatter={(v) => formatNumber(v)}\n                    domain={[0, maxDepth * 1.1]}\n                  />\n                  <Tooltip\n                    contentStyle={{\n                      backgroundColor: 'var(--background)',\n                      border: '2px solid var(--foreground)',\n                      borderRadius: 0,\n                      boxShadow: '4px 4px 0px 0px var(--foreground)',\n                    }}\n                    formatter={(value: number, name: string) => [\n                      formatNumber(value),\n                      name === 'bidDepth' || name === 'bidCumulative' ? 'Bid' : 'Ask'\n                    ]}\n                    labelFormatter={(label) => `Price: ${formatCurrency(label)}`}\n                  />\n                  {showMid && midPrice > 0 && (\n                    <ReferenceLine\n                      x={midPrice}\n                      stroke=\"var(--muted-foreground)\"\n                      strokeDasharray=\"5 5\"\n                      label={{ value: 'Mid', position: 'top', fill: 'var(--muted-foreground)', fontSize: 10 }}\n                    />\n                  )}\n                  <Area\n                    type=\"monotone\"\n                    dataKey={showCum ? 'bidCumulative' : 'bidDepth'}\n                    stroke={colors.bid}\n                    fill=\"url(#bidGradient)\"\n                    strokeWidth={2}\n                  />\n                  <Area\n                    type=\"monotone\"\n                    dataKey={showCum ? 'askCumulative' : 'askDepth'}\n                    stroke={colors.ask}\n                    fill=\"url(#askGradient)\"\n                    strokeWidth={2}\n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"levels\" className=\"mt-0\">\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\">Price</TableHead>\n                    <TableHead className=\"text-right text-green-500\">Bid Size</TableHead>\n                    <TableHead className=\"text-right text-red-500\">Ask Size</TableHead>\n                    <TableHead className=\"text-right\">Price</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {depthLevels.slice(0, 20).map((level, i) => (\n                    <TableRow key={i}>\n                      <TableCell className=\"text-right font-mono text-green-500\">\n                        {formatCurrency(level.price)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        {formatNumber(level.bids)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        {formatNumber(level.asks)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono text-red-500\">\n                        {formatCurrency(level.price + level.spread)}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"flex items-center justify-between mt-4 pt-4 border-t-2 border-foreground/10\">\n          <div className=\"flex items-center gap-4 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-4 rounded bg-green-500\" />\n              <span className=\"text-muted-foreground\">Bids</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-4 rounded bg-red-500\" />\n              <span className=\"text-muted-foreground\">Asks</span>\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={handleExportCSV}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              CSV\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" onClick={handleExportPNG} disabled={isExporting}>\n              <BarChart3 className=\"h-4 w-4 mr-2\" />\n              PNG\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\n\nexport default DepthChart\n","'use client'\n\nimport { useState, useMemo } from 'react'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport {\n  ArrowUp,\n  ArrowDown,\n  Activity,\n  RefreshCw,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n} from 'lucide-react'\nimport { cn, formatNumber, formatCurrency } from '@/lib/utils'\n\nexport interface OrderBookLevelData {\n  price: number\n  quantity: number\n  total: number\n}\n\nexport interface OrderBookMetrics {\n  spread: number\n  spread_pct: number\n  total_bid_volume: number\n  total_ask_volume: number\n  top_5_bid_volume: number\n  top_5_ask_volume: number\n  vwap_bid: number | null\n  vwap_ask: number | null\n  order_imbalance: number | null\n  timestamp: string\n}\n\nexport interface OrderBookData {\n  bids: OrderBookLevelData[]\n  asks: OrderBookLevelData[]\n  metrics: OrderBookMetrics\n}\n\ninterface OrderBookProps {\n  data?: OrderBookData\n  symbol?: string\n  depth?: number\n  className?: string\n  onRefresh?: () => void\n}\n\nexport function OrderBook({\n  data,\n  symbol = '',\n  depth = 15,\n  className,\n  onRefresh,\n}: OrderBookProps) {\n  const [activeTab, setActiveTab] = useState('book')\n  const [showPercent, setShowPercent] = useState(true)\n\n  const maxTotal = useMemo(() => {\n    if (!data) return 1\n    const maxBid = Math.max(...data.bids.map(b => b.total), 0)\n    const maxAsk = Math.max(...data.asks.map(a => a.total), 0)\n    return Math.max(maxBid, maxAsk)\n  }, [data])\n\n  const spread = data?.metrics.spread\n  const spreadPct = data?.metrics.spread_pct\n  const imbalance = data?.metrics.order_imbalance\n\n  const getDepthBarWidth = (total: number) => {\n    if (maxTotal === 0) return '0%'\n    return `${(total / maxTotal) * 100}%`\n  }\n\n  const getImbalanceColor = (value: number | null) => {\n    if (value === null) return 'bg-gray-500'\n    if (value > 0.3) return 'bg-green-500'\n    if (value > 0.1) return 'bg-green-400'\n    if (value > -0.1) return 'bg-yellow-500'\n    if (value > -0.3) return 'bg-orange-400'\n    return 'bg-red-500'\n  }\n\n  const getImbalanceLabel = (value: number | null) => {\n    if (value === null) return 'N/A'\n    if (value > 0.3) return 'Strong Buy'\n    if (value > 0.1) return 'Buy'\n    if (value > -0.1) return 'Neutral'\n    if (value > -0.3) return 'Sell'\n    return 'Strong Sell'\n  }\n\n  if (!data) {\n    return (\n      <Card className={cn('border-2 border-foreground', className)}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5\" />\n            Order Book\n            {symbol && <Badge variant=\"secondary\">{symbol}</Badge>}\n          </CardTitle>\n          <CardDescription>Loading order book data...</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"animate-pulse flex flex-col items-center\">\n              <Activity className=\"h-8 w-8 text-muted-foreground mb-2\" />\n              <span className=\"text-sm text-muted-foreground\">Waiting for market data</span>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <Card className={cn('border-2 border-foreground', className)}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              Order Book\n              {symbol && <Badge variant=\"secondary\">{symbol}</Badge>}\n            </CardTitle>\n            <CardDescription className=\"flex items-center gap-3 mt-1\">\n              <span className=\"flex items-center gap-1\">\n                Spread: <span className=\"font-mono font-medium\">{formatCurrency(spread)}</span>\n                <span className=\"text-muted-foreground\">({spreadPct?.toFixed(3)}%)</span>\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <DollarSign className=\"h-3 w-3\" />\n                Imbalance:\n                <span className={cn('font-mono font-medium px-1 rounded', getImbalanceColor(imbalance))}>\n                  {imbalance?.toFixed(3) ?? 'N/A'}\n                </span>\n                <span className=\"text-muted-foreground\">({getImbalanceLabel(imbalance)})</span>\n              </span>\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"icon\" onClick={onRefresh}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n            <TabsTrigger value=\"book\">Order Book</TabsTrigger>\n            <TabsTrigger value=\"analytics\">Analytics</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"book\" className=\"mt-0\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"rounded-md border\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-right\">Price</TableHead>\n                      <TableHead className=\"text-right\">Size</TableHead>\n                      {showPercent && <TableHead className=\"text-right\">Total</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {data.asks.slice(0, depth).reverse().map((level, i) => (\n                      <TableRow key={i}>\n                        <TableCell className=\"text-right font-mono text-red-500\">\n                          {formatCurrency(level.price)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          <div className=\"flex items-center justify-end gap-2\">\n                            <span>{formatNumber(level.quantity)}</span>\n                            <div\n                              className=\"h-1 bg-red-500/30\"\n                              style={{ width: getDepthBarWidth(level.total) }}\n                            />\n                          </div>\n                        </TableCell>\n                        {showPercent && (\n                          <TableCell className=\"text-right font-mono text-muted-foreground\">\n                            {formatCurrency(level.total)}\n                          </TableCell>\n                        )}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n\n              <div className=\"rounded-md border\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      {showPercent && <TableHead className=\"text-left\">Total</TableHead>}\n                      <TableHead className=\"text-left\">Size</TableHead>\n                      <TableHead className=\"text-left text-green-500\">Price</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {data.bids.slice(0, depth).map((level, i) => (\n                      <TableRow key={i}>\n                        {showPercent && (\n                          <TableCell className=\"text-left font-mono text-muted-foreground\">\n                            <div className=\"flex items-center gap-2\">\n                              <div\n                                className=\"h-1 bg-green-500/30\"\n                                style={{ width: getDepthBarWidth(level.total) }}\n                              />\n                              <span>{formatCurrency(level.total)}</span>\n                            </div>\n                          </TableCell>\n                        )}\n                        <TableCell className=\"text-left font-mono\">\n                          {formatNumber(level.quantity)}\n                        </TableCell>\n                        <TableCell className=\"text-left font-mono text-green-500\">\n                          {formatCurrency(level.price)}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            <div className=\"flex items-center justify-between mt-4 pt-4 border-t-2 border-foreground/10\">\n              <div className=\"flex items-center gap-4 text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 rounded bg-red-500\" />\n                  <span className=\"text-muted-foreground\">Asks (Sellers)</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 rounded bg-green-500\" />\n                  <span className=\"text-muted-foreground\">Bids (Buyers)</span>\n                </div>\n              </div>\n              <div className=\"text-sm text-muted-foreground\">\n                Last update: {data.metrics.timestamp ? new Date(data.metrics.timestamp).toLocaleTimeString() : 'N/A'}\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"analytics\" className=\"mt-0\">\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                  Total Bid Vol\n                </div>\n                <div className=\"text-2xl font-mono font-bold\">\n                  {formatNumber(data.metrics.total_bid_volume)}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                  Total Ask Vol\n                </div>\n                <div className=\"text-2xl font-mono font-bold\">\n                  {formatNumber(data.metrics.total_ask_volume)}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <ArrowUp className=\"h-4 w-4 text-blue-500\" />\n                  VWAP Bid\n                </div>\n                <div className=\"text-2xl font-mono font-bold\">\n                  {data.metrics.vwap_bid ? formatCurrency(data.metrics.vwap_bid) : 'N/A'}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <ArrowDown className=\"h-4 w-4 text-blue-500\" />\n                  VWAP Ask\n                </div>\n                <div className=\"text-2xl font-mono font-bold\">\n                  {data.metrics.vwap_ask ? formatCurrency(data.metrics.vwap_ask) : 'N/A'}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  Top 5 Bid Vol\n                </div>\n                <div className=\"text-2xl font-mono font-bold text-green-500\">\n                  {formatNumber(data.metrics.top_5_bid_volume)}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  Top 5 Ask Vol\n                </div>\n                <div className=\"text-2xl font-mono font-bold text-red-500\">\n                  {formatNumber(data.metrics.top_5_ask_volume)}\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-card col-span-2\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-2\">\n                  Order Imbalance\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex-1 h-4 rounded-full bg-gray-200 overflow-hidden\">\n                    <div\n                      className={cn('h-full transition-all', getImbalanceColor(imbalance))}\n                      style={{\n                        width: `${((imbalance ?? 0) + 1) * 50}%`,\n                      }}\n                    />\n                  </div>\n                  <div className=\"text-lg font-mono font-bold\">\n                    {imbalance?.toFixed(3) ?? 'N/A'}\n                  </div>\n                  <Badge variant=\"secondary\">\n                    {getImbalanceLabel(imbalance)}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  )\n}\n\nexport default OrderBook\n","'use client'\n\nimport { ErrorBoundary } from '@/components/ui/ErrorBoundary'\nimport type { ReactNode } from 'react'\n\ninterface ChartWrapperProps {\n  children: ReactNode\n  fallback?: ReactNode\n  className?: string\n}\n\nexport function ChartWrapper({ children, fallback, className }: ChartWrapperProps) {\n  return (\n    <ErrorBoundary fallback={fallback} className={className}>\n      {children}\n    </ErrorBoundary>\n  )\n}\n","// Technical Indicator Constants\nexport const INDICATOR_CATEGORIES = {\n  trend: {\n    label: 'Trend Indicators',\n    indicators: ['sma', 'ema', 'wma', 'ichimoku', 'parabolic_sar'],\n  },\n  momentum: {\n    label: 'Momentum Indicators',\n    indicators: ['rsi', 'stochastic', 'cci', 'williams_r', 'mfi'],\n  },\n  volatility: {\n    label: 'Volatility Indicators',\n    indicators: ['bollinger', 'atr'],\n  },\n  volume: {\n    label: 'Volume Indicators',\n    indicators: ['obv', 'ad', 'mfi'],\n  },\n} as const\n\nexport const INDICATOR_LABELS: Record<string, string> = {\n  sma: 'Simple Moving Average',\n  ema: 'Exponential Moving Average',\n  wma: 'Weighted Moving Average',\n  bollinger: 'Bollinger Bands',\n  rsi: 'Relative Strength Index',\n  macd: 'Moving Average Convergence Divergence',\n  stochastic: 'Stochastic Oscillator',\n  cci: 'Commodity Channel Index',\n  williams_r: 'Williams %R',\n  atr: 'Average True Range',\n  obv: 'On-Balance Volume',\n  mfi: 'Money Flow Index',\n  ad: 'Accumulation/Distribution Line',\n  ichimoku: 'Ichimoku Cloud',\n  parabolic_sar: 'Parabolic SAR',\n} as const\n\nexport const INDICATOR_COLORS = {\n  primary: '#3b82f6',\n  secondary: '#8b5cf6',\n  tertiary: '#06b6d4',\n  quaternary: '#10b981',\n  bullish: '#22c55e',\n  bearish: '#ef4444',\n  neutral: '#f59e0b',\n} as const\n\nexport const RSI_LEVELS = {\n  overbought: 70,\n  oversold: 30,\n} as const\n\nexport const MACD_SIGNALS = {\n  bullish: 'crossover',\n  bearish: 'crossunder',\n} as const\n\nexport const BOLLINGER_BANDS_DEFAULTS = {\n  period: 20,\n  stdDev: 2,\n  upperMultiplier: 2,\n  lowerMultiplier: 2,\n} as const\n\nexport const TIMEFRAMES = [\n  { value: '1m', label: '1 Minute', seconds: 60 },\n  { value: '5m', label: '5 Minutes', seconds: 300 },\n  { value: '15m', label: '15 Minutes', seconds: 900 },\n  { value: '1h', label: '1 Hour', seconds: 3600 },\n  { value: '4h', label: '4 Hours', seconds: 14400 },\n  { value: '1d', label: '1 Day', seconds: 86400 },\n  { value: '1w', label: '1 Week', seconds: 604800 },\n] as const\n\nexport const CHART_UPDATE_INTERVAL = 2000 // ms\nexport const INDICATOR_BUFFER_SIZE = 200 // data points\n\n// Drawing tool types\nexport const DRAWING_TOOLS = [\n  { type: 'horizontal_line', label: 'Horizontal Line', icon: 'minus' },\n  { type: 'vertical_line', label: 'Vertical Line', icon: 'minus' },\n  { type: 'trend_line', label: 'Trend Line', icon: 'trending-up' },\n  { type: 'support_resistance', label: 'Support/Resistance', icon: 'minus' },\n  { type: 'fibonacci', label: 'Fibonacci Retracement', icon: 'activity' },\n  { type: 'rectangle', label: 'Rectangle', icon: 'square' },\n  { type: 'text', label: 'Text Annotation', icon: 'type' },\n] as const\n\nexport const FIBONACCI_LEVELS = [0, 0.236, 0.382, 0.5, 0.618, 0.786, 1] as const\n\nexport const DEFAULT_INDICATORS: string[] = ['sma', 'rsi', 'macd']\n","export { TradingViewChart, type ChartType, type Timeframe } from './TradingViewChart'\nexport { AdvancedChart, type ChartType as AdvancedChartType, type Timeframe as AdvancedTimeframe, type DrawingType, type Drawing } from './AdvancedChart'\nexport { ChartControls } from './ChartControls'\nexport { TechnicalIndicators } from './TechnicalIndicators'\nexport { TechnicalIndicatorsPanel } from './TechnicalIndicatorsPanel'\nexport { IndicatorConfigModal } from './IndicatorConfigModal'\nexport { DrawingTools } from './DrawingTools'\nexport { ComparisonChart } from './ComparisonChart'\nexport { HoldingsPnLChart } from './HoldingsPnLChart'\nexport { HoldingsAllocationChart } from './HoldingsAllocationChart'\nexport { TopHoldingsChart } from './TopHoldingsChart'\nexport { MarketHeatmap, MarketHeatmapSkeleton, type Timeframe as HeatmapTimeframe } from './MarketHeatmap'\nexport { VolumeProfileChart, type VolumeProfileData, type VolumeProfilePoint } from './VolumeProfileChart'\nexport { CandlestickChart, type CandlestickData } from './CandlestickChart'\nexport { LineChart, type LineData } from './LineChart'\nexport { AreaChart, type AreaData } from './AreaChart'\nexport { HeikinAshiChart, type HeikinAshiData } from './HeikinAshiChart'\nexport { RenkoChart } from './RenkoChart'\nexport { KagiChart } from './KagiChart'\nexport { DepthChart } from './DepthChart'\nexport { OrderBook, type OrderBookData, type OrderBookLevelData, type OrderBookMetrics } from './OrderBook'\nexport { ChartWrapper } from './ChartWrapper'\nexport { HistoricalDataExport } from './HistoricalDataExport'\nexport { ChartScreenReader, ScreenReaderTable, ScreenReaderSummary } from './ScreenReaderChart'","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '11', cy: '11', r: '8', key: '4ej97u' }],\n  ['line', { x1: '21', x2: '16.65', y1: '21', y2: '16.65', key: '13gj7c' }],\n  ['line', { x1: '8', x2: '14', y1: '11', y2: '11', key: 'durymu' }],\n];\n\n/**\n * @component @name ZoomOut\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMSIgY3k9IjExIiByPSI4IiAvPgogIDxsaW5lIHgxPSIyMSIgeDI9IjE2LjY1IiB5MT0iMjEiIHkyPSIxNi42NSIgLz4KICA8bGluZSB4MT0iOCIgeDI9IjE0IiB5MT0iMTEiIHkyPSIxMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/zoom-out\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ZoomOut = createLucideIcon('zoom-out', __iconNode);\n\nexport default ZoomOut;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '9', r: '1', key: '124mty' }],\n  ['circle', { cx: '19', cy: '9', r: '1', key: '1ruzo2' }],\n  ['circle', { cx: '5', cy: '9', r: '1', key: '1a8b28' }],\n  ['circle', { cx: '12', cy: '15', r: '1', key: '1e56xg' }],\n  ['circle', { cx: '19', cy: '15', r: '1', key: '1a92ep' }],\n  ['circle', { cx: '5', cy: '15', r: '1', key: '5r1jwy' }],\n];\n\n/**\n * @component @name GripHorizontal\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjkiIHI9IjEiIC8+CiAgPGNpcmNsZSBjeD0iMTkiIGN5PSI5IiByPSIxIiAvPgogIDxjaXJjbGUgY3g9IjUiIGN5PSI5IiByPSIxIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTUiIHI9IjEiIC8+CiAgPGNpcmNsZSBjeD0iMTkiIGN5PSIxNSIgcj0iMSIgLz4KICA8Y2lyY2xlIGN4PSI1IiBjeT0iMTUiIHI9IjEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/grip-horizontal\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst GripHorizontal = createLucideIcon('grip-horizontal', __iconNode);\n\nexport default GripHorizontal;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '11', cy: '11', r: '8', key: '4ej97u' }],\n  ['line', { x1: '21', x2: '16.65', y1: '21', y2: '16.65', key: '13gj7c' }],\n  ['line', { x1: '11', x2: '11', y1: '8', y2: '14', key: '1vmskp' }],\n  ['line', { x1: '8', x2: '14', y1: '11', y2: '11', key: 'durymu' }],\n];\n\n/**\n * @component @name ZoomIn\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMSIgY3k9IjExIiByPSI4IiAvPgogIDxsaW5lIHgxPSIyMSIgeDI9IjE2LjY1IiB5MT0iMjEiIHkyPSIxNi42NSIgLz4KICA8bGluZSB4MT0iMTEiIHgyPSIxMSIgeTE9IjgiIHkyPSIxNCIgLz4KICA8bGluZSB4MT0iOCIgeDI9IjE0IiB5MT0iMTEiIHkyPSIxMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/zoom-in\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ZoomIn = createLucideIcon('zoom-in', __iconNode);\n\nexport default ZoomIn;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3', key: '1u773s' }],\n  ['path', { d: 'M12 17h.01', key: 'p32p05' }],\n];\n\n/**\n * @component @name CircleQuestionMark\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJNOS4wOSA5YTMgMyAwIDAgMSA1LjgzIDFjMCAyLTMgMy0zIDMiIC8+CiAgPHBhdGggZD0iTTEyIDE3aC4wMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/circle-question-mark\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleQuestionMark = createLucideIcon('circle-question-mark', __iconNode);\n\nexport default CircleQuestionMark;\n","import { OHLCVData } from '@/components/charts/TradingViewChart'\n\nexport type { OHLCVData }\n\nexport interface IndicatorConfig {\n  sma20?: boolean\n  sma50?: boolean\n  sma200?: boolean\n  ema12?: boolean\n  ema26?: boolean\n  rsi?: boolean\n  rsiPeriod?: number\n  rsiOverbought?: number\n  rsiOversold?: number\n  macd?: boolean\n  macdFast?: number\n  macdSlow?: number\n  macdSignal?: number\n  bollinger?: boolean\n  bollingerPeriod?: number\n  bollingerStdDev?: number\n}\n\nexport interface IndicatorResult {\n  sma20?: number[]\n  sma50?: number[]\n  sma200?: number[]\n  ema12?: number[]\n  ema26?: number[]\n  rsi?: number[]\n  macd?: {\n    macd: number[]\n    signal: number[]\n    histogram: number[]\n  }\n  bollinger?: {\n    upper: number[]\n    middle: number[]\n    lower: number[]\n  }\n}\n\nexport function calculateSMA(data: number[], period: number): number[] {\n  const result: number[] = []\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) {\n      result.push(NaN)\n    } else {\n      let sum = 0\n      for (let j = 0; j < period; j++) {\n        sum += data[i - j]\n      }\n      result.push(sum / period)\n    }\n  }\n  return result\n}\n\nexport function calculateEMA(data: number[], period: number): number[] {\n  const result: number[] = []\n  const multiplier = 2 / (period + 1)\n  \n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) {\n      result.push(data[0])\n    } else if (i < period) {\n      result.push(NaN)\n    } else if (i === period) {\n      let sum = 0\n      for (let j = 0; j < period; j++) {\n        sum += data[i - j]\n      }\n      result.push(sum / period)\n    } else {\n      const ema = (data[i] - result[i - 1]) * multiplier + result[i - 1]\n      result.push(ema)\n    }\n  }\n  return result\n}\n\nexport function calculateRSI(data: number[], period: number = 14): number[] {\n  const result: number[] = []\n  const gains: number[] = []\n  const losses: number[] = []\n\n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) {\n      result.push(NaN)\n      continue\n    }\n\n    const change = data[i] - data[i - 1]\n    gains.push(change > 0 ? change : 0)\n    losses.push(change < 0 ? -change : 0)\n\n    if (i < period) {\n      result.push(NaN)\n    } else if (i === period) {\n      const avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period\n      const avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period\n      const rs = avgGain / (avgLoss || 0.0001)\n      result.push(100 - (100 / (1 + rs)))\n    } else {\n      const prevResult = result[i - 1]\n      const avgGain = (gains.slice(-period - 1, -1).reduce((a, b) => a + b, 0) + gains[gains.length - 1]) / period\n      const avgLoss = (losses.slice(-period - 1, -1).reduce((a, b) => a + b, 0) + losses[losses.length - 1]) / period\n      const rs = avgGain / (avgLoss || 0.0001)\n      result.push(100 - (100 / (1 + rs)))\n    }\n  }\n  return result\n}\n\nexport function calculateMACD(\n  data: number[],\n  fastPeriod: number = 12,\n  slowPeriod: number = 26,\n  signalPeriod: number = 9\n): { macd: number[]; signal: number[]; histogram: number[] } {\n  const fastEMA = calculateEMA(data, fastPeriod)\n  const slowEMA = calculateEMA(data, slowPeriod)\n  \n  const macdLine: number[] = []\n  for (let i = 0; i < data.length; i++) {\n    if (fastEMA[i] === undefined || slowEMA[i] === undefined || isNaN(fastEMA[i]) || isNaN(slowEMA[i])) {\n      macdLine.push(NaN)\n    } else {\n      macdLine.push(fastEMA[i] - slowEMA[i])\n    }\n  }\n\n  const signalLine = calculateEMA(\n    macdLine.filter(v => !isNaN(v)),\n    signalPeriod\n  )\n\n  const macdValidStart = slowPeriod - 1\n  const signalStart = macdValidStart + signalPeriod - 1\n  \n  const histogram: number[] = []\n  for (let i = 0; i < data.length; i++) {\n    if (i < signalStart) {\n      histogram.push(NaN)\n    } else {\n      const macdIdx = i - macdValidStart\n      const signalIdx = i - signalStart\n      const macdVal = macdLine[macdIdx]\n      const signalVal = signalLine[signalIdx]\n      if (isNaN(macdVal) || isNaN(signalVal)) {\n        histogram.push(NaN)\n      } else {\n        histogram.push(macdVal - signalVal)\n      }\n    }\n  }\n\n  return {\n    macd: macdLine,\n    signal: signalLine,\n    histogram,\n  }\n}\n\nexport function calculateBollingerBands(data: number[], period: number = 20, stdDev: number = 2): {\n  upper: number[]\n  middle: number[]\n  lower: number[]\n} {\n  const middle = calculateSMA(data, period)\n  const upper: number[] = []\n  const lower: number[] = []\n\n  for (let i = 0; i < data.length; i++) {\n    if (isNaN(middle[i])) {\n      upper.push(NaN)\n      lower.push(NaN)\n    } else {\n      let sumSquares = 0\n      let count = 0\n      for (let j = 0; j < period; j++) {\n        if (i - j >= 0 && !isNaN(middle[i - j])) {\n          sumSquares += Math.pow(data[i - j] - middle[i], 2)\n          count++\n        }\n      }\n      const stdDevValue = count > 0 ? Math.sqrt(sumSquares / count) * stdDev : 0\n      upper.push(middle[i] + stdDevValue)\n      lower.push(middle[i] - stdDevValue)\n    }\n  }\n\n  return { upper, middle, lower }\n}\n\nexport function calculateAllIndicators(data: OHLCVData[], config: IndicatorConfig): IndicatorResult {\n  const closes = data.map(d => d.close)\n  const result: IndicatorResult = {}\n\n  if (config.sma20) result.sma20 = calculateSMA(closes, 20)\n  if (config.sma50) result.sma50 = calculateSMA(closes, 50)\n  if (config.sma200) result.sma200 = calculateSMA(closes, 200)\n  if (config.ema12) result.ema12 = calculateEMA(closes, 12)\n  if (config.ema26) result.ema26 = calculateEMA(closes, 26)\n  if (config.rsi) {\n    const rsiPeriod = config.rsiPeriod || 14\n    result.rsi = calculateRSI(closes, rsiPeriod)\n  }\n  if (config.macd) {\n    const fastPeriod = config.macdFast || 12\n    const slowPeriod = config.macdSlow || 26\n    const signalPeriod = config.macdSignal || 9\n    result.macd = calculateMACD(closes, fastPeriod, slowPeriod, signalPeriod)\n  }\n  if (config.bollinger) {\n    const period = config.bollingerPeriod || 20\n    const stdDev = config.bollingerStdDev || 2\n    result.bollinger = calculateBollingerBands(closes, period, stdDev)\n  }\n\n  return result\n}\n\nexport function formatIndicatorValue(value: number | undefined): string {\n  if (value === undefined || isNaN(value)) return '--'\n  if (Math.abs(value) >= 1000) {\n    return value.toFixed(0)\n  } else if (Math.abs(value) >= 100) {\n    return value.toFixed(1)\n  } else if (Math.abs(value) >= 10) {\n    return value.toFixed(2)\n  } else {\n    return value.toFixed(3)\n  }\n}\n\nexport function getRSISignal(rsi: number, overbought: number = 70, oversold: number = 30): 'overbought' | 'oversold' | 'neutral' {\n  if (rsi >= overbought) return 'overbought'\n  if (rsi <= oversold) return 'oversold'\n  return 'neutral'\n}\n\nexport function getMACDSignal(macd: number, signal: number): 'bullish' | 'bearish' | 'neutral' {\n  if (macd > signal) return 'bullish'\n  if (macd < signal) return 'bearish'\n  return 'neutral'\n}\n\nexport const INDICATOR_DESCRIPTIONS = {\n  sma20: {\n    name: 'SMA 20',\n    fullName: 'Simple Moving Average (20 periods)',\n    description: 'The average closing price over the last 20 periods. Shows medium-term trend direction.',\n    interpretation: 'Price above SMA 20 suggests bullish momentum. Price below suggests bearish momentum.',\n    color: '#3b82f6',\n  },\n  sma50: {\n    name: 'SMA 50',\n    fullName: 'Simple Moving Average (50 periods)',\n    description: 'The average closing price over the last 50 periods. Used to identify medium-term trend.',\n    interpretation: 'When price crosses above SMA 50, it may indicate a trend reversal to bullish.',\n    color: '#22c55e',\n  },\n  sma200: {\n    name: 'SMA 200',\n    fullName: 'Simple Moving Average (200 periods)',\n    description: 'The average closing price over the last 200 periods. Considered a key long-term trend indicator.',\n    interpretation: 'Price above SMA 200 is in a long-term bullish trend. Often called the \"life line\" of the chart.',\n    color: '#f59e0b',\n  },\n  ema12: {\n    name: 'EMA 12',\n    fullName: 'Exponential Moving Average (12 periods)',\n    description: 'A weighted moving average that gives more importance to recent prices. Responds faster to price changes.',\n    interpretation: 'EMA 12 reacts quicker to price movements than SMA, useful for short-term trading signals.',\n    color: '#8b5cf6',\n  },\n  ema26: {\n    name: 'EMA 26',\n    fullName: 'Exponential Moving Average (26 periods)',\n    description: 'A weighted moving average over 26 periods, commonly used in MACD calculation.',\n    interpretation: 'Compare with EMA 12 to identify momentum shifts in the market.',\n    color: '#ec4899',\n  },\n  rsi: {\n    name: 'RSI',\n    fullName: 'Relative Strength Index',\n    description: 'Momentum oscillator that measures the speed and change of price movements. Scale: 0-100.',\n    interpretation: 'RSI above 70 = Overbought (potential sell). RSI below 30 = Oversold (potential buy).',\n    defaultPeriod: 14,\n    overbought: 70,\n    oversold: 30,\n  },\n  macd: {\n    name: 'MACD',\n    fullName: 'Moving Average Convergence Divergence',\n    description: 'Shows the relationship between two EMAs. Consists of MACD line, Signal line, and Histogram.',\n    interpretation: 'MACD above Signal = Bullish. MACD below Signal = Bearish. Histogram shows momentum strength.',\n    defaultFast: 12,\n    defaultSlow: 26,\n    defaultSignal: 9,\n  },\n  bollinger: {\n    name: 'Bollinger Bands',\n    fullName: 'Bollinger Bands',\n    description: 'Three lines: Middle band (SMA), Upper band (+2 std dev), Lower band (-2 std dev). Measures volatility.',\n    interpretation: 'Price near upper band = potentially overbought. Price near lower band = potentially oversold. Bands widen during high volatility.',\n    defaultPeriod: 20,\n    defaultStdDev: 2,\n  },\n}\n","// Technical Indicator Types\nexport type IndicatorType =\n  | 'sma'     // Simple Moving Average\n  | 'ema'     // Exponential Moving Average\n  | 'wma'     // Weighted Moving Average\n  | 'bollinger' // Bollinger Bands\n  | 'rsi'     // Relative Strength Index\n  | 'macd'    // Moving Average Convergence Divergence\n  | 'stochastic' // Stochastic Oscillator\n  | 'cci'     // Commodity Channel Index\n  | 'williams_r' // Williams %R\n  | 'atr'     // Average True Range\n  | 'obv'     // On-Balance Volume\n  | 'mfi'     // Money Flow Index\n  | 'ad'      // Accumulation/Distribution Line\n  | 'ichimoku' // Ichimoku Cloud\n  | 'parabolic_sar' // Parabolic SAR\n\nexport type DrawingType =\n  | 'horizontal_line'\n  | 'vertical_line'\n  | 'trend_line'\n  | 'fibonacci'\n  | 'rectangle'\n  | 'text'\n\nexport type TimeFrame = '1m' | '5m' | '15m' | '30m' | '1h' | '4h' | '1d' | '1w' | '1M' | '3m' | '6m' | '1y'\nexport type TimeInterval = TimeFrame\n\nexport interface IndicatorConfig {\n  type: IndicatorType\n  params: Record<string, number>\n  visible: boolean\n  color: string\n  secondary_yaxis?: boolean\n}\n\nexport interface IndicatorData {\n  indicator: IndicatorType\n  symbol: string\n  timeframe: TimeFrame\n  values: Array<{\n    timestamp: string\n    value: number\n    signal?: 'buy' | 'sell' | 'neutral'\n  }>\n  params: Record<string, number>\n  calculated_at: string\n}\n\nexport interface ChartDataPoint {\n  timestamp: string\n  open: number\n  high: number\n  low: number\n  close: number\n  volume: number\n}\n\nexport interface TechnicalAnalysis {\n  symbol: string\n  timeframe: TimeFrame\n  trend: 'bullish' | 'bearish' | 'neutral'\n  strength: number // 0-100\n  support_levels: number[]\n  resistance_levels: number[]\n  indicators: {\n    [key: string]: IndicatorData\n  }\n  signals: TradingSignal[]\n  analyzed_at: string\n}\n\nexport interface TradingSignal {\n  type: 'buy' | 'sell' | 'hold'\n  indicator: string\n  strength: 'weak' | 'moderate' | 'strong'\n  price: number\n  timestamp: string\n  description: string\n}\n\n// Indicator-specific data types\nexport interface MovingAverageData {\n  symbol: string\n  timeframe: TimeFrame\n  ma_type: 'sma' | 'ema' | 'wma'\n  period: number\n  values: Array<{\n    timestamp: string\n    ma: number\n    price: number\n  }>\n}\n\nexport interface BollingerBandsData {\n  symbol: string\n  timeframe: TimeFrame\n  period: number\n  standard_deviation: number\n  values: Array<{\n    timestamp: string\n    upper: number\n    middle: number\n    lower: number\n    price: number\n    bandwidth: number\n    percent_b: number\n  }>\n}\n\nexport interface MACDData {\n  symbol: string\n  timeframe: TimeFrame\n  fast_period: number\n  slow_period: number\n  signal_period: number\n  values: Array<{\n    timestamp: string\n    macd: number\n    signal: number\n    histogram: number\n  }>\n}\n\nexport interface StochasticData {\n  symbol: string\n  timeframe: TimeFrame\n  k_period: number\n  d_period: number\n  values: Array<{\n    timestamp: string\n    k: number\n    d: number\n    signal: string\n  }>\n}\n\nexport interface RSIData {\n  symbol: string\n  timeframe: TimeFrame\n  period: number\n  values: Array<{\n    timestamp: string\n    rsi: number\n    signal: string\n  }>\n}\n\n// Default indicator configurations\nexport const DEFAULT_INDICATORS: Record<IndicatorType, IndicatorConfig> = {\n  sma: {\n    type: 'sma',\n    params: { period: 20 },\n    visible: true,\n    color: '#3b82f6',\n  },\n  ema: {\n    type: 'ema',\n    params: { period: 12 },\n    visible: true,\n    color: '#8b5cf6',\n  },\n  wma: {\n    type: 'wma',\n    params: { period: 10 },\n    visible: false,\n    color: '#06b6d4',\n  },\n  bollinger: {\n    type: 'bollinger',\n    params: { period: 20, stdDev: 2 },\n    visible: false,\n    color: '#f59e0b',\n  },\n  rsi: {\n    type: 'rsi',\n    params: { period: 14 },\n    visible: false,\n    color: '#ef4444',\n    secondary_yaxis: true,\n  },\n  macd: {\n    type: 'macd',\n    params: { fastPeriod: 12, slowPeriod: 26, signalPeriod: 9 },\n    visible: false,\n    color: '#10b981',\n    secondary_yaxis: true,\n  },\n  stochastic: {\n    type: 'stochastic',\n    params: { kPeriod: 14, dPeriod: 3 },\n    visible: false,\n    color: '#f97316',\n    secondary_yaxis: true,\n  },\n  cci: {\n    type: 'cci',\n    params: { period: 20 },\n    visible: false,\n    color: '#06b6d4',\n    secondary_yaxis: true,\n  },\n  williams_r: {\n    type: 'williams_r',\n    params: { period: 14 },\n    visible: false,\n    color: '#eab308',\n    secondary_yaxis: true,\n  },\n  atr: {\n    type: 'atr',\n    params: { period: 14 },\n    visible: false,\n    color: '#a855f7',\n    secondary_yaxis: true,\n  },\n  obv: {\n    type: 'obv',\n    params: {},\n    visible: false,\n    color: '#22c55e',\n    secondary_yaxis: true,\n  },\n  mfi: {\n    type: 'mfi',\n    params: { period: 14 },\n    visible: false,\n    color: '#ec4899',\n    secondary_yaxis: true,\n  },\n  ad: {\n    type: 'ad',\n    params: {},\n    visible: false,\n    color: '#14b8a6',\n    secondary_yaxis: true,\n  },\n  ichimoku: {\n    type: 'ichimoku',\n    params: {\n      tenkanPeriod: 9,\n      kijunPeriod: 26,\n      senkouSpanBPeriod: 52,\n    },\n    visible: false,\n    color: '#6366f1',\n  },\n  parabolic_sar: {\n    type: 'parabolic_sar',\n    params: { step: 0.02, max: 0.2 },\n    visible: false,\n    color: '#f43f5e',\n  },\n}\n"],"names":[],"mappings":"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","ignoreList":[23,24,25,26]}