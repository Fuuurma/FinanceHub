(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6100,e=>{"use strict";var r=e.i(29845),t=e.i(59199);let a=(0,t.createContext)(void 0),o="access_token",s="refresh_token",i="user_data";function n({children:e}){let[n,l]=(0,t.useState)({user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}),c=(0,t.useCallback)(async(e,r)=>{l(e=>({...e,isLoading:!0,error:null}));try{let t=await fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:r})});if(!t.ok){let e=await t.json();throw Error(e.message||"Login failed")}let a=await t.json();a.access&&a.refresh&&(localStorage.setItem(o,a.access),localStorage.setItem(s,a.refresh),localStorage.setItem(i,JSON.stringify(a.user))),l(e=>({...e,user:a.user,token:a.access,refreshToken:a.refresh,isAuthenticated:!0,isLoading:!1,error:null}))}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Login failed"}))}},[]),u=(0,t.useCallback)(async e=>{l(e=>({...e,isLoading:!0,error:null}));try{let r=await fetch("/api/v1/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw Error(e.message||"Registration failed")}let t=await r.json();t.access&&t.refresh&&t.user&&(localStorage.setItem(o,t.access),localStorage.setItem(s,t.refresh),localStorage.setItem(i,JSON.stringify(t.user))),l(e=>({...e,user:t.user,token:t.access,refreshToken:t.refresh,isAuthenticated:!0,isLoading:!1,error:null}))}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"}))}},[]),h=(0,t.useCallback)(async()=>{try{let e=localStorage.getItem(s);e&&await fetch("/api/v1/auth/logout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({refreshToken:e})}),localStorage.removeItem(o),localStorage.removeItem(s),localStorage.removeItem(i),l(e=>({...e,user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}))}catch(e){l(r=>({...r,error:e instanceof Error?e.message:"Logout failed"}));return}},[]),f=(0,t.useCallback)(async()=>{let e=localStorage.getItem(s);if(e)try{let r=await fetch("/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({refreshToken:e})});if(!r.ok)throw localStorage.removeItem(s),Error("Token refresh failed");let t=await r.json();t.access&&t.refresh&&(localStorage.setItem(o,t.access),localStorage.setItem(s,t.refresh)),l(e=>({...e,token:t.access,refreshToken:t.refresh,isAuthenticated:!!t.access,isLoading:!1,error:null}))}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Token refresh failed"}))}},[]),d=(0,t.useCallback)(async()=>{let e=localStorage.getItem(o);if(!e)return null;try{let r=await fetch("/api/v1/auth/me",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to fetch user data");let t=await r.json();l(r=>({...r,user:t,token:e,isAuthenticated:!!t,isLoading:!1,error:null}))}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Failed to fetch user data"}));return}},[]),g=(0,t.useCallback)(()=>{l(e=>({...e,error:null}))},[]),m=(0,t.useCallback)(e=>{l(r=>({...r,error:e}))},[]),S=(0,t.useCallback)(async e=>{try{let r=localStorage.getItem(o),t=await fetch("/api/v1/users/me/",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to update user");let a=await t.json();l(e=>({...e,user:a})),localStorage.setItem(i,JSON.stringify(a))}catch(e){l(r=>({...r,error:e instanceof Error?e.message:"Update failed"}))}},[]),y=(0,t.useCallback)(()=>{let e=localStorage.getItem(o),r=localStorage.getItem(i);return!!e&&!!r&&JSON.parse(r)},[n.token,n.user]);return(0,t.useEffect)(()=>{if(n.token){let e=setInterval(()=>{f()},84e4);return()=>{clearInterval(e)}}},[n.token,f]),(0,r.jsx)(a.Provider,{value:{...n,login:c,register:u,logout:h,refreshTokens:f,getMe:d,clearError:g,setError:m,checkAuthStatus:y,updateUser:S},children:e})}function l(){let e=(0,t.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}e.s(["AuthProvider",()=>n,"useAuth",()=>l])},48245,e=>{"use strict";var r=e.i(29845),t=e.i(6100);function a({children:e}){return(0,r.jsx)(t.AuthProvider,{children:e})}e.s(["default",()=>a])}]);